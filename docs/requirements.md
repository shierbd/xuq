# 需求挖掘系统 - 需求文档

**项目名称**: 需求挖掘系统 (Demand Mining System)
**文档版本**: v2.0
**创建日期**: 2026-01-27
**最后更新**: 2026-01-27

---

## 📋 项目概述

### 项目背景

**项目定位**: 基于多数据源的需求挖掘与分析平台

**核心目标**: 通过分析长尾词、平台商品数据、文字数据、评论数据等，挖掘产品需求，辅助产品构建决策。

**项目架构**: 
- 前后端分离的 Web 应用
- 多模块独立架构
- 当前重点：商品管理模块

### 核心理念

**从数据 → 聚类 → 需求 → 产品验证**

### 目标用户

- 产品经理
- 需求分析师
- 市场研究人员
- 创业者（个人使用）

---

## 🎯 模块规划

### 当前开发模块

#### 商品管理模块（P0 - 当前重点）
- 数据来源：Etsy 平台
- 核心功能：数据导入、语义聚类、需求分析、交付产品识别

### 预留模块（暂不开发）

#### 长尾词模块（预留）
- 状态：预留，暂不详细设计

#### Reddit 模块（预留）
- 状态：预留，暂不详细设计

**注意**: 各模块独立开发，暂不考虑模块间联动。

---

## 🎯 商品管理模块 - 核心需求

### P0 需求（必须实现）

---

#### REQ-001: 数据导入功能

**需求描述**: 支持从 Excel/CSV 文件导入 Etsy 商品数据

**功能详细说明**:

**1. 功能描述**
- 用户可以上传 Excel 或 CSV 格式的商品数据文件
- 系统解析文件并导入数据到系统中
- 支持多次导入（持续更新数据）
- 支持大批量数据（几千到十万级商品）

**2. 输入信息**
- 文件格式：Excel (.xlsx, .xls) 或 CSV (.csv)
- 文件结构：
  - **无表头**（第一行就是数据）
  - 固定 5 列结构：
    - 列 0：商品名称 (product_name) - 必填，文本
    - 列 1：评分 (rating) - 可选，数字（0-5）
    - 列 2：评价数量 (review_count) - 可选，带括号和单位（如 (1.1k)、(19.1k)、(15)）
    - 列 3：店铺名称 (shop_name) - 可选，文本
    - 列 4：价格 (price) - 可选，数字
- 数据来源：Etsy 平台导出数据
- 文件大小限制：建议 < 100MB
- 编码格式：UTF-8
- 参考路径：D:\数据\etsy\

**3. 功能要求**
- 支持拖拽上传和点击上传
- 上传前预览文件内容（前 10 行）
- 字段映射功能（用户可以指定哪一列对应哪个字段）
- 数据验证：检查必填字段、数据格式
- 显示导入进度条
- 导入完成后显示统计信息（成功/失败/重复数量）

**4. 数据处理**

**4.1 数据解析**
- 读取 Excel/CSV 文件（无表头，header=None）
- 自动识别列结构（固定 5 列）
- 将列映射到字段：
  - 列 0 → product_name
  - 列 1 → rating
  - 列 2 → review_count（原始值）
  - 列 3 → shop_name
  - 列 4 → price

**4.2 数据预处理（重要）**

**评价数量转换**（review_count）：
- 格式：(1.1k) → 1100
- 规则：
  1. 去除括号：(1.1k) → 1.1k
  2. 识别单位：
     - k/K → 乘以 1000
     - m/M → 乘以 1000000
     - 无单位 → 保持原值
  3. 转换为整数
- 示例：
  - (1.1k) → 1100
  - (19.1k) → 19100
  - (9.8k) → 9800
  - (15) → 15
  - (2.5m) → 2500000

**空格处理**：
- 去除所有字段的前后空格
- 商品名称内部多余空格压缩为单个空格

**括号处理**：
- 评价数量：去除括号 ()
- 商品名称：保留括号（可能是商品信息的一部分）

**其他清洗**：
- 价格：去除货币符号（$、€ 等）
- 缺失值：标记为 NULL
- 评分：验证范围（0-5），超出范围标记为无效

**4.3 数据标准化**
- 商品名称：保持原样（不转小写，保留大小写信息）
- 价格：统一为数字格式（float）
- 评分：统一为数字格式（float）
- 评价数量：统一为整数格式（int）

**4.4 数据存储**
- 数据库：SQLite（开发）/ PostgreSQL（生产）
- 数据去重：基于商品名称 + 店铺名称去重
- 导入历史：记录每次导入的时间、文件名、数量

**4.5 数据验证**
- 必填字段检查：商品名称不能为空
- 数据格式检查：评分、价格、评价数量必须是有效数字
- 数据范围检查：评分 0-5，价格 > 0，评价数量 >= 0

**5. 验收标准**
- [ ] 能够成功上传 Excel 和 CSV 文件
- [ ] 能够正确解析无表头的 5 列数据
- [ ] 能够正确转换评价数量（(1.1k) → 1100）
- [ ] 能够正确处理空格和括号
- [ ] 能够处理 10,000+ 条商品数据
- [ ] 导入时间 < 30 秒（10,000 条数据）
- [ ] 能够识别并提示错误数据
- [ ] 能够显示导入统计信息（成功/失败/重复/转换错误）
- [ ] 能够查看导入历史记录
- [ ] 数据预处理准确率 > 99%

**6. 边界情况**
- 文件格式错误：提示"不支持的文件格式，请上传 Excel 或 CSV 文件"
- 文件过大：提示"文件过大，请分批上传"
- 列数不匹配：提示"文件列数不正确，期望 5 列，实际 X 列"
- 商品名称为空：跳过该行，记录到错误日志
- 评价数量格式错误：
  - 无法解析：标记为 0，记录警告
  - 示例：(abc) → 0（警告）
- 评分超出范围：
  - < 0 或 > 5：标记为 NULL，记录警告
- 价格为负数：标记为 NULL，记录警告
- 重复数据：提示重复数量，询问是否覆盖或跳过
- 文件为空：提示"文件为空，请检查文件内容"
- 编码错误：尝试多种编码（UTF-8、GBK、GB2312），失败后提示

---

#### REQ-002: 数据管理功能

**需求描述**: 对导入的商品数据进行查看、编辑、删除等基本管理操作

**功能详细说明**:

**1. 功能描述**
- 用户可以查看所有导入的商品数据
- 支持搜索、筛选、排序
- 支持编辑单条商品信息
- 支持批量删除

**2. 输入信息**
- 搜索关键词：文本，可选
- 筛选条件：评分范围、价格范围、店铺名称
- 排序字段：评分、价格、评价数量、导入时间

**3. 功能要求**
- 表格展示商品列表
- 分页显示（每页 50 条）
- 支持全文搜索（商品名称、描述）
- 支持多条件筛选
- 支持多字段排序
- 单条编辑：点击行进入编辑模式
- 批量操作：勾选多条数据进行删除

**4. 数据处理**
- 数据展示：从数据库读取并分页展示
- 搜索：使用全文索引加速搜索
- 编辑：更新数据库记录
- 删除：软删除（标记为已删除，不物理删除）

**5. 验收标准**
- [ ] 能够流畅展示 10,000+ 条数据（分页）
- [ ] 搜索响应时间 < 1 秒
- [ ] 能够正确筛选和排序
- [ ] 能够成功编辑和保存
- [ ] 能够批量删除数据

**6. 边界情况**
- 无数据：显示"暂无数据，请先导入商品数据"
- 搜索无结果：显示"未找到匹配的商品"
- 编辑冲突：提示"数据已被修改，请刷新后重试"
- 删除确认：弹窗确认"确定删除选中的 X 条数据吗？"

---

#### REQ-003: 语义聚类分析

**需求描述**: 基于商品名称和描述进行语义聚类，自动分组相似商品

**功能详细说明**:

**1. 功能描述**
- 使用语义分析工具（Sentence Transformers）对商品进行向量化
- 使用聚类算法（HDBSCAN）自动分组
- 生成聚类结果，每个商品分配到一个簇
- 支持大批量数据（几千到十万级）

**2. 输入信息**
- 聚类数据源：已导入的商品数据
- 聚类参数（可选）：
  - min_cluster_size：最小簇大小（默认 15）
  - min_samples：最小样本数（默认 5）
- 聚类字段：商品名称 + 商品描述（拼接）

**3. 功能要求**
- 一键启动聚类分析
- 显示聚类进度（百分比）
- 聚类完成后显示结果统计：
  - 总簇数
  - 每个簇的大小
  - 噪音点数量（未分类的商品）
- 支持参数调优（高级用户）
- 支持重新聚类

**4. 数据处理**
- 向量化：使用 Sentence Transformers 模型（如 all-MiniLM-L6-v2）
- 聚类：使用 HDBSCAN 算法
- 结果存储：
  - 每个商品添加 cluster_id 字段
  - 生成簇级汇总表（cluster_summary）
- 缓存：缓存向量化结果，避免重复计算

**5. 验收标准**
- [ ] 能够对 10,000 条商品进行聚类
- [ ] 聚类时间 < 5 分钟（10,000 条）
- [ ] 生成 50-100 个有意义的簇
- [ ] 噪音比例 < 25%
- [ ] 簇内商品语义相似度高
- [ ] 能够查看聚类质量报告

**6. 边界情况**
- 数据量过少：提示"数据量不足 100 条，建议导入更多数据后再聚类"
- 聚类失败：提示错误信息，允许调整参数重试
- 内存不足：提示"数据量过大，请分批处理"
- 聚类结果不理想：提供参数调优建议

---

#### REQ-004: 需求分析（AI 辅助）

**需求描述**: 使用 DeepSeek API 分析每个簇的商品，识别满足的用户需求

**功能详细说明**:

**1. 功能描述**
- 对每个聚类簇调用 DeepSeek API
- 分析该簇商品满足的用户需求
- 生成需求描述（例如：项目管理、任务管理、时间管理等）
- 支持批量分析和单个簇分析

**2. 输入信息**
- 分析对象：聚类簇（cluster_id）
- 输入数据：簇内商品的名称和描述
- API 配置：DeepSeek API Key（从环境变量读取）

**3. 功能要求**
- 选择簇进行需求分析
- 支持批量分析（所有簇）
- 显示分析进度
- 生成需求描述（文本）
- 支持人工编辑和确认
- 保存分析结果

**4. 数据处理**
- API 调用：
  - 输入：簇内商品列表（名称 + 描述）
  - Prompt：分析这些商品满足的用户需求
  - 输出：需求描述（JSON 格式）
- 结果存储：
  - 在 cluster_summary 表中添加 demand_analysis 字段
- 错误处理：
  - API 调用失败：重试 3 次
  - 超时：跳过该簇，继续下一个

**5. 验收标准**
- [ ] 能够成功调用 DeepSeek API
- [ ] 生成的需求描述准确且有价值
- [ ] 单个簇分析时间 < 10 秒
- [ ] 批量分析支持断点续传
- [ ] 能够人工编辑和确认结果
- [ ] 能够查看分析历史

**6. 边界情况**
- API Key 未配置：提示"请先配置 DeepSeek API Key"
- API 调用失败：提示错误信息，允许重试
- API 额度不足：提示"API 额度不足，请充值"
- 簇内商品过多：只取前 50 个商品进行分析
- 分析结果为空：提示"AI 分析失败，请人工填写"

---

#### REQ-005: 交付产品识别（AI 辅助）

**需求描述**: 从商品名称和描述中自动识别交付产品的类型、格式和平台

**功能详细说明**:

**1. 功能描述**
- 使用 AI（DeepSeek API）分析商品描述
- 识别交付产品类型（Excel、PPT、模板、压缩包等）
- 识别具体格式（Excel 模板、PPT 模板、Notion 模板等）
- 识别交付平台（如果有）
- 支持批量识别和单个商品识别

**2. 输入信息**
- 识别对象：商品（product_id）或簇（cluster_id）
- 输入数据：商品名称 + 商品描述
- API 配置：DeepSeek API Key

**3. 功能要求**
- 选择商品或簇进行识别
- 支持批量识别（所有商品）
- 显示识别进度
- 生成结构化结果
- 支持人工编辑和确认
- 保存识别结果

**4. 数据处理**
- API 调用识别交付产品信息
- 结果存储到商品表
- 批量处理支持断点续传

**5. 验收标准**
- [ ] 能够准确识别交付产品类型
- [ ] 识别准确率 > 80%
- [ ] 单个商品识别时间 < 5 秒
- [ ] 批量识别支持断点续传
- [ ] 能够人工编辑和确认结果

**6. 边界情况**
- 描述信息不足：标记为"未知"
- API 调用失败：重试后跳过
- 识别结果不确定：标记为"待确认"

---

#### REQ-006: 聚类结果展示

**需求描述**: 以直观的方式展示聚类结果和分析结果

**功能详细说明**:

**1. 功能描述**
- 展示所有聚类簇
- 展示每个簇的统计信息
- 展示需求分析和交付产品信息
- 支持查看簇内商品详情

**2. 输入信息**
- 筛选条件：簇大小范围、是否已分析
- 搜索关键词：需求关键词、交付产品类型

**3. 功能要求**
- 簇列表展示
- 簇详情查看
- 支持筛选和搜索
- 支持导出簇级汇总

**4. 数据处理**
- 从 cluster_summary 表读取数据
- 统计计算和分页展示

**5. 验收标准**
- [ ] 能够清晰展示所有簇
- [ ] 能够查看簇详情
- [ ] 页面加载时间 < 2 秒

**6. 边界情况**
- 未聚类：提示"请先进行聚类分析"
- 无搜索结果：显示"未找到匹配的簇"

---

#### REQ-007: 数据导出功能

**需求描述**: 支持导出各阶段的数据结果

**功能详细说明**:

**1. 功能描述**
- 导出原始商品数据
- 导出聚类结果
- 导出簇级汇总
- 支持 CSV、Excel 格式

**2. 输入信息**
- 导出类型：原始数据、聚类结果、簇级汇总
- 导出格式：CSV、Excel

**3. 功能要求**
- 选择导出类型和格式
- 点击导出生成文件
- 下载文件到本地

**4. 数据处理**
- 数据查询和格式转换
- 文件生成和下载

**5. 验收标准**
- [ ] 能够导出所有类型的数据
- [ ] 导出时间 < 30 秒（10,000 条）

**6. 边界情况**
- 无数据：提示"暂无数据可导出"
- 数据量过大：提示"建议分批导出"

---

## 📊 数据字段规范

### 商品表（products）

| 字段名 | 类型 | 必需 | 说明 |
|--------|------|------|------|
| product_id | int | ✅ | 商品 ID |
| product_name | string | ✅ | 商品名称 |
| product_description | text | ✅ | 商品描述 |
| rating | float | ❌ | 评分 |
| review_count | int | ❌ | 评价数量 |
| price | float | ❌ | 价格 |
| shop_name | string | ❌ | 店铺名称 |
| cluster_id | int | ❌ | 簇 ID |
| delivery_type | string | ❌ | 交付类型 |
| delivery_format | string | ❌ | 交付格式 |
| delivery_platform | string | ❌ | 交付平台 |
| import_time | datetime | ✅ | 导入时间 |
| is_deleted | boolean | ✅ | 是否删除 |

---

## 🎯 成功标准

### 功能完整性
- ✅ 所有 P0 需求已实现（7 个核心功能）

### 性能指标
- ✅ 数据导入时间 < 30 秒（10,000 条）
- ✅ 聚类分析时间 < 5 分钟（10,000 条）
- ✅ 页面加载时间 < 2 秒

---

## 🚀 实施计划

### Phase 1: 基础功能（第 1-2 周）
1. REQ-001: 数据导入功能
2. REQ-002: 数据管理功能
3. REQ-007: 数据导出功能

### Phase 2: 核心分析（第 3-4 周）
1. REQ-003: 语义聚类分析
2. REQ-006: 聚类结果展示

### Phase 3: AI 增强（第 5-6 周）
1. REQ-004: 需求分析
2. REQ-005: 交付产品识别

---

## 📝 技术约束

### 技术栈
- 前端: Vue 3 + TypeScript + Element Plus
- 后端: FastAPI + Python 3.11
- 数据库: SQLite / PostgreSQL
- AI: DeepSeek API
- 聚类: Sentence Transformers + HDBSCAN

### 性能约束
- 支持最多 100,000 条商品数据
- 聚类时间 < 10 分钟（100,000 条）

### 资源约束
- 开发人员: 1 人
- 开发时间: 6-8 周

---

## 🔄 需求变更记录

### v2.0 (2026-01-27)
- 项目重构
- 聚焦商品管理模块
- 定义 7 个核心功能
- 预留长尾词和 Reddit 模块

---

*文档创建者: Claude Sonnet 4.5*
*最后更新: 2026-01-27*
