# Phase 0 配置自动保存功能说明

## 功能概述

Phase 0（关键词扩展与分词工具）现在支持**自动保存所有操作配置**，避免每次使用时重复设置参数。

## 保存的配置项

### 1. 分词配置 (segmentation)
- **最小频次** (`min_frequency`): 单词最小出现次数，默认值：2
- **短语最小频次** (`min_ngram_frequency`): 短语最小出现次数，默认值：3
- **排序方式** (`sort_by`): 'frequency'（按频次）、'alphabetical'（按字母）、'length'（按长度），默认：'frequency'
- **启用词性标注** (`enable_pos_tagging`): 是否使用NLTK进行词性标注，默认：true
- **提取短语** (`extract_ngrams`): 是否提取n-gram短语，默认：true

### 2. 筛选配置 (filtering)
- **排除词根** (`exclude_seeds`): 是否仅显示非词根token，默认：false
- **选中的词性** (`selected_pos`): 词性筛选列表，默认：[]（不筛选）

### 3. 翻译配置 (translation)
- **启用翻译** (`translate_enabled`): 是否显示中文翻译，默认：false

### 4. 导出配置 (export)
- **仅导出选中** (`export_selected_only`): 是否仅导出选中的token，默认：false

## 使用方法

### 自动保存
所有配置在您修改后会**自动保存**到本地文件（`config/phase0_preferences.json`），无需手动操作。

例如：
1. 您将"最小频次"从2改为10
2. 系统自动保存该配置
3. 下次打开页面时，"最小频次"默认值自动变为10

### 查看配置状态
在页面顶部点击 **"⚙️ 配置管理"** 展开区域，可以看到：
- 配置最后更新时间
- 重置为默认配置按钮

### 重置配置
如果想恢复默认设置：
1. 展开 **"⚙️ 配置管理"** 区域
2. 点击 **"🔄 重置为默认配置"** 按钮
3. 所有参数恢复为初始默认值

## 配置文件位置

```
项目根目录/
└── config/
    └── phase0_preferences.json  # 配置文件（自动生成）
```

**注意**：该文件已加入 `.gitignore`，不会被提交到Git仓库，确保每个用户可以有自己的个人配置。

## 配置文件示例

```json
{
  "segmentation": {
    "min_frequency": 10,
    "min_ngram_frequency": 6,
    "sort_by": "frequency",
    "enable_pos_tagging": true,
    "extract_ngrams": true
  },
  "filtering": {
    "freq_range": null,
    "selected_word_counts": null,
    "selected_pos": [],
    "exclude_seeds": false
  },
  "translation": {
    "translate_enabled": true
  },
  "export": {
    "export_selected_only": false
  },
  "last_updated": "2025-12-25T11:26:58.691250"
}
```

## 常见问题

### Q: 配置会在关闭浏览器后丢失吗？
A: **不会**。配置保存在本地JSON文件中，关闭浏览器、重启电脑后仍然保留。

### Q: 配置会影响其他用户吗？
A: **不会**。每个用户（每台机器）的配置是独立的，保存在本地文件系统中。

### Q: 可以手动编辑配置文件吗？
A: **可以**。您可以直接编辑 `config/phase0_preferences.json` 文件，修改后刷新页面即可生效。但建议通过界面操作，更安全。

### Q: 如果配置文件损坏了怎么办？
A: 删除 `config/phase0_preferences.json` 文件，系统会自动生成默认配置。或者点击界面上的"重置为默认配置"按钮。

### Q: 哪些参数不会保存？
A: 动态的筛选参数不会保存，例如：
- 频次范围滑块（因为每次数据不同，频次范围会变化）
- 选中的词数筛选（动态依赖当前数据）
- 已选中的token列表（不需要跨会话保存）

这些参数每次都会根据实际数据重新设置。

## 技术实现

### 核心模块
- `utils/user_preferences.py`: 配置管理模块
  - `UserPreferences`: 配置管理类
  - `load_phase0_preferences()`: 加载配置
  - `update_phase0_preference()`: 更新单个配置项
  - `get_preferences_manager()`: 获取管理器单例

### 保存时机
配置在以下时机自动保存：
1. 用户修改输入框值（如最小频次）
2. 用户勾选/取消勾选复选框（如启用翻译）
3. 用户更改下拉菜单选项（如排序方式）

### 加载时机
配置在以下时机自动加载：
1. 页面首次打开时
2. 点击"重置为默认配置"后
3. 每次配置更新后（刷新缓存）

## 未来改进

- [ ] 支持多套配置预设（如"高质量筛选"、"全面分析"等）
- [ ] 配置导入/导出功能（分享配置给团队）
- [ ] 配置历史版本管理
- [ ] 更多细粒度的配置项

## 反馈

如有任何问题或建议，欢迎反馈！
