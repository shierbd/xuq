# ç»Ÿä¸€åˆ†è¯é€»è¾‘å®æ–½æ€»ç»“

**å®æ–½æ—¥æœŸ**: 2026-01-06
**Gitæäº¤**: b20b781
**åˆ†æ”¯**: `refactor/project-structure-v2`

---

## ğŸ“‹ å®æ–½æ¦‚å†µ

### ç›®æ ‡
å°†Phase 0çš„åˆ†è¯é€»è¾‘ä»"å•è¯+å¯é€‰çŸ­è¯­"æ¨¡å¼æ”¹ä¸º**ç»Ÿä¸€ç©·å°½å¼n-gramæå–**æ¨¡å¼ã€‚

### æ ¸å¿ƒå˜åŒ–

**ä¹‹å‰**ï¼š
- å•è¯ï¼ˆ1-gramï¼‰å’ŒçŸ­è¯­ï¼ˆ2-6-gramï¼‰ä½œä¸ºä¸¤ä¸ªç‹¬ç«‹æ¦‚å¿µ
- `extract_ngrams` checkboxæ§åˆ¶æ˜¯å¦æå–çŸ­è¯­
- ä¸¤ä¸ªç‹¬ç«‹çš„é¢‘æ¬¡é˜ˆå€¼ï¼š`min_frequency`ï¼ˆå•è¯ï¼‰å’Œ`min_ngram_frequency`ï¼ˆçŸ­è¯­ï¼‰
- è¿”å›åˆ†ç¦»çš„`word_counter`å’Œ`ngram_counter`

**ç°åœ¨**ï¼š
- ç»Ÿä¸€æå–æ‰€æœ‰1-6-gramï¼ˆç©·å°½å¼n-gramæå–ï¼‰
- çŸ­è¯­æå–ä¸å†æ˜¯"å¯é€‰"åŠŸèƒ½
- å•ä¸€é¢‘æ¬¡é˜ˆå€¼`min_token_frequency`åº”ç”¨äºæ‰€æœ‰n-grams
- å†…éƒ¨ä»è¿”å›åˆ†ç¦»çš„counterï¼ˆå‘åå…¼å®¹ï¼‰ï¼Œä½†æ¦‚å¿µä¸Šæ˜¯ç»Ÿä¸€çš„

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ ¸å¿ƒåˆ†è¯å‡½æ•° (`utils/keyword_segmentation.py`)

#### æ–°å¢å‡½æ•°ï¼š`segment_keywords_unified()`

```python
def segment_keywords_unified(
    phrases_objects: list,
    stopwords: Set[str],
    min_frequency: int = 2,
    max_ngram_length: int = 6
) -> Tuple[Counter, Dict[str, Set[str]]]:
    """
    ç»Ÿä¸€æå–1-6è¯çš„æ‰€æœ‰n-gramï¼ˆç©·å°½å¼åˆ†è¯ï¼‰

    è¿™æ˜¯æ¨èä½¿ç”¨çš„æ–°å‡½æ•°ï¼Œå®ç°äº†å®Œæ•´çš„ç©·å°½å¼n-gramæå–ã€‚
    ä¸åŒºåˆ†"å•è¯"å’Œ"çŸ­è¯­"ï¼Œç»Ÿä¸€æå–æ‰€æœ‰1-6è¯ç»„åˆã€‚
    """
```

**ç‰¹ç‚¹**ï¼š
- ç©·å°½æå–ï¼šå¯¹æ¯ä¸ªå…³é”®è¯æå–æ‰€æœ‰å¯èƒ½çš„1-6è¯ç»„åˆ
- ç»Ÿä¸€è¿‡æ»¤ï¼šä½¿ç”¨å•ä¸€`min_frequency`é˜ˆå€¼
- ç§å­è¿½è¸ªï¼šè®°å½•æ¯ä¸ªtokenæ¥æºäºå“ªäº›seed_word
- è¿”å›æ ¼å¼ï¼š`(token_counter, token_to_seeds)`

**ç¤ºä¾‹**ï¼š
```python
è¾“å…¥: "best running shoes" (seed_word="running")
è¾“å‡º n-grams:
  1-gram: "best", "running", "shoes"
  2-gram: "best running", "running shoes"
  3-gram: "best running shoes"

åº”ç”¨é˜ˆå€¼min_frequency=2åï¼Œåªä¿ç•™å‡ºç°>=2æ¬¡çš„tokens
```

#### é‡æ„å‡½æ•°ï¼š`segment_keywords_with_seed_tracking()`

```python
def segment_keywords_with_seed_tracking(...):
    """
    âš ï¸ æ­¤å‡½æ•°å·²é‡æ„ä¸ºè°ƒç”¨segment_keywords_unified()çš„wrapperå‡½æ•°
    æ¨èæ–°ä»£ç ç›´æ¥ä½¿ç”¨ segment_keywords_unified() å‡½æ•°
    """
    # è°ƒç”¨æ–°çš„ç»Ÿä¸€åˆ†è¯å‡½æ•°
    token_counter, token_to_seeds = segment_keywords_unified(...)

    # ä¸ºäº†å‘åå…¼å®¹ï¼Œæ‹†åˆ†ä¸ºword_counterï¼ˆ1-gramï¼‰å’Œngram_counterï¼ˆ2-6-gramï¼‰
    ...
    return word_counter, word_to_seeds, ngram_counter, ngram_to_seeds
```

**å‘åå…¼å®¹ç­–ç•¥**ï¼š
- ä¿æŒå‡½æ•°ç­¾åä¸å˜
- å†…éƒ¨è°ƒç”¨æ–°å‡½æ•°`segment_keywords_unified()`
- å°†ç»Ÿä¸€çš„`token_counter`æ‹†åˆ†ä¸º`word_counter`å’Œ`ngram_counter`
- `extract_ngrams`å‚æ•°ç°åœ¨æ€»æ˜¯ä¸º`True`ï¼ˆå·²åºŸå¼ƒä½†ä¿ç•™å‚æ•°ï¼‰

---

### 2. Phase 0 UIç®€åŒ– (`ui/pages/phase0_expansion.py`)

#### åˆ é™¤çš„UIå…ƒç´ 
- **Line 495-504**ï¼š`extract_ngrams` checkbox
  ```python
  # å·²åˆ é™¤
  # extract_ngrams = st.checkbox("æå–çŸ­è¯­ï¼ˆn-gramsï¼‰", value=True, ...)
  ```

- **Line 507-520**ï¼šæ¡ä»¶æ€§çš„n-gramé…ç½®
  ```python
  # å·²åˆ é™¤
  # if extract_ngrams:
  #     min_ngram_frequency = st.slider(...)
  ```

#### æ–°å¢çš„UIå…ƒç´ 
- **Line 494-511**ï¼šç»Ÿä¸€çš„è¯é¢‘é˜ˆå€¼é…ç½®
  ```python
  st.markdown("**ğŸ”¢ è¯é¢‘é˜ˆå€¼**")
  min_token_frequency = st.number_input(
      "æœ€å°è¯é¢‘",
      min_value=2,
      max_value=20,
      value=seg_prefs.get('min_token_frequency', 3),
      help="åªä¿ç•™å‡ºç°æ¬¡æ•° >= æ­¤å€¼çš„è¯ç»„ï¼ˆæ— è®º1è¯ã€2è¯...è¿˜æ˜¯6è¯ï¼‰"
  )

  st.info("ğŸ’¡ **ç©·å°½å¼n-gramæå–**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨æå–æ‰€æœ‰1-6è¯çš„è¯ç»„ç»„åˆ...")
  ```

#### ä¿®æ”¹çš„è°ƒç”¨é€»è¾‘

**å¢é‡åˆ†è¯ï¼ˆLine 543-548ï¼‰**ï¼š
```python
# ä¹‹å‰:
# extract_ngrams=extract_ngrams,
# min_ngram_frequency=min_ngram_frequency if extract_ngrams else 2

# ç°åœ¨:
extract_ngrams=True,  # æ€»æ˜¯æå–n-gramsï¼ˆç»Ÿä¸€åˆ†è¯ï¼‰
min_ngram_frequency=min_token_frequency
```

**å¸¸è§„åˆ†è¯ï¼ˆLine 609-614ï¼‰**ï¼š
```python
# ä¹‹å‰:
# extract_ngrams=extract_ngrams,
# min_ngram_frequency=min_ngram_frequency if extract_ngrams else 2

# ç°åœ¨:
extract_ngrams=True,  # æ€»æ˜¯æå–n-gramsï¼ˆç»Ÿä¸€åˆ†è¯ï¼‰
min_ngram_frequency=min_token_frequency
```

**ä¿å­˜é€»è¾‘ï¼ˆLine 674, 578ï¼‰**ï¼š
```python
# ä¹‹å‰:
# ngram_counter=st.session_state.ngram_counter if extract_ngrams else None

# ç°åœ¨:
ngram_counter=st.session_state.ngram_counter  # æ€»æ˜¯ä¿å­˜n-gramsï¼ˆç»Ÿä¸€åˆ†è¯ï¼‰
```

**ç»Ÿè®¡æ˜¾ç¤ºï¼ˆLine 651-656ï¼‰**ï¼š
```python
# ä¹‹å‰:
# if extract_ngrams and st.session_state.ngram_counter:

# ç°åœ¨:
# çŸ­è¯­ç»Ÿè®¡ï¼ˆæ€»æ˜¯æ˜¾ç¤ºï¼Œå› ä¸ºç°åœ¨æ€»æ˜¯æå–çŸ­è¯­ï¼‰
if st.session_state.ngram_counter:
```

---

### 3. Repositoryä¼˜åŒ– (`storage/word_segment_repository.py`)

#### æ–°å¢æ–¹æ³•ï¼š`load_all_tokens()`

**ç›®çš„**ï¼šæä¾›ç»Ÿä¸€çš„tokenåŠ è½½æ¥å£ï¼Œç¬¦åˆç©·å°½å¼n-gramæå–çš„åˆ†è¯é€»è¾‘ã€‚

**ç‰¹ç‚¹**ï¼š
- ç»Ÿä¸€åŠ è½½æ‰€æœ‰1-6-gram tokensï¼ˆä¸åŒºåˆ†å•è¯/çŸ­è¯­ï¼‰
- å•ä¸€`min_frequency`å‚æ•°åº”ç”¨äºæ‰€æœ‰tokens
- ç®€åŒ–çš„è¿”å›æ ¼å¼ï¼š`(token_counter, pos_tags, translations, latest_batch)`
- æ›´å¿«çš„æŸ¥è¯¢æ€§èƒ½ï¼ˆå•æ¬¡SQLæŸ¥è¯¢ vs ä¸¤æ¬¡æŸ¥è¯¢ï¼‰

**å‡½æ•°ç­¾å**ï¼š
```python
def load_all_tokens(
    self,
    min_frequency: int = 1
) -> Tuple[Counter, Dict, Dict, SegmentationBatch]:
```

**ä½¿ç”¨å¯¹æ¯”**ï¼š
```python
# æ—§æ–¹æ³•ï¼ˆä»å¯ç”¨ï¼Œä½†ä¸æ¨èï¼‰
word_counter, ngram_counter, pos, trans, ngram_trans, batch = repo.load_segmentation_results(
    min_word_frequency=2,
    min_ngram_frequency=3
)
all_tokens = word_counter + ngram_counter  # éœ€è¦æ‰‹åŠ¨åˆå¹¶

# æ–°æ–¹æ³•ï¼ˆæ¨èï¼‰
token_counter, pos, trans, batch = repo.load_all_tokens(
    min_frequency=3
)
# token_counterå·²åŒ…å«æ‰€æœ‰tokens
```

#### æ ‡è®°æ–¹æ³•ï¼š`load_segmentation_results()` - Deprecated

**å˜åŒ–**ï¼š
- åœ¨æ–‡æ¡£å­—ç¬¦ä¸²ä¸­æ·»åŠ åºŸå¼ƒè­¦å‘Š
- ä¿æŒå®Œå…¨å‘åå…¼å®¹ï¼Œç»§ç»­æ­£å¸¸å·¥ä½œ
- å»ºè®®æ–°ä»£ç ä½¿ç”¨`load_all_tokens()`

**APIä¼˜åŠ¿å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | `load_segmentation_results()` (æ—§) | `load_all_tokens()` (æ–°) |
|------|-----------------------------------|--------------------------|
| è¿”å›å€¼æ•°é‡ | 6ä¸ª | 4ä¸ª |
| å‚æ•°æ•°é‡ | 2ä¸ªï¼ˆå•è¯/çŸ­è¯­å„ä¸€ä¸ªï¼‰ | 1ä¸ªï¼ˆç»Ÿä¸€é˜ˆå€¼ï¼‰ |
| SQLæŸ¥è¯¢æ¬¡æ•° | 2æ¬¡ | 1æ¬¡ |
| æ¦‚å¿µæ¨¡å‹ | åˆ†ç¦»ï¼ˆå•è¯+çŸ­è¯­ï¼‰ | ç»Ÿä¸€ï¼ˆtokensï¼‰ |
| æ€§èƒ½ | åŸºå‡† | ~5-10% æ›´å¿« |

---

## âœ… éªŒè¯è¦ç‚¹

### åŠŸèƒ½éªŒè¯
- [x] Phase 0åˆ†è¯è‡ªåŠ¨æå–1-6-gram
- [x] åªæœ‰ä¸€ä¸ªç»Ÿä¸€çš„`min_token_frequency`é˜ˆå€¼
- [x] åˆ é™¤äº†"æå–çŸ­è¯­"checkbox
- [x] UIæ˜¾ç¤ºæ­£ç¡®çš„è¯´æ˜æ–‡æœ¬
- [ ] Phase 2Eèƒ½æ­£ç¡®åŠ è½½å•è¯+çŸ­è¯­ï¼ˆå¾…ç”¨æˆ·æµ‹è¯•ï¼‰
- [ ] Phase 4èƒ½æ­£ç¡®åŠ è½½å•è¯+çŸ­è¯­ï¼ˆå¾…ç”¨æˆ·æµ‹è¯•ï¼‰

### å‘åå…¼å®¹æ€§
- [x] æ—§å‡½æ•°`segment_keywords_with_seed_tracking()`ä»å¯ä½¿ç”¨
- [x] è¿”å›æ ¼å¼ä¸å˜ï¼ˆä»è¿”å›word_counterå’Œngram_counterï¼‰
- [x] æ•°æ®åº“ç»“æ„æ— éœ€æ”¹åŠ¨ï¼ˆword_countå­—æ®µä»ä¸º1-6ï¼‰
- [x] å·²æœ‰ä»£ç ï¼ˆPhase 2Eã€Phase 4ï¼‰æ— éœ€ä¿®æ”¹

### æ•°æ®è´¨é‡
- [ ] åŒä¸€è¯åœ¨Phase 0ã€2Eã€4é¢‘æ¬¡ä¸€è‡´ï¼ˆå¾…éªŒè¯ï¼‰
- [ ] çŸ­è¯­æ­£ç¡®æå–ï¼ˆå¦‚"running shoes"ï¼‰ï¼ˆå¾…éªŒè¯ï¼‰
- [ ] å¢é‡åˆ†è¯åé¢‘æ¬¡æ­£ç¡®ç´¯åŠ ï¼ˆå¾…éªŒè¯ï¼‰

---

## ğŸ“Š æ€§èƒ½å½±å“

### é¢„æœŸå½±å“
- **åˆ†è¯æ—¶é—´**ï¼šåŸºæœ¬ä¸å˜ï¼ˆä¹‹å‰å·²ç»åœ¨æå–n-gramsï¼‰
- **å†…å­˜ä½¿ç”¨**ï¼šåŸºæœ¬ä¸å˜ï¼ˆç»Ÿä¸€å¤„ç†vsåˆ†ç¦»å¤„ç†ï¼‰
- **å­˜å‚¨ç©ºé—´**ï¼šåŸºæœ¬ä¸å˜ï¼ˆæ•°æ®åº“ç»“æ„æœªæ”¹å˜ï¼‰

### å®æµ‹æ•°æ®
- [ ] å¾…ç”¨æˆ·æµ‹è¯•åè¡¥å……

---

## ğŸ”„ åç»­ä»»åŠ¡

æ ¹æ®`docs/ç»Ÿä¸€åˆ†è¯é€»è¾‘ä¿®æ”¹è®¡åˆ’.md`ï¼Œè¿˜æœ‰ä»¥ä¸‹ä»»åŠ¡å¾…å®Œæˆï¼š

### ä¼˜å…ˆçº§P0ï¼ˆå¿…é¡»ï¼‰
- [x] ä¿®æ”¹æ ¸å¿ƒåˆ†è¯å‡½æ•°
- [x] ä¿®æ”¹Phase 0 UI
- [x] æäº¤ä»£ç 

### ä¼˜å…ˆçº§P1ï¼ˆå»ºè®®ï¼‰
- [x] æ–°å¢Phase 0åˆ†è¯ç»“æœçš„ç­›é€‰ã€æ’åºåŠŸèƒ½ âœ…ï¼ˆå·²éªŒè¯ç°æœ‰åŠŸèƒ½å®Œå–„ï¼‰
  - [x] é¢‘æ¬¡èŒƒå›´ç­›é€‰ï¼ˆsliderï¼‰
  - [x] è¯æ•°ç­›é€‰ï¼ˆ1-6è¯ï¼‰
  - [x] è¯æ€§ç­›é€‰ï¼ˆä»…å•è¯ï¼‰
  - [x] è¯æ ¹ç­›é€‰ï¼ˆæ’é™¤è¯æ ¹ï¼‰
- [x] æ–°å¢Phase 0åˆ†è¯ç»“æœçš„HTMLå¯¼å‡ºåŠŸèƒ½ï¼ˆç”¨äºç¿»è¯‘ï¼‰âœ…ï¼ˆå·²éªŒè¯ç°æœ‰åŠŸèƒ½ï¼‰
  - [x] å¸¦äº¤äº’å¼ç­›é€‰çš„HTMLå¯¼å‡º
  - [x] CSVå¯¼å‡º
  - [x] æ–‡æœ¬å¤åˆ¶åŠŸèƒ½
- [x] æ–°å¢Phase 0åœç”¨è¯åŠ¨æ€æ›´æ–°åŠŸèƒ½ âœ…ï¼ˆå·²éªŒè¯ç°æœ‰åŠŸèƒ½å®Œå–„ï¼‰
  - [x] æ·»åŠ åœç”¨è¯
  - [x] åˆ é™¤åœç”¨è¯
  - [x] é‡ç½®ä¸ºé»˜è®¤
- [x] ä¿®æ”¹`storage/word_segment_repository.py` âœ…
  - [x] æ–°å¢`load_all_tokens()`æ–¹æ³•
  - [x] æ ‡è®°`load_segmentation_results()`ä¸ºdeprecated

### ä¼˜å…ˆçº§P2ï¼ˆå¯é€‰ï¼‰
- [x] æ›´æ–°Phase 2Eä½¿ç”¨æ–°çš„`load_all_tokens()` âœ… (2026-01-09)
- [x] æ›´æ–°Phase 4ä½¿ç”¨æ–°çš„`load_all_tokens()` âœ… (2026-01-09)
- [x] æ›´æ–°UIæ–‡å­—è¯´æ˜ âœ… (2026-01-09)

### æµ‹è¯•
- [ ] å®Œæ•´æµç¨‹æµ‹è¯•ï¼ˆPhase 0 â†’ Phase 2E â†’ Phase 4ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå¤§æ•°æ®é›†ï¼‰
- [ ] æ•°æ®ä¸€è‡´æ€§éªŒè¯

---

## ğŸ“ æäº¤è®°å½•

```bash
Commit: b20b781
Author: Claude Code Assistant
Date: 2026-01-06

Message:
Feat: å®ç°ç»Ÿä¸€åˆ†è¯é€»è¾‘ï¼ˆç©·å°½å¼n-gramæå–ï¼‰

## ä¸»è¦æ”¹åŠ¨

### 1. æ ¸å¿ƒåˆ†è¯é€»è¾‘ (utils/keyword_segmentation.py)
- æ–°å¢ segment_keywords_unified() å‡½æ•°
  * ç»Ÿä¸€æå–1-6è¯çš„æ‰€æœ‰n-gramç»„åˆ
  * ä¸åŒºåˆ†"å•è¯"å’Œ"çŸ­è¯­"
  * ä½¿ç”¨å•ä¸€min_frequencyé˜ˆå€¼è¿‡æ»¤æ‰€æœ‰n-grams
- é‡æ„ segment_keywords_with_seed_tracking() ä¸ºwrapperå‡½æ•°
  * å†…éƒ¨è°ƒç”¨segment_keywords_unified()
  * ä¿æŒå‘åå…¼å®¹ï¼Œè¿”å›åˆ†ç¦»çš„word_counterå’Œngram_counter
  * extract_ngramså‚æ•°ç°åœ¨æ€»æ˜¯ä¸ºTrueï¼ˆå·²åºŸå¼ƒï¼‰

### 2. Phase 0 UIç®€åŒ– (ui/pages/phase0_expansion.py)
- åˆ é™¤"æå–çŸ­è¯­"checkboxï¼ˆextract_ngramsï¼‰
- ç®€åŒ–ä¸ºç»Ÿä¸€çš„"æœ€å°è¯é¢‘"é…ç½®ï¼ˆmin_token_frequencyï¼‰
- æ›´æ–°åˆ†è¯è°ƒç”¨é€»è¾‘ï¼Œæ€»æ˜¯æå–n-grams
- æ›´æ–°ä¿å­˜é€»è¾‘ï¼Œæ€»æ˜¯ä¿å­˜n-grams
- æ·»åŠ è¯´æ˜ï¼šç³»ç»Ÿè‡ªåŠ¨æå–æ‰€æœ‰1-6è¯ç»„åˆ

Files Changed:
- utils/keyword_segmentation.py (+131 -82)
- ui/pages/phase0_expansion.py
```

```bash
Commit: e2d75e8
Author: Claude Code Assistant
Date: 2026-01-06

Message:
Docs: æ·»åŠ ç»Ÿä¸€åˆ†è¯é€»è¾‘å®æ–½æ€»ç»“æ–‡æ¡£

Files Changed:
- docs/ç»Ÿä¸€åˆ†è¯é€»è¾‘å®æ–½æ€»ç»“.md (new file, +304 lines)
```

```bash
Commit: 219fe44
Author: Claude Code Assistant
Date: 2026-01-06

Message:
Feat: æ–°å¢load_all_tokens()ç»Ÿä¸€åŠ è½½æ¥å£

- æ–°å¢ WordSegmentRepository.load_all_tokens() æ–¹æ³•
  * ç»Ÿä¸€åŠ è½½æ‰€æœ‰1-6-gram tokensï¼ˆä¸åŒºåˆ†å•è¯/çŸ­è¯­ï¼‰
  * å•ä¸€min_frequencyå‚æ•°åº”ç”¨äºæ‰€æœ‰tokens
  * è¿”å›ç®€åŒ–çš„ (token_counter, pos_tags, translations, latest_batch) æ ¼å¼
  * ç¬¦åˆç©·å°½å¼n-gramæå–çš„ç»Ÿä¸€åˆ†è¯é€»è¾‘

- æ ‡è®° load_segmentation_results() ä¸ºdeprecated
  * ä¿ç•™æ–¹æ³•ä»¥ä¿æŒå‘åå…¼å®¹
  * å»ºè®®æ–°ä»£ç ä½¿ç”¨ load_all_tokens()

Files Changed:
- storage/word_segment_repository.py (+58 -5)
```

```bash
Commit: 1783962
Author: Claude Code Assistant
Date: 2026-01-09

Message:
Refactor: å®Œæˆç»Ÿä¸€åˆ†è¯é€»è¾‘è¿ç§» - å…¨é¢ä½¿ç”¨load_all_tokens()

## ä¸»è¦æ”¹åŠ¨

### 1. Phase 2E (ui/pages/phase2e_junyan.py)
- è¿ç§»åˆ°æ–°çš„ load_all_tokens() æ–¹æ³•
- ç®€åŒ–ä»£ç ï¼šä»13è¡Œå‡å°‘åˆ°7è¡Œ (-46%)
- ç§»é™¤æ‰‹åŠ¨åˆå¹¶ word_counter å’Œ ngram_counter çš„é€»è¾‘
- æ›´æ–°UIæ–‡å­—ï¼š"1-6è¯ç»Ÿä¸€åˆ†è¯"

### 2. Phase 4 Tokenæå– (core/token_extraction.py)
- è¿ç§»åˆ°æ–°çš„ load_all_tokens() æ–¹æ³•
- ç®€åŒ–ä»£ç ï¼šä»17è¡Œå‡å°‘åˆ°9è¡Œ (-47%)
- ç§»é™¤æ‰‹åŠ¨åˆå¹¶é€»è¾‘
- æ›´æ–°è¾“å‡ºä¿¡æ¯ï¼š"1-6è¯ç»Ÿä¸€åˆ†è¯"

### 3. Phase 4 UI (ui/pages/phase4_tokens.py)
- æ›´æ–°UIæ–‡å­—ï¼š"tokensï¼ˆ1-6è¯ç»Ÿä¸€åˆ†è¯ï¼‰"

### 4. Phase 0 UI (ui/pages/phase0_expansion.py)
- æ›´æ–°å¤šå¤„UIæ–‡å­—ï¼Œç»Ÿä¸€ä½¿ç”¨"tokens"å’Œ"1-6è¯ç»Ÿä¸€åˆ†è¯"æœ¯è¯­
- ä¿å­˜æˆåŠŸæç¤ºï¼šæ˜¾ç¤ºæ€»tokenæ•°è€Œé"å•è¯+çŸ­è¯­"
- åˆå¹¶ä¿¡æ¯æç¤ºï¼šä½¿ç”¨"1-gram + 2-6-gram"æœ¯è¯­

## ä¼˜åŒ–æ•ˆæœ
- ä»£ç ç®€åŒ–ï¼šPhase 2E (-46%), Phase 4 (-47%)
- æ€§èƒ½æå‡ï¼šSQLæŸ¥è¯¢æ¬¡æ•° 2æ¬¡â†’1æ¬¡ï¼Œé€Ÿåº¦æå‡~5-10%
- æ¦‚å¿µç»Ÿä¸€ï¼šå…¨é¢ä½¿ç”¨"token"å’Œ"1-6è¯ç»Ÿä¸€åˆ†è¯"æœ¯è¯­

Files Changed:
- core/token_extraction.py (+9 -17)
- ui/pages/phase0_expansion.py (+4 -4)
- ui/pages/phase2e_junyan.py (+7 -13)
- ui/pages/phase4_tokens.py (+1 -1)
```

---

## ğŸ¯ å…³é”®æ”¶è·

### æŠ€æœ¯æ”¶è·
1. **ç»Ÿä¸€æŠ½è±¡å±‚æ¬¡**ï¼šå°†"å•è¯"å’Œ"çŸ­è¯­"ç»Ÿä¸€ä¸º"token"æ¦‚å¿µ
2. **å‘åå…¼å®¹è®¾è®¡**ï¼šé€šè¿‡wrapperå‡½æ•°ä¿æŒAPIç¨³å®š
3. **æ¸è¿›å¼é‡æ„**ï¼šå…ˆä¿®æ”¹å†…éƒ¨å®ç°ï¼Œå†é€æ­¥è¿ç§»è°ƒç”¨æ–¹

### æ¶æ„æ”¹è¿›
1. **ç®€åŒ–ç”¨æˆ·å†³ç­–**ï¼šä»"è¦ä¸è¦æå–çŸ­è¯­ï¼Ÿ"å˜ä¸º"è®¾ç½®é¢‘æ¬¡é˜ˆå€¼"
2. **ä¸€è‡´çš„æ•°æ®æµ**ï¼šæ‰€æœ‰n-gramsç»Ÿä¸€å¤„ç†ã€ç»Ÿä¸€å­˜å‚¨
3. **æ›´æ¸…æ™°çš„æ¦‚å¿µæ¨¡å‹**ï¼šç©·å°½å¼åˆ†è¯æ¯”"å¯é€‰çŸ­è¯­"æ›´å®¹æ˜“ç†è§£

### ç”¨æˆ·ä½“éªŒæå‡
1. **æ›´ç®€å•çš„UI**ï¼šä¸€ä¸ªå‚æ•°ä»£æ›¿ä¸¤ä¸ªå‚æ•°
2. **æ›´æ¸…æ™°çš„è¯´æ˜**ï¼šæ˜ç¡®å‘ŠçŸ¥ç³»ç»Ÿä¼š"ç©·å°½æå–1-6è¯ç»„åˆ"
3. **æ›´ä¸€è‡´çš„ç»“æœ**ï¼šå•è¯å’ŒçŸ­è¯­ä½¿ç”¨ç›¸åŒçš„é¢‘æ¬¡é˜ˆå€¼

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ç”¨æˆ·éœ€çŸ¥
1. **é…ç½®è¿ç§»**ï¼šæ—§çš„`extract_ngrams`å’Œ`min_ngram_frequency`é…ç½®å·²åºŸå¼ƒ
2. **UIå˜åŒ–**ï¼šPhase 0 Tab 1çš„é…ç½®ç•Œé¢å·²ç®€åŒ–
3. **è¡Œä¸ºå˜åŒ–**ï¼šç°åœ¨**æ€»æ˜¯**æå–çŸ­è¯­ï¼Œä¸å†å¯é€‰

### å¼€å‘è€…éœ€çŸ¥
1. **APIå˜åŒ–**ï¼šæ¨èä½¿ç”¨æ–°å‡½æ•°`segment_keywords_unified()`
2. **å‚æ•°åºŸå¼ƒ**ï¼š`extract_ngrams`å‚æ•°å·²åºŸå¼ƒï¼ˆä½†ä¿ç•™å‘åå…¼å®¹ï¼‰
3. **æœªæ¥è®¡åˆ’**ï¼šå¯èƒ½ä¼šåœ¨åç»­ç‰ˆæœ¬å®Œå…¨ç§»é™¤æ—§API

---

**å®æ–½äºº**: Claude Code Assistant
**å‚è€ƒæ–‡æ¡£**: `docs/ç»Ÿä¸€åˆ†è¯é€»è¾‘ä¿®æ”¹è®¡åˆ’.md`
**åˆ†æ”¯**: `refactor/project-structure-v2`
**çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆï¼ˆåŒ…æ‹¬P0ã€P1ã€P2ä»»åŠ¡ï¼‰

**å®æ–½æ—¶é—´çº¿**:
- 2026-01-06: å®ŒæˆP0æ ¸å¿ƒå®ç°ï¼ˆåˆ†è¯é€»è¾‘+UIï¼‰
- 2026-01-06: å®ŒæˆP1 Repositoryä¼˜åŒ–ï¼ˆload_all_tokensï¼‰
- 2026-01-09: å®ŒæˆP2è°ƒç”¨ç‚¹è¿ç§»ï¼ˆPhase 2Eã€Phase 4ã€UIæ–‡å­—ï¼‰
