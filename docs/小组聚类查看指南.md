# 小组聚类数据查看问题排查指南

## 数据验证结果

✅ **数据已确认存在于数据库中**

- **小组总数**: 27个
- **涵盖大组数**: 11个 (1048, 1071, 1160, 1166, 1168, 1174, 1199, 1220, 1249, 1269, 1276)
- **总短语数**: 756个

### 各大组的小组分布

| 大组ID | 小组数量 | 总短语数 |
|--------|----------|----------|
| 1048   | 2        | 45       |
| 1071   | 2        | 41       |
| 1160   | 2        | 41       |
| 1166   | 2        | 58       |
| 1168   | 2        | 36       |
| 1174   | 6        | 275      |
| 1199   | 2        | 55       |
| 1220   | 2        | 31       |
| 1249   | 2        | 47       |
| 1269   | 2        | 81       |
| 1276   | 3        | 46       |

## 在Web UI中查看小组聚类的步骤

### 方法1: 通过Web UI查看（推荐）

1. **确保Streamlit正在运行**
   - 打开浏览器访问: http://localhost:8501

2. **导航到数据查看页面**
   - 在左侧菜单栏中点击 "📊 数据查看与管理"

3. **选择数据类型**
   - 在下拉菜单中选择 **"小组聚类 (Clusters Level B)"**
   - ⚠️ 注意：确保选择的是 "小组聚类"，不是 "大组聚类"

4. **查看数据**
   - 页面应显示 "🔄 小组聚类数据" 标题
   - 看到统计表格显示各大组的分布
   - 使用下拉菜单选择具体大组查看详情

5. **如果看到调试信息**
   - 蓝色提示框: "正在加载小组聚类数据..."
   - 绿色提示框: "成功从数据库加载了 27 个小组聚类"
   - 这说明数据加载成功

### 方法2: 直接查看HTML报告（备用方案）

如果Web UI中仍然无法显示数据，可以直接查看导出的HTML报告：

1. **打开文件资源管理器**

2. **导航到文件位置**
   ```
   D:\xiangmu\词根聚类需求挖掘\data\output\small_clusters_report.html
   ```

3. **在浏览器中打开该文件**
   - 双击文件，或
   - 右键 → 选择浏览器打开

4. **查看完整的小组聚类数据**
   - HTML报告包含所有27个小组的详细信息
   - 按大组分组显示
   - 包含每个小组的ID、大小和示例短语

## 常见问题排查

### Q1: Web UI中下拉菜单没有"小组聚类"选项

**解决方案**:
1. 刷新浏览器页面 (F5)
2. 清除浏览器缓存后刷新 (Ctrl+Shift+R)
3. 重启Streamlit服务

### Q2: 选择了"小组聚类"但页面没有显示任何内容

**可能原因**:
1. Streamlit缓存问题
2. 数据库连接问题

**解决方案**:
1. 点击Streamlit右上角的 "⋮" 菜单
2. 选择 "Clear cache"
3. 重新选择数据类型

### Q3: 页面显示错误信息

**查看完整错误**:
- 如果看到红色错误框，记录错误信息
- 错误通常会显示具体的问题原因

### Q4: 想要确认数据真的存在

**运行验证脚本**:
```bash
cd "D:\xiangmu\词根聚类需求挖掘"
python scripts/verify_clusters.py
```

这个脚本会直接从数据库读取并显示所有小组聚类的统计信息。

## 已完成的修改

### 1. 改进了数据查看页面
- 添加了调试信息显示加载状态
- 添加了统计表格显示各大组分布
- 改进了下拉菜单标签（显示小组数量）
- 添加了错误追踪

### 2. 创建了验证脚本
- `scripts/verify_clusters.py` - 验证数据库中的聚类数据
- `scripts/export_clusters_html.py` - 导出HTML报告

### 3. 修复了编码问题
- 所有脚本都添加了UTF-8编码支持
- 解决了Windows GBK编码冲突

## 下一步操作建议

### 立即操作：

1. **清除浏览器缓存并刷新**
   - 按 Ctrl+Shift+R 强制刷新
   - 或清除浏览器缓存

2. **检查Streamlit状态**
   - 确认Streamlit正在运行
   - URL是 http://localhost:8501

3. **查看HTML报告作为备用**
   - 打开 `data/output/small_clusters_report.html`
   - 确认数据可以在浏览器中正常显示

### 如果问题仍然存在：

1. **重启Streamlit服务**
   ```bash
   # 停止现有进程（Ctrl+C）
   # 重新启动
   cd "D:\xiangmu\词根聚类需求挖掘"
   streamlit run web_ui.py
   ```

2. **检查Python依赖**
   ```bash
   pip list | findstr streamlit
   ```
   确认 streamlit 版本是 1.52.2

3. **查看Streamlit日志**
   - 终端中运行Streamlit时会显示日志
   - 查看是否有错误信息

## 联系方式

如果以上所有方法都无法解决问题，请提供以下信息：

1. Web UI中具体看到了什么（截图更好）
2. 是否能看到 "正在加载小组聚类数据..." 的提示
3. HTML报告是否可以正常打开
4. Streamlit日志中是否有错误信息

---

**生成时间**: 2025-12-22
**数据验证**: ✅ 通过
**HTML报告**: ✅ 已生成
