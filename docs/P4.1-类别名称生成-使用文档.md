# P4.1 ç±»åˆ«åç§°ç”ŸæˆåŠŸèƒ½ - ä½¿ç”¨æ–‡æ¡£

**åŠŸèƒ½ç¼–å·**: REQ-008 / P4.1
**åˆ›å»ºæ—¥æœŸ**: 2026-01-29
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ä¸º 675 ä¸ªèšç±»ç°‡è‡ªåŠ¨ç”Ÿæˆå¯è¯»çš„ç±»åˆ«åç§°ï¼Œä½¿ç”¨ AIï¼ˆDeepSeek/Claudeï¼‰åˆ†æç°‡å†… Top å•†å“ï¼Œç”Ÿæˆå‡†ç¡®ä¸”æ˜“æ‡‚çš„ç±»åˆ«åç§°ã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **å•ä¸ªç°‡å‘½å**: ä¸ºæŒ‡å®šç°‡ç”Ÿæˆç±»åˆ«åç§°
2. **æ‰¹é‡å‘½å**: æ‰¹é‡å¤„ç†å¤šä¸ªç°‡æˆ–æ‰€æœ‰ç°‡
3. **å‘½åç»Ÿè®¡**: æŸ¥çœ‹ç°‡çš„å‘½åæƒ…å†µç»Ÿè®¡
4. **Top å•†å“æŸ¥è¯¢**: æŸ¥çœ‹ç°‡å†… Top N å•†å“

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒé…ç½®

ç¡®ä¿ `.env` æ–‡ä»¶ä¸­é…ç½®äº† AI API å¯†é’¥ï¼š

```bash
# DeepSeek API Keyï¼ˆæ¨èï¼‰
DEEPSEEK_API_KEY=sk-your-api-key-here

# æˆ–è€… Claude API Key
CLAUDE_API_KEY=sk-ant-your-api-key-here
```

### 2. å¯åŠ¨åç«¯æœåŠ¡

```bash
cd "D:\xiangmu\è¯æ ¹èšç±»éœ€æ±‚æŒ–æ˜"
python -m uvicorn backend.main:app --reload --port 8001
```

### 3. è®¿é—® API æ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8001/docs

åœ¨ Swagger UI ä¸­å¯ä»¥çœ‹åˆ° `/api/clusters` ç›¸å…³çš„æ‰€æœ‰ç«¯ç‚¹ã€‚

---

## ğŸ“¡ API ç«¯ç‚¹è¯´æ˜

### 1. æ‰¹é‡ç”Ÿæˆç±»åˆ«åç§°

**ç«¯ç‚¹**: `POST /api/clusters/generate-names`

**æè¿°**: ä¸ºå¤šä¸ªç°‡æˆ–æ‰€æœ‰ç°‡æ‰¹é‡ç”Ÿæˆç±»åˆ«åç§°

**è¯·æ±‚ä½“**:
```json
{
  "cluster_ids": [1, 2, 3],  // å¯é€‰ï¼Œä¸ä¼ åˆ™å¤„ç†æ‰€æœ‰ç°‡
  "top_n": 5,                 // ä½¿ç”¨ Top N å•†å“
  "batch_size": 10,           // æ‰¹æ¬¡å¤§å°ï¼ˆç”¨äºè¿›åº¦æ˜¾ç¤ºï¼‰
  "ai_provider": "deepseek"   // AI æä¾›å•†ï¼š"deepseek" æˆ– "claude"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç±»åˆ«åç§°ç”Ÿæˆå®Œæˆ",
  "data": {
    "success": true,
    "total_clusters": 3,
    "processed": 3,
    "success_count": 3,
    "failed_count": 0,
    "results": [
      {
        "success": true,
        "cluster_id": 1,
        "category_name": "Budget Planning Template",
        "top_products": ["...", "...", "..."]
      }
    ]
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:

```bash
# ä¸ºæ‰€æœ‰ç°‡ç”Ÿæˆç±»åˆ«åç§°
curl -X POST "http://localhost:8001/api/clusters/generate-names" \
  -H "Content-Type: application/json" \
  -d '{
    "top_n": 5,
    "ai_provider": "deepseek"
  }'

# åªä¸ºæŒ‡å®šç°‡ç”Ÿæˆ
curl -X POST "http://localhost:8001/api/clusters/generate-names" \
  -H "Content-Type: application/json" \
  -d '{
    "cluster_ids": [1, 2, 3],
    "top_n": 5,
    "ai_provider": "deepseek"
  }'
```

---

### 2. ä¸ºå•ä¸ªç°‡ç”Ÿæˆç±»åˆ«åç§°

**ç«¯ç‚¹**: `POST /api/clusters/generate-name/{cluster_id}`

**æè¿°**: ä¸ºæŒ‡å®šç°‡ç”Ÿæˆç±»åˆ«åç§°

**è·¯å¾„å‚æ•°**:
- `cluster_id`: ç°‡IDï¼ˆæ•´æ•°ï¼‰

**æŸ¥è¯¢å‚æ•°**:
- `top_n`: ä½¿ç”¨ Top N å•†å“ï¼ˆé»˜è®¤: 5ï¼‰
- `ai_provider`: AI æä¾›å•†ï¼ˆé»˜è®¤: "deepseek"ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç±»åˆ«åç§°ç”ŸæˆæˆåŠŸ",
  "data": {
    "success": true,
    "cluster_id": 1,
    "category_name": "Budget Planning Template",
    "top_products": [
      "Budget Planner Template Notion",
      "Monthly Budget Tracker Excel",
      "Finance Planning Spreadsheet"
    ]
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:

```bash
# ä¸ºç°‡ID 1 ç”Ÿæˆç±»åˆ«åç§°
curl -X POST "http://localhost:8001/api/clusters/generate-name/1?top_n=5&ai_provider=deepseek"
```

---

### 3. è·å–å‘½åç»Ÿè®¡

**ç«¯ç‚¹**: `GET /api/clusters/naming-statistics`

**æè¿°**: è·å–ç°‡çš„å‘½åæƒ…å†µç»Ÿè®¡

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "ç»Ÿè®¡ä¿¡æ¯è·å–æˆåŠŸ",
  "data": {
    "total_clusters": 675,
    "named_clusters": 20,
    "unnamed_clusters": 655,
    "naming_rate": 2.96
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:

```bash
curl -X GET "http://localhost:8001/api/clusters/naming-statistics"
```

---

### 4. è·å–ç°‡å†… Top å•†å“

**ç«¯ç‚¹**: `GET /api/clusters/top-products/{cluster_id}`

**æè¿°**: è·å–æŒ‡å®šç°‡çš„ Top N å•†å“ï¼ˆæŒ‰è¯„ä»·æ•°æ’åºï¼‰

**è·¯å¾„å‚æ•°**:
- `cluster_id`: ç°‡IDï¼ˆæ•´æ•°ï¼‰

**æŸ¥è¯¢å‚æ•°**:
- `limit`: è¿”å›å•†å“æ•°é‡ï¼ˆé»˜è®¤: 5ï¼‰

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "Top å•†å“è·å–æˆåŠŸ",
  "data": {
    "cluster_id": 1,
    "product_count": 5,
    "products": [
      "Budget Planner Template Notion",
      "Monthly Budget Tracker Excel",
      "Finance Planning Spreadsheet",
      "Budget Worksheet Printable",
      "Expense Tracker Template"
    ]
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:

```bash
# è·å–ç°‡ID 1 çš„ Top 5 å•†å“
curl -X GET "http://localhost:8001/api/clusters/top-products/1?limit=5"
```

---

## ğŸ§ª æµ‹è¯•è„šæœ¬ä½¿ç”¨

### è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
cd "D:\xiangmu\è¯æ ¹èšç±»éœ€æ±‚æŒ–æ˜"
python test_category_naming.py
```

### æµ‹è¯•å†…å®¹

æµ‹è¯•è„šæœ¬ä¼šä¾æ¬¡æ‰§è¡Œï¼š

1. **æµ‹è¯• 1**: è·å–å‘½åç»Ÿè®¡
   - æ˜¾ç¤ºæ€»ç°‡æ•°ã€å·²å‘½åã€æœªå‘½åã€å‘½åç‡

2. **æµ‹è¯• 2**: å•ä¸ªç°‡ç±»åˆ«åç§°ç”Ÿæˆ
   - è·å–ç¬¬ä¸€ä¸ªç°‡çš„ Top 5 å•†å“
   - è°ƒç”¨ AI ç”Ÿæˆç±»åˆ«åç§°
   - æ˜¾ç¤ºç”Ÿæˆç»“æœ

3. **æµ‹è¯• 3**: æ‰¹é‡ç”Ÿæˆï¼ˆå‰ 3 ä¸ªç°‡ï¼‰
   - æ‰¹é‡å¤„ç†å‰ 3 ä¸ªç°‡
   - æ˜¾ç¤ºæ¯ä¸ªç°‡çš„ç”Ÿæˆç»“æœ
   - æ˜¾ç¤ºæ±‡æ€»ç»Ÿè®¡

### æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
======================================================================
P4.1 ç±»åˆ«åç§°ç”ŸæˆåŠŸèƒ½æµ‹è¯•
======================================================================

OK: Environment variables checked

======================================================================
æµ‹è¯• 3: è·å–å‘½åç»Ÿè®¡
======================================================================

å‘½åç»Ÿè®¡:
  æ€»ç°‡æ•°: 675
  å·²å‘½å: 20
  æœªå‘½å: 655
  å‘½åç‡: 2.96%

======================================================================
æµ‹è¯• 1: å•ä¸ªç°‡ç±»åˆ«åç§°ç”Ÿæˆ
======================================================================

æµ‹è¯•ç°‡ID: 630

è·å– Top 5 å•†å“...
Top 5 å•†å“:
  1. Journal Canva Template Bundle: 70+ Printable Pages US Letter & A4
  2. 44-Page Canva Ebook Template: Lead Magnet Workbook A4 & US Letter
  3. Ebook Template Canva - Lead Magnet Templates
  4. Canva Ebook Template: 85-Page Workbook, Worksheet & Checklist
  5. Gratitude Course Canva Template: 400+ Workbook, Journal, & Ebook Pages

è°ƒç”¨ AI ç”Ÿæˆç±»åˆ«åç§°...
SUCCESS: Category name generated!
Category name: Canva Workbook Templates

======================================================================
æµ‹è¯• 2: æ‰¹é‡ç”Ÿæˆç±»åˆ«åç§°ï¼ˆå‰ 3 ä¸ªç°‡ï¼‰
======================================================================

æµ‹è¯•ç°‡ID: [0, 1, 2]

å¼€å§‹ç”Ÿæˆç±»åˆ«åç§°...
æ€»ç°‡æ•°: 3
AI æä¾›å•†: deepseek

è¿›åº¦: 1/3 (33.3%) - ç°‡ID: 0
  [OK] Success: Fiber Laser Parameter Libraries

è¿›åº¦: 2/3 (66.7%) - ç°‡ID: 1
  [OK] Success: Custom PNG Tuber Avatars

è¿›åº¦: 3/3 (100.0%) - ç°‡ID: 2
  [OK] Success: Streaming Content Bundles

======================================================================
æ‰¹é‡ç”Ÿæˆç»“æœæ±‡æ€»
======================================================================
æ€»ç°‡æ•°: 3
å·²å¤„ç†: 3
æˆåŠŸ: 3
å¤±è´¥: 0

è¯¦ç»†ç»“æœ:
  [OK] Cluster 0: Fiber Laser Parameter Libraries
  [OK] Cluster 1: Custom PNG Tuber Avatars
  [OK] Cluster 2: Streaming Content Bundles

======================================================================
æµ‹è¯•å®Œæˆï¼
======================================================================
```

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### 1. æ‰¹é‡ç”Ÿæˆç­–ç•¥

**å°è§„æ¨¡æµ‹è¯•**ï¼ˆæ¨èå…ˆæ‰§è¡Œï¼‰:
```json
{
  "cluster_ids": [1, 2, 3, 4, 5],
  "top_n": 5,
  "ai_provider": "deepseek"
}
```

**å…¨é‡ç”Ÿæˆ**ï¼ˆç¡®è®¤æ— è¯¯åæ‰§è¡Œï¼‰:
```json
{
  "top_n": 5,
  "ai_provider": "deepseek"
}
```

### 2. AI æä¾›å•†é€‰æ‹©

| æä¾›å•† | æˆæœ¬ | é€Ÿåº¦ | è´¨é‡ | æ¨èåœºæ™¯ |
|--------|------|------|------|----------|
| **deepseek** | $0.005/æ¬¡ | å¿« | ä¼˜ç§€ | æ¨èï¼Œæ€§ä»·æ¯”é«˜ |
| **claude** | $0.008/æ¬¡ | ä¸­ç­‰ | ä¼˜ç§€ | å¤‡é€‰ |

### 3. Top N å•†å“æ•°é‡

- **æ¨èå€¼**: 5
- **æœ€å°å€¼**: 3ï¼ˆå•†å“è¾ƒå°‘çš„ç°‡ï¼‰
- **æœ€å¤§å€¼**: 10ï¼ˆéœ€è¦æ›´å¤šä¸Šä¸‹æ–‡ï¼‰

### 4. æˆæœ¬ä¼°ç®—

**å…¨é‡ç”Ÿæˆ 675 ä¸ªç°‡**:
- DeepSeek: 675 Ã— $0.005 = **$3.38**
- Claude: 675 Ã— $0.008 = **$5.40**

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: API å¯†é’¥æœªæ‰¾åˆ°

**é”™è¯¯ä¿¡æ¯**:
```
ValueError: æœªæ‰¾åˆ° DEEPSEEK_API_KEY ç¯å¢ƒå˜é‡
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤ `DEEPSEEK_API_KEY` å·²æ­£ç¡®é…ç½®
3. é‡å¯åç«¯æœåŠ¡

---

### é—®é¢˜ 2: API è°ƒç”¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
DeepSeek API è°ƒç”¨å¤±è´¥: 401 - Unauthorized
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ
2. ç¡®è®¤ API å¯†é’¥æœ‰è¶³å¤Ÿçš„é¢åº¦
3. æ£€æŸ¥ç½‘ç»œè¿æ¥

---

### é—®é¢˜ 3: ç°‡å†…æ²¡æœ‰å•†å“

**é”™è¯¯ä¿¡æ¯**:
```
{
  "success": false,
  "error": "ç°‡å†…æ²¡æœ‰å•†å“"
}
```

**è§£å†³æ–¹æ¡ˆ**:
- è¿™æ˜¯æ­£å¸¸æƒ…å†µï¼ŒæŸäº›ç°‡å¯èƒ½ç¡®å®æ²¡æœ‰å•†å“
- è·³è¿‡è¯¥ç°‡ï¼Œç»§ç»­å¤„ç†å…¶ä»–ç°‡

---

### é—®é¢˜ 4: ç”Ÿæˆçš„ç±»åˆ«åç§°ä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ**:
1. å¢åŠ  `top_n` å‚æ•°ï¼ˆå¦‚æ”¹ä¸º 10ï¼‰
2. æ‰‹åŠ¨ä¿®æ­£ç±»åˆ«åç§°ï¼ˆç›´æ¥æ›´æ–°æ•°æ®åº“ï¼‰
3. é‡æ–°ç”Ÿæˆè¯¥ç°‡çš„ç±»åˆ«åç§°

---

## ğŸ“Š æ•°æ®åº“å­—æ®µ

### products è¡¨

ç”Ÿæˆçš„ç±»åˆ«åç§°å­˜å‚¨åœ¨ `products.cluster_name` å­—æ®µï¼š

```sql
-- æŸ¥çœ‹å·²å‘½åçš„ç°‡
SELECT DISTINCT cluster_id, cluster_name
FROM products
WHERE cluster_name IS NOT NULL
  AND cluster_name != ''
ORDER BY cluster_id;

-- æŸ¥çœ‹æŸä¸ªç°‡çš„ç±»åˆ«åç§°
SELECT cluster_name, COUNT(*) as product_count
FROM products
WHERE cluster_id = 1
GROUP BY cluster_name;

-- æ‰‹åŠ¨ä¿®æ­£ç±»åˆ«åç§°
UPDATE products
SET cluster_name = 'New Category Name'
WHERE cluster_id = 1;
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

å®Œæˆç±»åˆ«åç§°ç”Ÿæˆåï¼Œå¯ä»¥ç»§ç»­å®æ–½ï¼š

1. **P5.1: å•†å“å±æ€§æå–**ï¼ˆä»£ç è§„åˆ™ï¼Œ0 æˆæœ¬ï¼‰
2. **P5.2: Topå•†å“AIæ·±åº¦åˆ†æ**ï¼ˆAI åˆ†æï¼Œ$10-15ï¼‰
3. **å‰ç«¯å±•ç¤ºä¼˜åŒ–**ï¼ˆæ˜¾ç¤ºç±»åˆ«åç§°ï¼Œæ”¯æŒæŒ‰ç±»åˆ«ç­›é€‰ï¼‰

---

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### Prompt è®¾è®¡

```
åˆ†æä»¥ä¸‹ Etsy å•†å“åç§°ï¼Œç”Ÿæˆä¸€ä¸ªç®€æ´çš„ç±»åˆ«åç§°ã€‚

å•†å“åˆ—è¡¨ï¼š
1. Budget Planner Template Notion
2. Monthly Budget Tracker Excel
3. Finance Planning Spreadsheet
4. Budget Worksheet Printable
5. Expense Tracker Template

è¦æ±‚ï¼š
1. ç±»åˆ«åç§°ä½¿ç”¨è‹±æ–‡
2. 2-4ä¸ªå•è¯
3. ä½¿ç”¨ Title Caseï¼ˆæ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ï¼‰
4. å‡†ç¡®åæ˜ å•†å“çš„å…±åŒç‰¹å¾
5. åªè¿”å›ç±»åˆ«åç§°ï¼Œä¸è¦ä»»ä½•è§£é‡Š

ç¤ºä¾‹æ ¼å¼ï¼š
- Budget Planning Template
- Wedding Checklist Printable
- Meal Prep Tracker

ç±»åˆ«åç§°ï¼š
```

### API è°ƒç”¨å‚æ•°

**DeepSeek**:
```json
{
  "model": "deepseek-chat",
  "messages": [{"role": "user", "content": "..."}],
  "temperature": 0.3,
  "max_tokens": 50
}
```

**Claude**:
```json
{
  "model": "claude-3-haiku-20240307",
  "messages": [{"role": "user", "content": "..."}],
  "temperature": 0.3,
  "max_tokens": 50
}
```

---

## âœ… éªŒæ”¶æ ‡å‡†

- [x] èƒ½å¤Ÿä¸ºå•ä¸ªç°‡ç”Ÿæˆç±»åˆ«åç§°
- [x] èƒ½å¤Ÿæ‰¹é‡ç”Ÿæˆç±»åˆ«åç§°
- [x] æ”¯æŒ DeepSeek å’Œ Claude ä¸¤ç§ AI æä¾›å•†
- [x] ç”Ÿæˆçš„ç±»åˆ«åç§°æ ¼å¼ç»Ÿä¸€ï¼ˆTitle Caseï¼Œ2-4è¯ï¼‰
- [x] æ•°æ®åº“å­—æ®µæ­£ç¡®æ›´æ–°
- [x] æä¾›å‘½åç»Ÿè®¡åŠŸèƒ½
- [x] æä¾› Top å•†å“æŸ¥è¯¢åŠŸèƒ½
- [x] æµ‹è¯•è„šæœ¬éªŒè¯é€šè¿‡

---

**æ–‡æ¡£åˆ›å»ºè€…**: Claude Sonnet 4.5
**åˆ›å»ºæ—¶é—´**: 2026-01-29
**åŠŸèƒ½çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡
