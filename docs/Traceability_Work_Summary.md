# éœ€æ±‚æº¯æºç³»ç»Ÿ - å®Œæˆå·¥ä½œæ€»ç»“

## ğŸ“… é¡¹ç›®ä¿¡æ¯

- **å®Œæˆæ—¥æœŸ**: 2026-01-20
- **ç‰ˆæœ¬**: v1.0
- **çŠ¶æ€**: âœ… è®¾è®¡å®Œæˆ,å¾…å®æ–½

---

## ğŸ¯ é¡¹ç›®ç›®æ ‡å›é¡¾

æ ¹æ®ä½ çš„æ ¸å¿ƒéœ€æ±‚:

> "è¿™ä¸ªæ˜¯æˆ‘ä¸ªäººçš„ä¸€ä¸ªéœ€æ±‚åˆ†æå·¥å…·,åœ¨ç°åœ¨ä»¥åŠä»¥åä¼šåŒ…å«å„ä¸ªç»´åº¦ã€å±‚é¢çš„æ–¹æ³•æƒ…æ™¯å»è·å–éœ€æ±‚,æ‰€ä»¥æ¨¡å—åŠŸèƒ½éœ€è¦åˆ†å¼€,ä½†æ˜¯å½’æ ¹æ˜¯è¦æ¢³ç†å‡ºéœ€æ±‚,éœ€æ±‚å¯¹åº”çš„è¯ã€äº§å“,è¿™æ˜¯æœ€æ ¸å¿ƒçš„ç‚¹"

ä»¥åŠä½ æå‡ºçš„æº¯æºéœ€æ±‚:

> "åŒæ„,å¦å¤–è¿˜è¦è€ƒè™‘ä¸€ä¸ªæº¯æºçš„é—®é¢˜"

æˆ‘ä»¬è®¾è®¡å¹¶å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„**éœ€æ±‚æº¯æºç³»ç»Ÿ**,å®ç°äº†:

1. âœ… **éœ€æ±‚ â†” è¯ â†” äº§å“** ä¸‰è§’å…³ç³»çš„å¤šå¯¹å¤šæ˜ å°„
2. âœ… **å®Œæ•´çš„æº¯æºé“¾è·¯** - è¿½è¸ªæ¯ä¸ªéœ€æ±‚çš„æ¥æºã€æ–¹æ³•ã€æ•°æ®æº
3. âœ… **ç½®ä¿¡åº¦ç®¡ç†** - é‡åŒ–éœ€æ±‚çš„å¯é ç¨‹åº¦å¹¶è¿½è¸ªæ¼”åŒ–
4. âœ… **å®¡è®¡æ—¥å¿—** - è®°å½•æ‰€æœ‰å…³é”®æ“ä½œçš„å†å²
5. âœ… **è·¨Phaseæ•´åˆ** - æ”¯æŒå¤šç»´åº¦æ–¹æ³•å‘ç°çš„éœ€æ±‚ç»Ÿä¸€ç®¡ç†

---

## ğŸ“¦ äº¤ä»˜æˆæœ

### 1. è®¾è®¡æ–‡æ¡£ (3ä¸ª)

#### 1.1 å®Œæ•´è®¾è®¡æ–¹æ¡ˆ
**æ–‡ä»¶**: `docs/design/demand-traceability-design.md`

**å†…å®¹**:
- è®¾è®¡ç›®æ ‡å’Œæ ¸å¿ƒæ¦‚å¿µ
- æ•°æ®åº“è®¾è®¡(4ä¸ªæ–°è¡¨ + demandsè¡¨æ‰©å±•)
- æ ¸å¿ƒåŠŸèƒ½å®ç°(åˆ›å»ºã€å…³è”ã€éªŒè¯ã€æŸ¥è¯¢)
- UIè®¾è®¡é¢„è§ˆ
- å®æ–½è®¡åˆ’(åˆ†5ä¸ªPhase)
- æ³¨æ„äº‹é¡¹å’Œä¼˜åŒ–æ–¹å‘

**å…³é”®äº®ç‚¹**:
- éœ€æ±‚ä¸‰è§’å…³ç³»: Demand â†” Phrase â†” Product
- æº¯æºå››ç»´åº¦: Phaseã€Methodã€Sourceã€Time
- ç½®ä¿¡åº¦æ¼”åŒ–è¿½è¸ª
- å®Œæ•´çš„å®¡è®¡æ—¥å¿—

#### 1.2 å®æ–½æ€»ç»“
**æ–‡ä»¶**: `docs/Traceability_System_Implementation_Summary.md`

**å†…å®¹**:
- é¡¹ç›®æ¦‚è¿°å’Œæ ¸å¿ƒç›®æ ‡
- æ•°æ®åº“è®¾è®¡è¯¦è§£(å«SQLè¯­å¥)
- æ ¸å¿ƒåŠŸèƒ½å’Œä½¿ç”¨ç¤ºä¾‹
- å®æ–½æ­¥éª¤(4ä¸ªPhase)
- UIè®¾è®¡é¢„è§ˆ
- å…³é”®ç‰¹æ€§å’Œæ³¨æ„äº‹é¡¹
- åç»­ä¼˜åŒ–æ–¹å‘

**å…³é”®äº®ç‚¹**:
- å®Œæ•´çš„SQLå»ºè¡¨è¯­å¥
- è¯¦ç»†çš„ä½¿ç”¨ç¤ºä¾‹ä»£ç 
- UIç•Œé¢è®¾è®¡é¢„è§ˆ
- æ€§èƒ½å’Œæ‰©å±•æ€§è€ƒè™‘

#### 1.3 å¿«é€Ÿå¼€å§‹æŒ‡å—
**æ–‡ä»¶**: `docs/Traceability_Quick_Start.md`

**å†…å®¹**:
- 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹æŒ‡å—
- æ•°æ®åº“è¿ç§»æ­¥éª¤
- åŠŸèƒ½æµ‹è¯•æ­¥éª¤
- å¸¸è§ä½¿ç”¨åœºæ™¯(4ä¸ª)
- æŸ¥çœ‹æº¯æºä¿¡æ¯çš„æ–¹æ³•
- å¸¸è§é—®é¢˜è§£ç­”(5ä¸ª)
- æ£€æŸ¥æ¸…å•

**å…³é”®äº®ç‚¹**:
- å‚»ç“œå¼æ“ä½œæŒ‡å—
- é¢„æœŸè¾“å‡ºç¤ºä¾‹
- å®ç”¨ä»£ç ç‰‡æ®µ
- æ•…éšœæ’æŸ¥æ–¹æ³•

---

### 2. æ•°æ®åº“æ¨¡å‹ (1ä¸ª)

**æ–‡ä»¶**: `storage/models_traceability.py`

**å†…å®¹**:
- 4ä¸ªæ–°è¡¨çš„SQLAlchemy ORMæ¨¡å‹
- demandsè¡¨æ‰©å±•å­—æ®µçš„æ³¨é‡Šå’ŒSQLè¯­å¥
- å®Œæ•´çš„å­—æ®µå®šä¹‰ã€ç´¢å¼•ã€çº¦æŸ
- å…¼å®¹MySQLå’ŒSQLite

**æ–°å¢è¡¨**:
1. **DemandPhraseMapping** - éœ€æ±‚ä¸çŸ­è¯­çš„å¤šå¯¹å¤šå…³è”
2. **DemandProductMapping** - éœ€æ±‚ä¸å•†å“çš„å¤šå¯¹å¤šå…³è”
3. **DemandTokenMapping** - éœ€æ±‚ä¸Tokençš„å¤šå¯¹å¤šå…³è”
4. **DemandProvenance** - éœ€æ±‚æº¯æºå®¡è®¡è¡¨

**demandsè¡¨æ‰©å±•** (11ä¸ªæ–°å­—æ®µ):
- source_phase, source_method, source_data_ids (æ¥æºè¿½è¸ª)
- confidence_score, confidence_history (ç½®ä¿¡åº¦ç®¡ç†)
- discovered_at, last_validated_at, validation_count (æ—¶é—´è¿½è¸ª)
- is_validated, validated_by, validation_notes (éªŒè¯çŠ¶æ€)

---

### 3. æ ¸å¿ƒæœåŠ¡ (1ä¸ª)

**æ–‡ä»¶**: `core/demand_provenance_service.py`

**å†…å®¹**:
- DemandProvenanceService ç±»(çº¦500è¡Œ)
- 8ä¸ªæ ¸å¿ƒæ–¹æ³•
- 1ä¸ªä¾¿æ·å‡½æ•°
- å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²å’Œç±»å‹æ³¨è§£

**æ ¸å¿ƒæ–¹æ³•**:
1. `create_demand_with_provenance()` - åˆ›å»ºéœ€æ±‚å¹¶è®°å½•æº¯æº
2. `link_demand_to_phrases()` - å»ºç«‹éœ€æ±‚-çŸ­è¯­å…³è”
3. `link_demand_to_products()` - å»ºç«‹éœ€æ±‚-å•†å“å…³è”
4. `link_demand_to_tokens()` - å»ºç«‹éœ€æ±‚-Tokenå…³è”
5. `update_confidence_score()` - æ›´æ–°ç½®ä¿¡åº¦
6. `validate_demand()` - éªŒè¯éœ€æ±‚
7. `get_demand_provenance()` - æŸ¥è¯¢å®Œæ•´æº¯æºä¿¡æ¯
8. `get_demands_by_source()` - ç»Ÿè®¡åˆ†æ

**ç‰¹æ€§**:
- ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ”¯æŒ(withè¯­å¥)
- è‡ªåŠ¨äº‹åŠ¡ç®¡ç†
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- JSONæ•°æ®åºåˆ—åŒ–

---

### 4. è„šæœ¬å·¥å…· (2ä¸ª)

#### 4.1 æ•°æ®åº“è¿ç§»è„šæœ¬
**æ–‡ä»¶**: `scripts/migrate_add_traceability.py`

**åŠŸèƒ½**:
- æ­¥éª¤1: æ‰©å±•demandsè¡¨(11ä¸ªå­—æ®µ + 3ä¸ªç´¢å¼•)
- æ­¥éª¤2: åˆ›å»º4ä¸ªæ–°è¡¨
- æ­¥éª¤3: ä¸ºç°æœ‰æ•°æ®è¡¥å……é»˜è®¤æº¯æºä¿¡æ¯
- æ­¥éª¤4: éªŒè¯è¿ç§»ç»“æœ

**ç‰¹æ€§**:
- äº¤äº’å¼ç¡®è®¤
- è¯¦ç»†çš„è¿›åº¦è¾“å‡º
- é”™è¯¯å¤„ç†å’Œå›æ»š
- å…¼å®¹MySQLå’ŒSQLite

#### 4.2 åŠŸèƒ½æµ‹è¯•è„šæœ¬
**æ–‡ä»¶**: `scripts/test_traceability_system.py`

**æµ‹è¯•å†…å®¹**:
- æµ‹è¯•1: åˆ›å»ºéœ€æ±‚
- æµ‹è¯•2: å…³è”çŸ­è¯­
- æµ‹è¯•3: å…³è”å•†å“
- æµ‹è¯•4: å…³è”Token
- æµ‹è¯•5: æ›´æ–°ç½®ä¿¡åº¦
- æµ‹è¯•6: éªŒè¯éœ€æ±‚
- æµ‹è¯•7: æŸ¥è¯¢æº¯æºä¿¡æ¯
- æµ‹è¯•8: ç»Ÿè®¡åˆ†æ

**ç‰¹æ€§**:
- å®Œæ•´çš„åŠŸèƒ½è¦†ç›–
- æ¸…æ™°çš„è¾“å‡ºæ ¼å¼
- é”™è¯¯è¿½è¸ª
- å¯é‡å¤è¿è¡Œ

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡æ€»è§ˆ

### æ–°å¢è¡¨ç»“æ„

| è¡¨å | ç”¨é€” | å…³é”®å­—æ®µ | è®°å½•æ•°é¢„ä¼° |
|------|------|----------|-----------|
| demand_phrase_mappings | éœ€æ±‚-çŸ­è¯­å…³è” | demand_id, phrase_id, relevance_score | æ•°åƒ-æ•°ä¸‡ |
| demand_product_mappings | éœ€æ±‚-å•†å“å…³è” | demand_id, product_id, fit_score, fit_level | æ•°ç™¾-æ•°åƒ |
| demand_token_mappings | éœ€æ±‚-è¯æ ¹å…³è” | demand_id, token_id, token_role, importance_score | æ•°ç™¾-æ•°åƒ |
| demand_provenance | æº¯æºå®¡è®¡æ—¥å¿— | demand_id, event_type, old_value, new_value | å¿«é€Ÿå¢é•¿ |

### demandsè¡¨æ‰©å±•

| å­—æ®µ | ç±»å‹ | ç”¨é€” |
|------|------|------|
| source_phase | VARCHAR(20) | æ¥æºPhase (phase1-7, manual) |
| source_method | VARCHAR(50) | å‘ç°æ–¹æ³• |
| source_data_ids | TEXT (JSON) | æºæ•°æ®IDåˆ—è¡¨ |
| confidence_score | DECIMAL(3,2) | ç½®ä¿¡åº¦ 0.00-1.00 |
| confidence_history | TEXT (JSON) | ç½®ä¿¡åº¦å˜åŒ–å†å² |
| discovered_at | TIMESTAMP | å‘ç°æ—¶é—´ |
| last_validated_at | TIMESTAMP | æœ€åéªŒè¯æ—¶é—´ |
| validation_count | INT | éªŒè¯æ¬¡æ•° |
| is_validated | BOOLEAN | æ˜¯å¦å·²éªŒè¯ |
| validated_by | VARCHAR(100) | éªŒè¯è€… |
| validation_notes | TEXT | éªŒè¯å¤‡æ³¨ |

---

## ğŸ”„ æ•°æ®æµè®¾è®¡

### éœ€æ±‚åˆ›å»ºæµç¨‹

```
Phase 7 å•†å“åˆ†æ
    â†“
AIæ ‡æ³¨æå–éœ€æ±‚
    â†“
DemandProvenanceService.create_demand_with_provenance()
    â†“
åˆ›å»ºDemandè®°å½• (å«æº¯æºå­—æ®µ)
    â†“
åˆ›å»ºDemandProvenanceè®°å½• (event_type='created')
    â†“
è¿”å›demand_id
```

### å…³è”å»ºç«‹æµç¨‹

```
éœ€æ±‚ID + å•†å“IDåˆ—è¡¨
    â†“
DemandProvenanceService.link_demand_to_products()
    â†“
åˆ›å»ºDemandProductMappingè®°å½•
    â†“
åˆ›å»ºDemandProvenanceè®°å½• (event_type='linked_product')
    â†“
è¿”å›mapping_idåˆ—è¡¨
```

### éªŒè¯æµç¨‹

```
éœ€æ±‚ID + éªŒè¯è€…
    â†“
DemandProvenanceService.validate_demand()
    â†“
æ›´æ–°Demand.is_validated = True
    â†“
æå‡Demand.confidence_score (+20%)
    â†“
æ›´æ–°confidence_history
    â†“
åˆ›å»ºDemandProvenanceè®°å½• (event_type='validated')
```

---

## ğŸ¨ æ ¸å¿ƒç‰¹æ€§

### 1. å®Œæ•´çš„æº¯æºé“¾è·¯

æ¯ä¸ªéœ€æ±‚éƒ½èƒ½è¿½æº¯åˆ°:
- âœ… **å‘ç°æ¥æº** - Phase (phase1-7, manual)
- âœ… **å‘ç°æ–¹æ³•** - Method (product_reverse_engineering, keyword_clustering, etc.)
- âœ… **åŸå§‹æ•°æ®** - Source Data IDs (å•†å“IDã€çŸ­è¯­IDç­‰)
- âœ… **å‘ç°æ—¶é—´** - Discovered At
- âœ… **ç½®ä¿¡åº¦æ¼”åŒ–** - Confidence History (JSONæ•°ç»„)
- âœ… **æ‰€æœ‰å˜æ›´** - Event Timeline (å®¡è®¡æ—¥å¿—)

### 2. å¤šå¯¹å¤šå…³è”å…³ç³»

æ”¯æŒéœ€æ±‚ä¸å¤šç§æ•°æ®ç±»å‹çš„çµæ´»å…³è”:

```
Demand (éœ€æ±‚)
    â”œâ”€ N:M â”€ Phrase (çŸ­è¯­)
    â”‚         â””â”€ relevance_score (ç›¸å…³æ€§è¯„åˆ†)
    â”‚
    â”œâ”€ N:M â”€ Product (å•†å“)
    â”‚         â”œâ”€ fit_score (é€‚é…åº¦è¯„åˆ†)
    â”‚         â””â”€ fit_level (é€‚é…åº¦ç­‰çº§)
    â”‚
    â””â”€ N:M â”€ Token (è¯æ ¹)
              â”œâ”€ token_role (è¯æ ¹è§’è‰²: core/supporting/context)
              â””â”€ importance_score (é‡è¦æ€§è¯„åˆ†)
```

### 3. ç½®ä¿¡åº¦ç®¡ç†

- âœ… **åˆå§‹ç½®ä¿¡åº¦** - åˆ›å»ºæ—¶è®¾ç½® (0.5-0.7)
- âœ… **åŠ¨æ€è°ƒæ•´** - æ ¹æ®éªŒè¯ã€å…³è”æ•°æ®ç­‰å› ç´ è°ƒæ•´
- âœ… **å†å²è¿½è¸ª** - JSONæ•°ç»„è®°å½•æ¯æ¬¡å˜åŒ–
- âœ… **å¯è§†åŒ–** - æ”¯æŒç»˜åˆ¶ç½®ä¿¡åº¦æ¼”åŒ–æ›²çº¿

**ç½®ä¿¡åº¦è°ƒæ•´è§„åˆ™**:
- AIéªŒè¯é€šè¿‡: +0.1 ~ +0.2
- äººå·¥éªŒè¯é€šè¿‡: +0.2
- å…³è”é«˜è´¨é‡æ•°æ®: +0.05 ~ +0.1
- å‘ç°çŸ›ç›¾æ•°æ®: -0.1 ~ -0.2

### 4. å®¡è®¡æ—¥å¿—

è®°å½•10ç§äº‹ä»¶ç±»å‹:
1. **created** - éœ€æ±‚åˆ›å»º
2. **updated** - éœ€æ±‚æ›´æ–°
3. **validated** - éœ€æ±‚éªŒè¯
4. **merged** - éœ€æ±‚åˆå¹¶
5. **split** - éœ€æ±‚æ‹†åˆ†
6. **linked_phrase** - å…³è”çŸ­è¯­
7. **linked_product** - å…³è”å•†å“
8. **linked_token** - å…³è”è¯æ ¹
9. **confidence_changed** - ç½®ä¿¡åº¦å˜åŒ–
10. **status_changed** - çŠ¶æ€å˜åŒ–

æ¯ä¸ªäº‹ä»¶è®°å½•:
- äº‹ä»¶ç±»å‹å’Œæè¿°
- å˜æ›´å‰åçš„å€¼ (JSONæ ¼å¼)
- è§¦å‘è€…ä¿¡æ¯ (phase, method, user)
- å…³è”æ•°æ®ä¿¡æ¯
- æ—¶é—´æˆ³

---

## ğŸ“ˆ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1: Phase 7 å•†å“åå‘å·¥ç¨‹

```python
# ä»å•†å“åˆ›å»ºéœ€æ±‚
with DemandProvenanceService() as service:
    demand_id = service.create_demand_with_provenance(
        title="åœ¨çº¿è¡¨æ ¼åä½œå·¥å…·",
        source_phase="phase7",
        source_method="product_reverse_engineering",
        source_data_ids=[1001, 1002, 1003],
        confidence_score=0.75
    )

    # å…³è”å•†å“
    service.link_demand_to_products(
        demand_id=demand_id,
        product_ids=[1001, 1002],
        fit_scores=[0.9, 0.85],
        fit_levels=["high", "high"],
        source="product_analysis",
        phase="phase7",
        method="ai_annotation"
    )
```

### åœºæ™¯2: Phase 4 å…³é”®è¯èšç±»

```python
# ä»èšç±»åˆ›å»ºéœ€æ±‚
with DemandProvenanceService() as service:
    demand_id = service.create_demand_with_provenance(
        title="å…è´¹PDFç¼–è¾‘å·¥å…·",
        source_phase="phase4",
        source_method="keyword_clustering",
        source_data_ids=[],
        confidence_score=0.6
    )

    # å…³è”çŸ­è¯­
    service.link_demand_to_phrases(
        demand_id=demand_id,
        phrase_ids=[100, 101, 102],
        relevance_scores=[0.95, 0.9, 0.85],
        source="clustering",
        phase="phase4",
        method="hdbscan_clustering"
    )
```

### åœºæ™¯3: è·¨Phaseéœ€æ±‚æ•´åˆ

```python
# æŸ¥è¯¢æ‰€æœ‰æ¥æºçš„éœ€æ±‚
with DemandProvenanceService() as service:
    stats = service.get_demands_by_source()

    # æŒ‰Phaseåˆ†å¸ƒ
    # phase4: 45ä¸ªéœ€æ±‚ (å…³é”®è¯èšç±»)
    # phase6: 12ä¸ªéœ€æ±‚ (Redditåˆ†æ)
    # phase7: 18ä¸ªéœ€æ±‚ (å•†å“åˆ†æ)

    # è¯†åˆ«ç›¸ä¼¼éœ€æ±‚å¹¶åˆå¹¶
    # (æœªæ¥åŠŸèƒ½)
```

---

## âœ… å®Œæˆæƒ…å†µ

### å·²å®Œæˆ âœ…

1. âœ… **è®¾è®¡æ–‡æ¡£** (3ä¸ª)
   - å®Œæ•´è®¾è®¡æ–¹æ¡ˆ
   - å®æ–½æ€»ç»“
   - å¿«é€Ÿå¼€å§‹æŒ‡å—

2. âœ… **æ•°æ®åº“æ¨¡å‹** (1ä¸ª)
   - 4ä¸ªæ–°è¡¨çš„ORMæ¨¡å‹
   - demandsè¡¨æ‰©å±•å­—æ®µ

3. âœ… **æ ¸å¿ƒæœåŠ¡** (1ä¸ª)
   - DemandProvenanceServiceç±»
   - 8ä¸ªæ ¸å¿ƒæ–¹æ³•

4. âœ… **è„šæœ¬å·¥å…·** (2ä¸ª)
   - æ•°æ®åº“è¿ç§»è„šæœ¬
   - åŠŸèƒ½æµ‹è¯•è„šæœ¬

### å¾…å®æ–½ â³

1. â³ **æ•°æ®åº“è¿ç§»**
   - è¿è¡Œè¿ç§»è„šæœ¬
   - éªŒè¯è¿ç§»ç»“æœ

2. â³ **é›†æˆåˆ°Phase 7**
   - ä¿®æ”¹ `core/product_management.py`
   - åœ¨AIæ ‡æ³¨åè°ƒç”¨æº¯æºæœåŠ¡

3. â³ **UIå¼€å‘**
   - åˆ›å»ºéœ€æ±‚ä¸­å¿ƒé¡µé¢
   - å±•ç¤ºæº¯æºä¿¡æ¯
   - ç»Ÿè®¡å›¾è¡¨

4. â³ **å•å…ƒæµ‹è¯•**
   - ç¼–å†™pytestæµ‹è¯•ç”¨ä¾‹
   - è¦†ç›–æ ¸å¿ƒåŠŸèƒ½

---

## ğŸ“‚ æ–‡ä»¶æ¸…å•

```
D:\xiangmu\è¯æ ¹èšç±»éœ€æ±‚æŒ–æ˜\
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ design/
â”‚   â”‚   â””â”€â”€ demand-traceability-design.md          âœ… å®Œæ•´è®¾è®¡æ–¹æ¡ˆ
â”‚   â”œâ”€â”€ Traceability_System_Implementation_Summary.md  âœ… å®æ–½æ€»ç»“
â”‚   â”œâ”€â”€ Traceability_Quick_Start.md                âœ… å¿«é€Ÿå¼€å§‹æŒ‡å—
â”‚   â””â”€â”€ Traceability_Work_Summary.md               âœ… æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ storage/
â”‚   â””â”€â”€ models_traceability.py                     âœ… æº¯æºè¡¨ORMæ¨¡å‹
â”‚
â”œâ”€â”€ core/
â”‚   â””â”€â”€ demand_provenance_service.py               âœ… æº¯æºæœåŠ¡ç±»
â”‚
â””â”€â”€ scripts/
    â”œâ”€â”€ migrate_add_traceability.py                âœ… æ•°æ®åº“è¿ç§»è„šæœ¬
    â””â”€â”€ test_traceability_system.py                âœ… åŠŸèƒ½æµ‹è¯•è„šæœ¬
```

**ç»Ÿè®¡**:
- æ–‡æ¡£: 4ä¸ª
- ä»£ç æ–‡ä»¶: 3ä¸ª
- æ€»ä»£ç é‡: çº¦1500è¡Œ
- æ€»æ–‡æ¡£é‡: çº¦3000è¡Œ

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯åš (ä»Šå¤©)

1. **è¿è¡Œè¿ç§»è„šæœ¬**
   ```bash
   python scripts/migrate_add_traceability.py
   ```

2. **è¿è¡Œæµ‹è¯•è„šæœ¬**
   ```bash
   python scripts/test_traceability_system.py
   ```

3. **æŸ¥çœ‹æ•°æ®åº“**
   ```sql
   SHOW TABLES;  -- æŸ¥çœ‹æ–°è¡¨
   DESC demands;  -- æŸ¥çœ‹demandsè¡¨æ–°å­—æ®µ
   ```

### æœ¬å‘¨å¯åš

1. **é›†æˆåˆ°Phase 7**
   - ä¿®æ”¹AIæ ‡æ³¨é€»è¾‘
   - è°ƒç”¨æº¯æºæœåŠ¡åˆ›å»ºéœ€æ±‚

2. **åˆ›å»ºç®€å•UI**
   - éœ€æ±‚åˆ—è¡¨é¡µ
   - éœ€æ±‚è¯¦æƒ…é¡µ(å«æº¯æºä¿¡æ¯)

### ä¸‹å‘¨å¯åš

1. **å®Œå–„åŠŸèƒ½**
   - éœ€æ±‚åˆå¹¶
   - æ‰¹é‡éªŒè¯
   - å¯¼å‡ºæŠ¥å‘Š

2. **æ€§èƒ½ä¼˜åŒ–**
   - æ·»åŠ ç¼“å­˜
   - ä¼˜åŒ–æŸ¥è¯¢
   - æ•°æ®å½’æ¡£

---

## ğŸ’¡ è®¾è®¡äº®ç‚¹

### 1. çµæ´»çš„æº¯æºç»´åº¦

æ”¯æŒ4ä¸ªç»´åº¦çš„æº¯æº:
- **Phaseç»´åº¦** - å“ªä¸ªé˜¶æ®µå‘ç°çš„
- **Methodç»´åº¦** - ç”¨ä»€ä¹ˆæ–¹æ³•å‘ç°çš„
- **Sourceç»´åº¦** - å…·ä½“çš„æ•°æ®æºæ˜¯ä»€ä¹ˆ
- **Timeç»´åº¦** - ä»€ä¹ˆæ—¶å€™å‘ç°çš„

### 2. å¯æ‰©å±•çš„æ¶æ„

- **æ–°Phaseæ”¯æŒ** - åªéœ€æ·»åŠ æ–°çš„phaseå€¼
- **æ–°Methodæ”¯æŒ** - åªéœ€æ·»åŠ æ–°çš„methodå€¼
- **æ–°å…³è”ç±»å‹** - å¯ä»¥æ·»åŠ æ–°çš„mappingè¡¨
- **æ–°äº‹ä»¶ç±»å‹** - å¯ä»¥æ‰©å±•event_typeæšä¸¾

### 3. å®Œæ•´çš„æ•°æ®ä¸€è‡´æ€§

- **å¤–é”®çº¦æŸ** - ä½¿ç”¨ON DELETE CASCADE
- **äº‹åŠ¡ä¿è¯** - å…³é”®æ“ä½œåœ¨åŒä¸€äº‹åŠ¡ä¸­
- **ç´¢å¼•ä¼˜åŒ–** - å¤åˆç´¢å¼•æå‡æŸ¥è¯¢æ€§èƒ½

### 4. å‹å¥½çš„å¼€å‘ä½“éªŒ

- **ä¸Šä¸‹æ–‡ç®¡ç†å™¨** - æ”¯æŒwithè¯­å¥
- **ç±»å‹æ³¨è§£** - å®Œæ•´çš„ç±»å‹æç¤º
- **æ–‡æ¡£å­—ç¬¦ä¸²** - è¯¦ç»†çš„APIæ–‡æ¡£
- **é”™è¯¯å¤„ç†** - æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

---

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### æ•°æ®åº“è®¾è®¡

- **å¤šå¯¹å¤šå…³è”** - ä½¿ç”¨ä¸­é—´è¡¨å®ç°
- **JSONå­—æ®µ** - çµæ´»å­˜å‚¨å¤æ‚æ•°æ®
- **å¤åˆç´¢å¼•** - ä¼˜åŒ–å¸¸ç”¨æŸ¥è¯¢
- **è½¯åˆ é™¤** - ä½¿ç”¨CASCADEä¿è¯ä¸€è‡´æ€§

### Pythonå®ç°

- **ORMæ¨¡å¼** - SQLAlchemy 2.0+
- **æœåŠ¡å±‚** - å°è£…ä¸šåŠ¡é€»è¾‘
- **ä¸Šä¸‹æ–‡ç®¡ç†** - è‡ªåŠ¨èµ„æºç®¡ç†
- **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ç±»å‹æ³¨è§£

### æ•°æ®æµè®¾è®¡

- **å•å‘ä¾èµ–** - Service â†’ Repository â†’ Model
- **äº‹åŠ¡è¾¹ç•Œ** - åœ¨Serviceå±‚ç®¡ç†
- **é”™è¯¯ä¼ æ’­** - æ¸…æ™°çš„å¼‚å¸¸å¤„ç†

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### æ•°æ®é‡é¢„ä¼°

å‡è®¾ç³»ç»Ÿè¿è¡Œ1å¹´:
- **éœ€æ±‚æ•°**: 100-200ä¸ª
- **çŸ­è¯­å…³è”**: 5,000-10,000æ¡
- **å•†å“å…³è”**: 500-1,000æ¡
- **Tokenå…³è”**: 500-1,000æ¡
- **å®¡è®¡æ—¥å¿—**: 10,000-20,000æ¡

### æ€§èƒ½æŒ‡æ ‡

- **éœ€æ±‚åˆ›å»º**: < 100ms
- **å…³è”å»ºç«‹**: < 50ms/æ¡
- **æº¯æºæŸ¥è¯¢**: < 200ms
- **ç»Ÿè®¡åˆ†æ**: < 500ms

### å­˜å‚¨ç©ºé—´

- **æ–°è¡¨æ€»è®¡**: çº¦10-50 MB (1å¹´æ•°æ®)
- **demandsè¡¨æ‰©å±•**: çº¦1-5 MB
- **ç´¢å¼•å¼€é”€**: çº¦5-10 MB

---

## ğŸ‰ æ€»ç»“

æˆ‘ä»¬æˆåŠŸè®¾è®¡å¹¶å®ç°äº†ä¸€ä¸ª**å®Œæ•´çš„éœ€æ±‚æº¯æºç³»ç»Ÿ**,å®ç°äº†ä½ æå‡ºçš„æ ¸å¿ƒéœ€æ±‚:

1. âœ… **éœ€æ±‚ â†” è¯ â†” äº§å“** ä¸‰è§’å…³ç³»
2. âœ… **å®Œæ•´çš„æº¯æºé“¾è·¯**
3. âœ… **è·¨Phaseæ•´åˆèƒ½åŠ›**
4. âœ… **å¯æ‰©å±•çš„æ¶æ„**

ç³»ç»Ÿç‰¹ç‚¹:
- ğŸ“Š **æ•°æ®å®Œæ•´** - 4ä¸ªæ–°è¡¨ + 11ä¸ªæ‰©å±•å­—æ®µ
- ğŸ”§ **åŠŸèƒ½å®Œå–„** - 8ä¸ªæ ¸å¿ƒæ–¹æ³•è¦†ç›–æ‰€æœ‰åœºæ™¯
- ğŸ“ **æ–‡æ¡£é½å…¨** - 3ä¸ªè®¾è®¡æ–‡æ¡£ + ä»£ç æ³¨é‡Š
- ğŸš€ **å³ç”¨å³éƒ¨ç½²** - è¿ç§»è„šæœ¬ + æµ‹è¯•è„šæœ¬

ä¸‹ä¸€æ­¥åªéœ€:
1. è¿è¡Œè¿ç§»è„šæœ¬
2. é›†æˆåˆ°Phase 7
3. åˆ›å»ºUIç•Œé¢

**æ•´ä¸ªæº¯æºç³»ç»Ÿå·²ç»å‡†å¤‡å°±ç»ª,å¯ä»¥å¼€å§‹å®æ–½äº†!** ğŸŠ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**å®Œæˆæ—¥æœŸ**: 2026-01-20
**ä½œè€…**: Claude Code
