# 项目备份与恢复 - 快速指南

**创建时间**: 2026-02-01
**目标**: 提供简单易用的备份和恢复操作指南

---

## 🚀 快速开始

### 1. 立即备份（推荐在迁移前执行）

```bash
# 进入项目目录
cd D:\xiangmu\词根聚类需求挖掘

# 运行备份脚本
python scripts/backup.py
```

**备份内容**:
- ✅ 所有代码（自动创建Git分支）
- ✅ 数据库（products.db）
- ✅ 所有数据文件（data/目录）
- ✅ 环境配置（.env）
- ✅ Python依赖清单
- ✅ 压缩包（backups/backup-YYYYMMDD_HHMMSS.zip）

**备份时间**: 约30秒

---

### 2. 查看所有备份

```bash
python scripts/restore.py --list
```

**输出示例**:
```
[INFO] 可用的备份:

1. backup-20260201_235801
   时间: 2026-02-01 23:58:39

2. backup-20260201_143022
   时间: 2026-02-01 14:30:22
```

---

### 3. 恢复备份

```bash
# 恢复指定备份
python scripts/restore.py backup-20260201_235801

# 按提示输入 'yes' 确认
```

**恢复时间**: 约1分钟

---

## 📋 完整备份方案

### 方案A：自动备份（推荐）⭐⭐⭐⭐⭐

**适用场景**: 架构迁移、重大变更前

**步骤**:
```bash
# 1. 运行备份脚本
python scripts/backup.py

# 2. 等待完成（约30秒）
# 3. 确认备份成功
python scripts/restore.py --list
```

**备份位置**:
- Git分支: `backup-YYYYMMDD_HHMMSS`
- 备份目录: `backups/backup-YYYYMMDD_HHMMSS/`
- 压缩包: `backups/backup-YYYYMMDD_HHMMSS.zip`

---

### 方案B：手动完整复制（最简单）⭐⭐⭐⭐

**适用场景**: 不熟悉Git，想要最简单的方法

**步骤**:
```bash
# Windows资源管理器操作
1. 打开 D:\xiangmu\
2. 右键点击 "词根聚类需求挖掘" 文件夹
3. 选择 "复制"
4. 在同一目录粘贴
5. 重命名为 "词根聚类需求挖掘-backup-20260201"
```

**优点**: 最简单，不需要任何命令
**缺点**: 占用空间大（约500MB）

---

### 方案C：Git分支备份（适合Git用户）⭐⭐⭐⭐

**适用场景**: 熟悉Git，想要版本控制

**步骤**:
```bash
# 1. 创建备份分支
git checkout -b backup-before-htmx-migration-20260201

# 2. 提交所有更改
git add .
git commit -m "backup: 完整备份 - 迁移到HTMX之前

当前状态:
- 架构: React + FastAPI
- 功能: 完整可用

备份原因: 准备迁移到FastAPI+HTMX架构
备份时间: 2026-02-01

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"

# 3. 推送到远程（可选）
git push origin backup-before-htmx-migration-20260201
```

---

## 🔄 恢复方案

### 恢复A：从自动备份恢复（推荐）⭐⭐⭐⭐⭐

**步骤**:
```bash
# 1. 查看所有备份
python scripts/restore.py --list

# 2. 恢复指定备份
python scripts/restore.py backup-20260201_235801

# 3. 输入 'yes' 确认

# 4. 启动服务验证
python -m uvicorn api.main:app --reload --port 8000
```

**恢复时间**: 约1分钟

---

### 恢复B：从Git分支恢复⭐⭐⭐⭐

**步骤**:
```bash
# 1. 查看所有分支
git branch -a

# 2. 切换到备份分支
git checkout backup-20260201_235801

# 3. 恢复数据文件（如果需要）
python scripts/restore.py backup-20260201_235801

# 4. 验证
python -m uvicorn api.main:app --reload --port 8000
```

---

### 恢复C：从手动复制恢复⭐⭐⭐

**步骤**:
```bash
# 1. 删除当前项目（可选）
# 先确认备份存在！

# 2. 复制备份回来
# 在资源管理器中：
# - 复制 "词根聚类需求挖掘-backup-20260201"
# - 粘贴并重命名为 "词根聚类需求挖掘"

# 3. 验证
cd 词根聚类需求挖掘
python -m uvicorn api.main:app --reload --port 8000
```

---

## ✅ 验证清单

### 备份后验证

```bash
# 1. 检查备份目录
ls backups/

# 2. 检查Git分支
git branch | grep backup

# 3. 检查压缩包
ls backups/*.zip

# 4. 查看备份信息
cat backups/backup-20260201_235801/BACKUP_INFO.txt
```

**预期结果**:
- ✅ 备份目录存在
- ✅ Git分支已创建
- ✅ 压缩包已创建（约78MB）
- ✅ 备份信息文件存在

---

### 恢复后验证

```bash
# 1. 启动后端
python -m uvicorn api.main:app --reload --port 8000

# 2. 启动前端（新终端）
cd frontend
npm run dev

# 3. 访问 http://localhost:5173

# 4. 测试功能
# - 商品列表可以加载
# - 聚类功能可以使用
# - AI功能可以使用
```

**预期结果**:
- ✅ 后端启动成功
- ✅ 前端启动成功
- ✅ 页面可以访问
- ✅ 所有功能正常

---

## 🎯 推荐流程（架构迁移）

### 迁移前

```bash
# 1. 创建备份
python scripts/backup.py

# 2. 验证备份
python scripts/restore.py --list

# 3. 记录备份名称
# 例如: backup-20260201_235801
```

### 迁移中

```bash
# 1. 开始迁移工作
# 2. 如果遇到问题，随时可以恢复
# 3. 保持备份不动
```

### 迁移后

```bash
# 1. 测试新系统
# 2. 确认所有功能正常
# 3. 运行一段时间（1-2天）
# 4. 确认无问题后，可以删除旧备份
```

---

## 🚨 紧急恢复（5分钟）

**如果迁移失败，需要立即恢复**:

```bash
# 方法1：从Git分支恢复（最快）
git checkout backup-20260201_235801
python -m uvicorn api.main:app --reload --port 8000

# 方法2：从备份目录恢复
python scripts/restore.py backup-20260201_235801
# 输入 'yes' 确认
python -m uvicorn api.main:app --reload --port 8000

# 方法3：从手动复制恢复
# 删除当前目录，复制备份回来
```

---

## 📝 常见问题

### Q1: 备份需要多长时间？
**A**: 约30秒，主要时间在复制数据文件（约78MB）

### Q2: 备份占用多少空间？
**A**:
- 压缩包: 约78MB
- 备份目录: 约200MB
- Git分支: 几乎不占空间（只存储差异）

### Q3: 可以创建多个备份吗？
**A**: 可以，每次运行 `python scripts/backup.py` 都会创建新备份

### Q4: 如何删除旧备份？
**A**:
```bash
# 删除备份目录
rm -rf backups/backup-20260201_143022

# 删除压缩包
rm backups/backup-20260201_143022.zip

# 删除Git分支
git branch -D backup-20260201_143022
```

### Q5: 恢复会覆盖当前数据吗？
**A**: 会，但恢复脚本会先备份当前数据到 `data-old/` 和 `.env.old`

### Q6: 可以只恢复数据库吗？
**A**: 可以，手动复制：
```bash
cp backups/backup-20260201_235801/products.db data/products.db
```

### Q7: 备份脚本失败怎么办？
**A**: 使用方案B（手动复制），最简单可靠

---

## 💡 最佳实践

### 1. 定期备份
```bash
# 每周备份一次
python scripts/backup.py

# 重大变更前备份
python scripts/backup.py
```

### 2. 备份命名
```bash
# 使用清晰的分支名
git checkout -b backup-before-htmx-migration-20260201
git checkout -b backup-before-db-migration-20260205
git checkout -b backup-weekly-20260208
```

### 3. 多重备份
```bash
# 1. 自动备份（Git + 文件）
python scripts/backup.py

# 2. 手动复制（双保险）
# 复制整个项目文件夹

# 3. 云存储（可选）
# 上传压缩包到OneDrive/Google Drive
```

### 4. 验证备份
```bash
# 每次备份后验证
python scripts/restore.py --list
cat backups/backup-20260201_235801/BACKUP_INFO.txt
```

---

## 📞 获取帮助

### 查看备份脚本帮助
```bash
python scripts/backup.py --help
```

### 查看恢复脚本帮助
```bash
python scripts/restore.py --help
```

### 查看详细文档
```bash
# 查看完整文档
cat docs/项目备份与恢复方案.md
```

---

## 总结

### 最简单的方法
```bash
# 备份
python scripts/backup.py

# 恢复
python scripts/restore.py backup-20260201_235801
```

### 最快的恢复
```bash
# 从Git分支恢复（5分钟）
git checkout backup-20260201_235801
```

### 最安全的方法
```bash
# 三重备份
1. python scripts/backup.py
2. 手动复制整个项目
3. 上传压缩包到云存储
```

---

**现在可以安全地进行架构迁移了！**

**推荐操作**:
1. 运行 `python scripts/backup.py` 创建备份
2. 记录备份名称
3. 开始迁移工作
4. 如有问题，随时恢复

---

**文档创建者**: Claude Sonnet 4.5
**创建日期**: 2026-02-01
**文档状态**: ✅ 完整
