# 词性筛选行为说明

## 问题背景

在 Phase 0 的分词结果页面，用户可以选择词性（如"名词"、"动词"等）来筛选单词。但短语（n-gram）由多个词组成，无法简单标注为单一词性。

## 修复前的问题

**问题现象：** 当用户选择任何词性筛选时，所有短语都会消失。

**原因分析：**
```python
# 修复前的代码（第629行）
df_all = df_all[df_all['词性分类'].isin(selected_en)]
```

这行代码的逻辑是：只保留"词性分类"列的值在所选词性列表中的行。

- 单词有词性标注，例如 `'词性分类' = 'Noun'`（名词）
- 短语的 `'词性分类' = ''`（空字符串）
- 当用户选择"名词"时，系统只保留 `词性分类 == 'Noun'` 的行
- 所有短语（`词性分类 == ''`）都被排除了

**实际效果：**
1. 用户选择"名词" → 只显示名词单词，所有短语消失
2. 用户选择"动词" → 只显示动词单词，所有短语消失
3. 界面提示"仅对单词有效（短语无词性）"，但实际上短语被过滤掉了

## 修复方案

**核心原则：** 词性筛选只作用于单词，短语始终显示

**修复后的代码（ui/pages/phase0_expansion.py 第629-632行）：**
```python
# 筛选条件：词性匹配 OR 是短语（词数>1）
df_all = df_all[
    df_all['词性分类'].isin(selected_en) | (df_all['词数'] > 1)
]
```

**逻辑说明：**
- `df_all['词性分类'].isin(selected_en)`：单词的词性匹配所选词性
- `|`：逻辑OR
- `(df_all['词数'] > 1)`：是短语（词数大于1）

**效果：**
1. 用户选择"名词" → 显示所有名词单词 + 所有短语
2. 用户选择"动词" → 显示所有动词单词 + 所有短语
3. 用户选择"名词+动词" → 显示所有名词和动词单词 + 所有短语

## 设计理由

### 为什么短语不应该被词性筛选？

1. **语言学理由：** 短语是多词组合，无法简单标注为单一词性
   - "best free" - "best"是形容词，"free"也是形容词，但整体可能作为名词性短语
   - "how to" - "how"是疑问词，"to"是介词，整体是疑问结构
   - 无法用单一词性标签准确描述

2. **用户体验理由：** 用户通常希望同时看到筛选后的单词 + 所有短语
   - 短语通常是高价值的扩展线索（如 "best free"、"how to"）
   - 用户不希望在筛选词性时丢失这些重要信息
   - 界面已明确提示"仅对单词有效（短语无词性）"

3. **数据驱动理由：** 短语提取是基于频次的统计方法，不涉及词性
   - 短语是从关键词中自动提取的高频组合
   - 用户筛选词性是为了聚焦某类单词，但仍需要看到所有短语模式

## 替代方案（未采用）

### 方案B：为短语标注词性
**思路：** 为每个短语标注一个"主词性"（如基于head word）

**优点：** 短语可以参与词性筛选

**缺点：**
- 实现复杂：需要解析短语结构，识别中心词
- 准确性低：很多短语的"主词性"很难确定（如 "best free"）
- 用户困惑：用户可能不理解为什么"best free"被标为"形容词"
- 过度筛选：用户可能无意中过滤掉重要短语

### 方案C：添加"同时显示短语"复选框
**思路：** 在词性筛选旁边添加一个复选框"同时显示短语"

**优点：** 用户可以手动控制

**缺点：**
- 增加UI复杂度
- 默认值难以选择（默认勾选 vs 默认不勾选）
- 大多数情况下用户都希望看到短语，增加额外操作步骤

## 测试验证

### 测试场景1：选择单一词性
**操作：** 选择"名词"
**期望结果：** 显示所有名词单词 + 所有短语
**实际结果：** ✅ 符合预期

### 测试场景2：选择多个词性
**操作：** 选择"名词"+"动词"
**期望结果：** 显示所有名词和动词单词 + 所有短语
**实际结果：** ✅ 符合预期

### 测试场景3：不选择词性
**操作：** 词性筛选为空
**期望结果：** 显示所有单词 + 所有短语
**实际结果：** ✅ 符合预期（筛选不生效）

### 测试场景4：仅短语（边界情况）
**操作：** 选择词数筛选只保留短语（词数>1），然后选择"名词"
**期望结果：** 仍显示所有短语（因为短语不受词性筛选影响）
**实际结果：** ✅ 符合预期

## 相关文件

- `ui/pages/phase0_expansion.py` (修改)
  - 第624-632行：修复后的词性筛选逻辑

## 未来改进

如果未来需要更复杂的短语筛选功能，可以考虑：
1. 添加独立的"短语模式筛选"（如筛选包含特定词性组合的短语）
2. 基于短语的语义分类（如"疑问型"、"比较级"等）
3. 基于短语的业务价值分类（如"购买意图"、"问题搜索"等）

## 反馈

如有任何问题或建议，欢迎反馈！
