# å­—æ®µå‘½åè§„èŒƒï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

## ğŸ“‹ è§„èŒƒç›®çš„

é˜²æ­¢å› å­—æ®µåä¸ä¸€è‡´å¯¼è‡´çš„bugï¼Œç‰¹åˆ«æ˜¯ï¼š
- âŒ `direction_keywords` vs `direction_keyword`ï¼ˆå•å¤æ•°æ··ç”¨ï¼‰
- âŒ `cluster_id` åœ¨ä¸åŒé˜¶æ®µæ··æ·†
- âŒ `seed` vs `seed_word`ï¼ˆå‘½åä¸å®Œæ•´ï¼‰

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

1. **å•å¤æ•°è§„åˆ™**ï¼š
   - å•ä¸ªå€¼ç”¨**å•æ•°**ï¼š`direction_keyword`, `seed_word`, `pattern_id`
   - åˆ—è¡¨/é›†åˆç”¨**å¤æ•°**ï¼š`seed_words_in_cluster`, `example_phrases`

2. **é˜¶æ®µæ ‡è¯†**ï¼š
   - é˜¶æ®µAçš„ç°‡ï¼š`cluster_id_A`
   - é˜¶æ®µBçš„ç°‡ï¼š`cluster_id_B`
   - ä¸è¦ç”¨é€šç”¨çš„ `cluster_id`ï¼ˆé™¤éåœ¨å•é˜¶æ®µè„šæœ¬å†…éƒ¨ï¼‰

3. **å®Œæ•´å‘½å**ï¼š
   - âœ… `seed_word` ï¼ˆå®Œæ•´ï¼‰
   - âŒ `seed` ï¼ˆä¸å®Œæ•´ï¼‰
   - âœ… `cluster_size` ï¼ˆæ˜ç¡®ï¼‰
   - âŒ `cluster` ï¼ˆæ¨¡ç³Šï¼‰

---

## ğŸ“ æ ‡å‡†å­—æ®µæ¸…å•

### 1. çŸ­è¯­ç›¸å…³å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| `phrase` | str | æœç´¢çŸ­è¯­ï¼ˆç»Ÿä¸€å°å†™ï¼‰ | "compress pdf online" |
| `frequency` | int | å‡ºç°é¢‘æ¬¡ | 15 |
| `search_volume` | int | æœˆæœç´¢é‡ | 8100 |
| `seed_word` | str | æ¥æºç§å­è¯ï¼ˆå•æ•°ï¼‰ | "compress" |
| `source_type` | str | æ¥æºç±»å‹ | "autocomplete_main" |

**ç¦æ­¢çš„å˜ä½“**ï¼š
- âŒ `Phrase` / `PHRASE` ï¼ˆå¤§å°å†™ä¸ç»Ÿä¸€ï¼‰
- âŒ `freq` ï¼ˆç¼©å†™ï¼‰
- âŒ `seed` ï¼ˆä¸å®Œæ•´ï¼‰

---

### 2. èšç±»ç›¸å…³å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| `cluster_id_A` | int | é˜¶æ®µAçš„ç°‡ç¼–å· | 5 |
| `cluster_id_B` | int | é˜¶æ®µBçš„ç°‡ç¼–å· | 12 |
| `cluster_size` | int | ç°‡å†…çŸ­è¯­æ•°é‡ | 87 |
| `cluster_title` | str | ç°‡çš„äººç±»å¯è¯»æ ‡é¢˜ | "PDFæ–‡ä»¶å‹ç¼©" |
| `is_noise` | bool | æ˜¯å¦å™ªéŸ³ç‚¹ | True |
| `noise_flag` | bool | æ˜¯å¦å™ªéŸ³ç°‡ï¼ˆç”¨äºsummaryè¡¨ï¼‰ | False |

**é˜¶æ®µæ ‡è¯†è§„åˆ™**ï¼š
```
é˜¶æ®µAçš„è¾“å‡ºæ–‡ä»¶ï¼š
- stageA_clusters.csv ä½¿ç”¨ cluster_id_A
- cluster_summary_A3.csv ä½¿ç”¨ cluster_id_A

é˜¶æ®µBçš„è¾“å‡ºæ–‡ä»¶ï¼š
- stageB_clusters.csv ä½¿ç”¨ cluster_id_B
- cluster_insights_stageB.csv ä½¿ç”¨ cluster_id_B

è·¨é˜¶æ®µå¼•ç”¨ï¼š
- direction_keywords.csv å¼•ç”¨ A é˜¶æ®µç°‡æ—¶ç”¨ from_cluster_id_A
```

**ç¦æ­¢çš„å˜ä½“**ï¼š
- âŒ `cluster` ï¼ˆä¸å®Œæ•´ï¼‰
- âŒ `cid` ï¼ˆç¼©å†™ï¼‰
- âŒ `cluster_id` åœ¨è·¨é˜¶æ®µæ–‡ä»¶ä¸­ï¼ˆä¼šæ··æ·†ï¼‰

---

### 3. æ–¹å‘ç›¸å…³å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| `direction_keyword` | str | æ–¹å‘å…³é”®è¯ï¼ˆå•æ•°ï¼Œç»Ÿä¸€ï¼‰ | "compress pdf" |
| `from_cluster_id_A` | int | æ¥æºäºé˜¶æ®µAçš„å“ªä¸ªç°‡ | 5 |
| `short_label` | str | ç®€çŸ­æ ‡ç­¾ | "compress_pdf" |

**é‡è¦**ï¼š
- âœ… æ‰€æœ‰æ–‡ä»¶ç»Ÿä¸€ä½¿ç”¨ `direction_keyword`ï¼ˆå•æ•°ï¼‰
- âŒ ä¸è¦ä½¿ç”¨ `direction_keywords`ï¼ˆå¤æ•°ï¼‰
- âŒ ä¸è¦ä½¿ç”¨ `direction` / `dir_keyword` ç­‰å˜ä½“

---

### 4. æ¨¡å¼ç›¸å…³å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| `pattern_id` | str | æ¨¡å¼ç¼–å· | "P01" |
| `pattern_title` | str | æ¨¡å¼æ ‡é¢˜ | "æ— æŸå‹ç¼©ä¸ä½“ç§¯å‡å°" |
| `typical_users` | str | å…¸å‹ç”¨æˆ·ï¼ˆJSONæˆ–é€—å·åˆ†éš”ï¼‰ | "['æ™®é€šç”¨æˆ·', 'officeå·¥ä½œäººå‘˜']" |

**ç¦æ­¢çš„å˜ä½“**ï¼š
- âŒ `pattern` ï¼ˆä¸å®Œæ•´ï¼‰
- âŒ `pid` ï¼ˆå®¹æ˜“ä¸process idæ··æ·†ï¼‰

---

### 5. éœ€æ±‚æ¡†æ¶å­—æ®µï¼ˆ5ç»´ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| `who` | str | ç”¨æˆ·è§’è‰² | "developer" |
| `what` | str | æ ¸å¿ƒä»»åŠ¡ | "å‹ç¼©PDFæ–‡æ¡£ä½“ç§¯" |
| `why` | str | ç°æœ‰æ–¹æ¡ˆé—®é¢˜ | "å‹ç¼©åè´¨é‡ä¸‹é™ä¸¥é‡" |
| `how_now` | str | å½“å‰è§£å†³æ–¹å¼ | "ä½¿ç”¨Adobe Acrobat" |
| `quality_bar` | str | æœŸæœ›å±æ€§ï¼ˆJSONæˆ–é€—å·åˆ†éš”ï¼‰ | "['æ— æŸ', 'å¿«é€Ÿ', 'æ‰¹é‡']" |
| `possible_monetization` | str | å¯èƒ½å˜ç°æ–¹å¼ | "['SaaS', 'freemium']" |

**å‘½åè§„åˆ™**ï¼š
- å…¨éƒ¨å°å†™
- å¤šä¸ªå•è¯ç”¨ä¸‹åˆ’çº¿è¿æ¥
- ä¸ä½¿ç”¨ç¼©å†™

---

### 6. è¾…åŠ©åˆ†æå­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| `word_count` | int | å•è¯æ•°é‡ | 4 |
| `phrase_length` | int | å­—ç¬¦é•¿åº¦ | 23 |
| `has_question_word` | bool | æ˜¯å¦åŒ…å«ç–‘é—®è¯ | True |
| `has_best_or_top` | bool | æ˜¯å¦åŒ…å«best/top | False |
| `query_type` | str | æŸ¥è¯¢ç±»å‹ | "tutorial" / "best_list" / "normal" |
| `is_question_like` | bool | æ˜¯å¦é—®å¥ | True |

---

### 7. åˆ—è¡¨/é›†åˆå­—æ®µï¼ˆå¤æ•°ï¼‰

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|-------|------|------|------|
| `seed_words_in_cluster` | str | è¯¥ç°‡æ¶‰åŠçš„ç§å­è¯é›†åˆ | "compress,pdf,tool" |
| `example_phrases` | str | ä»£è¡¨çŸ­è¯­åˆ—è¡¨ | "compress pdf;reduce pdf size;..." |

**æ ¼å¼è§„åˆ™**ï¼š
- é€—å·åˆ†éš”ï¼šç”¨äºç®€å•æ ‡ç­¾ï¼ˆå¦‚ seed_words_in_clusterï¼‰
- åˆ†å·åˆ†éš”ï¼šç”¨äºå®Œæ•´çŸ­è¯­ï¼ˆå¦‚ example_phrasesï¼‰
- JSONæ ¼å¼ï¼šç”¨äºç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚ quality_barï¼‰

---

### 8. äººå·¥å†³ç­–å­—æ®µ

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | å¯é€‰å€¼ |
|-------|------|------|--------|
| `review_decision` | str | äººå·¥å†³ç­– | "ç©º" / "ä¿ç•™" / "æš‚ç¼“" / "ä¸¢å¼ƒ" |
| `notes_for_human_review` | str | äººå·¥å¤‡æ³¨ | "è¿™ç°‡æ˜¯jobç±»ï¼Œæš‚ç¼“" |
| `is_non_digital_scenario` | bool | æ˜¯å¦éæ•°å­—äº§å“åœºæ™¯ | True / False |

---

## ğŸ“‹ æ–‡ä»¶çº§å­—æ®µè§„èŒƒ

### stageA_clusters.csvï¼ˆé˜¶æ®µAçŸ­è¯­çº§è¡¨ï¼‰

**å¿…éœ€å­—æ®µ**ï¼š
```
phrase, seed_word, source_type, frequency, search_volume,
cluster_id_A, cluster_size, is_noise
```

**å¯é€‰å­—æ®µ**ï¼š
```
word_count, phrase_length, query_type, is_question_like,
has_best_or_top, has_question_word
```

---

### cluster_summary_A3.csvï¼ˆé˜¶æ®µAç°‡çº§æ±‡æ€»ï¼‰

**å¿…éœ€å­—æ®µ**ï¼š
```
cluster_id_A, cluster_size, seed_words_in_cluster,
total_frequency, total_search_volume
```

**æ–°å¢å­—æ®µï¼ˆé‡è¦ï¼‰**ï¼š
```
example_phrases, avg_frequency, avg_search_volume,
noise_flag, notes_for_human_review
```

---

### direction_keywords.csvï¼ˆæ–¹å‘çº§å…³é”®è¯ï¼‰

**å¿…éœ€å­—æ®µ**ï¼š
```
direction_keyword, from_cluster_id_A, cluster_title, short_label,
total_frequency, cluster_size
```

**Trendsç›¸å…³å­—æ®µ**ï¼š
```
avg_score_12m, trend_direction
```

**æ–°å¢å†³ç­–å­—æ®µ**ï¼š
```
is_non_digital_scenario, review_decision
```

---

### cluster_insights_stageB.csvï¼ˆé˜¶æ®µBéœ€æ±‚åˆ†æï¼‰

**å¿…éœ€å­—æ®µ**ï¼š
```
direction_keyword, cluster_id_B, cluster_title,
who, what, why, how_now, quality_bar,
example_phrases, possible_monetization,
cluster_size, total_frequency
```

---

## ğŸ” éªŒè¯å·¥å…·

### PythonéªŒè¯å‡½æ•°

```python
# validation.py

REQUIRED_COLUMNS = {
    "stageA_clusters.csv": [
        "phrase", "seed_word", "source_type", "frequency",
        "cluster_id_A", "cluster_size", "is_noise"
    ],
    "cluster_summary_A3.csv": [
        "cluster_id_A", "cluster_size", "seed_words_in_cluster",
        "total_frequency", "example_phrases"
    ],
    "direction_keywords.csv": [
        "direction_keyword", "from_cluster_id_A", "cluster_title",
        "total_frequency", "is_non_digital_scenario", "review_decision"
    ],
    "cluster_insights_stageB.csv": [
        "direction_keyword", "cluster_id_B", "cluster_title",
        "who", "what", "why", "how_now", "quality_bar"
    ],
}

def validate_csv_columns(file_path, file_type):
    """éªŒè¯CSVæ–‡ä»¶çš„åˆ—åæ˜¯å¦ç¬¦åˆè§„èŒƒ"""
    import pandas as pd

    if file_type not in REQUIRED_COLUMNS:
        print(f"âš ï¸ æœªå®šä¹‰çš„æ–‡ä»¶ç±»å‹: {file_type}")
        return False

    try:
        df = pd.read_csv(file_path)
        required = set(REQUIRED_COLUMNS[file_type])
        actual = set(df.columns)

        missing = required - actual
        extra = actual - required

        if missing:
            print(f"âŒ ç¼ºå¤±å­—æ®µ: {missing}")
            return False

        if extra:
            print(f"âš ï¸ é¢å¤–å­—æ®µ: {extra}ï¼ˆå¯é€‰å­—æ®µï¼‰")

        print(f"âœ… {file_type} å­—æ®µéªŒè¯é€šè¿‡")
        return True

    except Exception as e:
        print(f"âŒ éªŒè¯å¤±è´¥: {e}")
        return False

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    validate_csv_columns(
        "D:/xiangmu/è¯æ ¹èšç±»éœ€æ±‚æŒ–æ˜/data/stageA_clusters.csv",
        "stageA_clusters.csv"
    )
```

---

## ğŸš¨ å¸¸è§é”™è¯¯ç¤ºä¾‹

### é”™è¯¯1ï¼šå•å¤æ•°æ··ç”¨
```python
# âŒ é”™è¯¯
df['direction_keywords'] = "compress pdf"  # å•ä¸ªå€¼ä¸åº”è¯¥ç”¨å¤æ•°

# âœ… æ­£ç¡®
df['direction_keyword'] = "compress pdf"
```

### é”™è¯¯2ï¼šcluster_idè·¨é˜¶æ®µæ··ç”¨
```python
# âŒ é”™è¯¯ï¼šåœ¨direction_keywords.csvä¸­
df['cluster_id'] = 5  # ä¸æ˜ç¡®æ˜¯å“ªä¸ªé˜¶æ®µçš„

# âœ… æ­£ç¡®
df['from_cluster_id_A'] = 5  # æ˜ç¡®æ¥è‡ªé˜¶æ®µA
```

### é”™è¯¯3ï¼šå­—æ®µåç¼©å†™
```python
# âŒ é”™è¯¯
df['freq'] = 10
df['vol'] = 8100
df['cid'] = 5

# âœ… æ­£ç¡®
df['frequency'] = 10
df['search_volume'] = 8100
df['cluster_id_A'] = 5
```

---

## ğŸ“ è§„èŒƒæ›´æ–°è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | æ›´æ–°å†…å®¹ |
|------|------|----------|
| 2025-12-15 | v1.0 | åˆå§‹ç‰ˆæœ¬ |

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨åˆ›å»ºæ–°è„šæœ¬æˆ–ä¿®æ”¹ç°æœ‰è„šæœ¬æ—¶ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] æ‰€æœ‰å­—æ®µåä½¿ç”¨å°å†™+ä¸‹åˆ’çº¿
- [ ] å•ä¸ªå€¼ç”¨å•æ•°ï¼Œåˆ—è¡¨ç”¨å¤æ•°
- [ ] cluster_id æ˜ç¡®æ ‡æ³¨é˜¶æ®µï¼ˆcluster_id_A / cluster_id_Bï¼‰
- [ ] direction_keyword ç»Ÿä¸€ä½¿ç”¨å•æ•°
- [ ] ä¸ä½¿ç”¨ç¼©å†™ï¼ˆfrequency è€Œé freqï¼‰
- [ ] ä½¿ç”¨ validation.py éªŒè¯è¾“å‡ºæ–‡ä»¶
- [ ] æ›´æ–° REQUIRED_COLUMNS å­—å…¸ï¼ˆå¦‚æœæ–°å¢æ–‡ä»¶ç±»å‹ï¼‰

---

**å¼ºåˆ¶æ‰§è¡Œï¼šæ‰€æœ‰ä»£ç æäº¤å‰å¿…é¡»é€šè¿‡å­—æ®µéªŒè¯ï¼**
