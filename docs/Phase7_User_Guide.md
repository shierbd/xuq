# Phase 7 商品筛选与AI标注系统 - 使用指南

## 📋 目录

1. [系统概述](#系统概述)
2. [快速开始](#快速开始)
3. [功能详解](#功能详解)
4. [常见问题](#常见问题)
5. [最佳实践](#最佳实践)

---

## 系统概述

Phase 7 商品筛选与AI标注系统是一个强大的商品数据管理工具，支持：

- 📥 **批量导入**：CSV/Excel文件导入，支持无列名文件
- 🔍 **智能筛选**：多条件组合筛选，快速定位目标商品
- 🤖 **AI标注**：自动生成商品标签和需求分析
- ⚙️ **字段管理**：灵活的自定义字段系统
- 📤 **数据导出**：导出筛选结果为CSV/Excel

---

## 快速开始

### 方法一：使用Web UI（推荐）

1. **启动Web UI**
   ```bash
   streamlit run web_ui.py
   ```

2. **导航到Phase 7**
   - 在左侧菜单选择「📦 Phase 7: 商品筛选」

3. **导入数据**
   - 点击「📥 数据导入」
   - 上传CSV或Excel文件
   - 配置字段映射
   - 点击「🚀 开始导入」

### 方法二：使用命令行脚本

```bash
python scripts/import_products_quick.py "你的文件路径.xlsx"
```

**示例**：
```bash
python scripts/import_products_quick.py "C:\Users\32941\Downloads\合并表格_20260114_150935.xlsx"
```

---

## 功能详解

### 1. 📊 数据概览

**功能**：查看商品数据统计和AI标注进度

**显示内容**：
- 总商品数、平台分布
- AI分析状态（待分析、分析中、已完成、失败）
- AI标注进度条
- 快速操作按钮

**使用场景**：
- 了解当前数据规模
- 监控AI标注进度
- 快速导航到其他功能

---

### 2. 📥 数据导入

**功能**：从CSV/Excel文件导入商品数据

#### 支持的文件格式
- CSV（UTF-8, GBK, GB2312, Latin1编码）
- Excel（.xlsx, .xls）
- 支持无列名文件（按列索引映射）

#### 字段映射配置

**必填字段**：
- 商品名称

**可选字段**：
- 商品描述
- 价格
- 销量
- 评分
- 评价数
- 商品链接（无URL时自动生成占位符）
- 店铺名称

#### 操作步骤

1. **上传文件**
   - 点击「Browse files」或拖拽文件
   - 支持最大200MB

2. **预览数据**
   - 查看前5行数据
   - 确认数据格式正确

3. **配置字段映射**
   - 选择平台（etsy/gumroad）
   - 勾选「跳过重复数据」（推荐）
   - 为每个字段设置列索引（-1表示不映射）

4. **开始导入**
   - 点击「🚀 开始导入」
   - 等待导入完成
   - 查看导入统计

#### 示例配置

假设您的Excel文件结构如下：
```
列0: 商品名称
列1: 评分
列2: 销量
列3: 店铺名称
列4: 价格
```

字段映射配置：
```
商品名称 * → 0
评分 → 1
评价数 → 2（使用销量作为评价数）
店铺名称 → 3
价格 → 4
其他字段 → -1（不映射）
```

---

### 3. 🔍 商品筛选

**功能**：多条件筛选和查看商品详情

#### 筛选条件

**基础筛选**：
- 平台（全部/etsy/gumroad）
- AI分析状态（全部/pending/processing/completed/failed）
- 显示数量（10-1000）

**高级筛选**：
- 关键词搜索（搜索商品名称或描述）
- 最低评价数
- 价格范围（最低价格-最高价格）

#### 商品列表

显示字段：
- 商品ID
- 商品名称
- 价格
- 评分
- 评价数
- 平台
- AI分析状态
- 店铺名称

#### 商品详情

输入商品ID查看详细信息：
- 基本信息（名称、价格、评分、评价数、平台、店铺）
- AI分析结果（标签、需求分析）
- 商品描述
- 商品链接

---

### 4. 🤖 AI标注

**功能**：批量生成商品标签和需求分析

#### 标注配置

- **批次大小**：每批处理的商品数量（1-100）
- **自定义提示词**：可选，自定义AI分析提示词

#### 默认提示词模板

```
请分析以下商品信息，完成两个任务：

1. 生成3个中文标签，描述商品的类别、特点或用途
2. 判断这个商品解决了什么用户需求

商品信息：
- 名称：{product_name}
- 描述：{description}
- 价格：${price}
- 评分：{rating}星
- 评价数：{review_count}条

请以JSON格式返回结果：
{
    "tags": ["标签1", "标签2", "标签3"],
    "demand_analysis": "需求分析文本"
}
```

#### 操作步骤

1. 设置批次大小（建议10-20）
2. 可选：自定义提示词
3. 点击「🚀 开始AI标注」
4. 等待标注完成
5. 查看标注结果

#### 注意事项

- AI标注需要调用LLM API（DeepSeek/OpenAI/Claude）
- 确保API密钥已配置
- 批量标注可能需要较长时间
- 失败的标注可以重新执行

---

### 5. ⚙️ 字段管理

**功能**：管理商品表的自定义字段

#### 现有字段

查看所有字段定义：
- 字段ID
- 字段名称
- 字段键名
- 字段类型
- 是否必填
- 是否系统字段
- 字段顺序

#### 添加新字段

1. 输入字段名称（如：供应商名称）
2. 输入字段键名（如：supplier_name）
3. 选择字段类型：
   - text：文本
   - number：数字
   - date：日期
   - url：链接
   - tags：标签
   - select：单选
   - multi_select：多选
   - textarea：多行文本
4. 勾选「必填字段」（可选）
5. 输入字段描述
6. 点击「➕ 添加字段」

#### 删除字段

- 只能删除非系统字段
- 选择要删除的字段
- 点击「🗑️ 删除字段」

---

### 6. 📤 数据导出

**功能**：导出筛选后的商品数据

#### 导出配置

- **导出格式**：CSV / Excel
- **平台筛选**：全部 / etsy / gumroad
- **字段选择**：选择要导出的字段

#### 操作步骤

1. 选择导出格式
2. 选择平台筛选（可选）
3. 选择要导出的字段
4. 点击「📥 导出数据」
5. 下载导出文件

#### 导出文件命名

格式：`products_export_YYYYMMDD_HHMMSS.csv/xlsx`

示例：`products_export_20260114_191500.csv`

---

### 7. 📋 导入历史

**功能**：查看所有导入记录

#### 显示内容

- 源文件名
- 平台
- 导入状态（in_progress/completed/failed）
- 总行数
- 成功导入数
- 跳过数
- 耗时
- 错误信息（如果失败）
- 字段映射配置

#### 筛选条件

- 平台（全部/etsy/gumroad）
- 状态（全部/in_progress/completed/failed）

---

## 常见问题

### Q1: 文件上传失败怎么办？

**可能原因**：
- 文件格式不支持
- 文件大小超过200MB
- 文件编码问题

**解决方案**：
- 确认文件格式为CSV/XLSX/XLS
- 压缩文件或分批导入
- 尝试转换文件编码为UTF-8

---

### Q2: 数据中没有URL字段怎么办？

**解决方案**：
- URL字段现在是可选的
- 不映射URL字段时，系统会自动生成占位符URL
- 占位符格式：`https://placeholder.com/product/{hash}`

---

### Q3: 字段映射配置错误怎么办？

**解决方案**：
- 先导入少量数据测试
- 查看数据预览确认列索引
- 检查字段类型是否匹配
- 使用导入历史查看之前的映射配置

---

### Q4: AI标注失败怎么办？

**可能原因**：
- API密钥未配置或无效
- API调用超时
- 提示词格式错误

**解决方案**：
- 检查.env文件中的API密钥
- 减小批次大小
- 使用默认提示词模板
- 查看错误日志

---

### Q5: 如何批量修改商品数据？

**解决方案**：
1. 导出数据为CSV/Excel
2. 在Excel中批量修改
3. 重新导入（勾选「跳过重复数据」）
4. 系统会更新现有记录

---

## 最佳实践

### 1. 数据导入

✅ **推荐做法**：
- 先导入10-20条数据测试
- 确认字段映射正确后再批量导入
- 勾选「跳过重复数据」避免重复
- 保存字段映射配置供下次使用

❌ **避免做法**：
- 直接导入大量数据
- 不检查数据预览
- 频繁重复导入相同数据

---

### 2. AI标注

✅ **推荐做法**：
- 批次大小设置为10-20
- 先标注少量数据检查质量
- 使用自定义提示词优化结果
- 定期检查失败的标注

❌ **避免做法**：
- 批次大小过大（>50）
- 不检查标注质量
- 忽略失败的标注

---

### 3. 数据筛选

✅ **推荐做法**：
- 使用多条件组合筛选
- 先用关键词缩小范围
- 查看商品详情确认信息
- 导出筛选结果备份

❌ **避免做法**：
- 只用单一条件筛选
- 不查看详情直接操作
- 不备份重要数据

---

### 4. 字段管理

✅ **推荐做法**：
- 字段命名清晰明确
- 字段键名使用英文和下划线
- 添加字段描述说明用途
- 定期清理无用字段

❌ **避免做法**：
- 字段命名模糊
- 字段键名使用中文或特殊字符
- 不添加字段描述
- 保留大量无用字段

---

## 技术支持

如有问题，请：

1. 查看本使用指南
2. 查看系统日志
3. 查看导入历史中的错误信息
4. 联系技术支持

---

**文档版本**: v1.0
**更新日期**: 2026-01-14
**适用版本**: Phase 7 v1.0
