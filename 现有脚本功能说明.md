# 🎯 现有脚本满足的需求说明

**生成时间**: 2026-01-27
**目标**: 帮助你快速理解现有脚本能做什么

---

## 📋 核心需求对照表

### 现有脚本满足的需求

| 需求编号 | 需求名称 | 对应脚本 | 完成度 | 说明 |
|---------|---------|---------|--------|------|
| **P0-1** | 数据导入功能 | `step_A2_merge_csv.py` | ✅ 100% | 合并多源 CSV 数据 |
| **P0-2** | 语义聚类功能 | `step_A3_clustering.py` | ✅ 100% | 核心聚类算法 |
| **P0-3** | 聚类结果可视化 | `plot_clusters.py` | ✅ 100% | 生成交互式 HTML 图表 |
| **P0-4** | 方向筛选功能 | `manual_direction_selector.py` | ✅ 100% | 交互式筛选工具 |
| **P0-5** | 数据导出功能 | 所有脚本 | ✅ 100% | 自动导出 CSV 文件 |

**P0 需求完成度**: 100%（脚本层面）

---

## 🔄 完整工作流程

### 你的需求挖掘流程

根据 `docs/01_需求挖掘方法论.md`，你的核心需求是：

```
从单词种子 → 短语扩展 → 语义聚类 → 需求方向 → MVP验证
```

**具体流程**：

#### 阶段 A：从单词到方向
1. **A1**: 准备单词种子（如：compress, convert, generate）
2. **A2**: 扩展短语（从 SEMrush/Reddit/Related Search）
3. **A3**: 语义聚类（生成 60-100 个簇）
4. **A4**: 簇解释（可选，大模型分析）
5. **A5**: 人工筛选方向（选出 5-10 个方向）

#### 阶段 B：从方向到需求
1. **B1**: 方向扩展（每个方向扩展更多短语）
2. **B3**: 方向内聚类（二次聚类，发现子需求）
3. **B6**: 需求分析（5 维框架分析）

---

## ✅ 现有脚本能做什么

### 1️⃣ step_A2_merge_csv.py - 数据合并

**满足需求**: P0-1 数据导入功能

**功能**:
- ✅ 合并多个 CSV 文件
- ✅ 支持 SEMrush、Reddit、Related Search 数据
- ✅ 数据清洗和标准化
- ✅ 去重和频次统计

**输入**:
```
data/raw/
├── semrush_keywords.csv
├── reddit_keywords.csv
└── related_search_keywords.csv
```

**输出**:
```
data/merged_keywords_all.csv
```

**对应流程**: **A2 - 短语扩展**

---

### 2️⃣ step_A3_clustering.py - 语义聚类（核心）

**满足需求**: P0-2 语义聚类功能

**功能**:
- ✅ 使用 Sentence Transformers 进行向量化
- ✅ 使用 HDBSCAN 进行聚类
- ✅ 自动计算最优参数
- ✅ 生成簇级汇总统计
- ✅ 标记噪音点
- ✅ 提取代表性短语（example_phrases）

**输入**:
```
data/merged_keywords_all.csv
```

**输出**:
```
data/stageA_clusters.csv        # 短语级（带 cluster_id_A）
data/cluster_summary_A3.csv     # 簇级汇总
```

**关键字段**:
- `cluster_id_A`: 簇 ID
- `cluster_size`: 簇大小
- `example_phrases`: 代表性短语（最重要！）
- `seed_words_in_cluster`: 簇内种子词
- `is_noise`: 是否噪音点

**对应流程**: **A3 - 语义聚类**

---

### 3️⃣ cluster_stats.py - 质量分析

**满足需求**: P0-2 语义聚类功能（质量评估）

**功能**:
- ✅ 分析簇数量是否合理（目标 60-100）
- ✅ 分析噪音比例是否合理（目标 < 25%）
- ✅ 分析簇大小分布
- ✅ 提供参数调优建议

**输入**:
```
data/cluster_summary_A3.csv
```

**输出**:
```
终端输出质量报告
```

**对应流程**: **A3 - 聚类质量验证**

---

### 4️⃣ manual_direction_selector.py - 交互式方向筛选

**满足需求**: P0-4 方向筛选功能

**功能**:
- ✅ 交互式显示每个簇的信息
- ✅ 用户选择保留/跳过
- ✅ 为每个方向输入关键词
- ✅ 自动生成筛选结果

**输入**:
```
data/cluster_summary_A3.csv
```

**输出**:
```
data/direction_keywords.csv
```

**交互示例**:
```
Cluster 42 (size: 502)
Seeds: code
Examples: 00989 area code; 202 telephone code; 203 area code
Action? [K]eep / [S]kip / [Q]uit: K
Direction keyword: area_code
```

**对应流程**: **A5 - 人工筛选方向**

---

### 5️⃣ step_B3_cluster_stageB.py - 方向内聚类

**满足需求**: P0-2 语义聚类功能（二次聚类）

**功能**:
- ✅ 对每个方向内部进行二次聚类
- ✅ 发现方向内的子需求
- ✅ 生成方向内簇级统计
- ✅ 自动调整参数（根据短语数量）

**输入**:
```
data/direction_keywords.csv
data/stageA_clusters.csv
```

**输出**:
```
data/stageB_clusters.csv        # 短语级（带 cluster_id_B）
data/cluster_summary_B3.csv     # 方向内簇级汇总
```

**关键字段**:
- `cluster_id_B`: 格式为 `{direction}_B{id}`（如 `productivity_B0`）
- `direction_keyword`: 方向关键词
- `example_phrases`: 子簇代表性短语

**对应流程**: **B3 - 方向内聚类**

---

### 6️⃣ plot_clusters.py - 可视化

**满足需求**: P0-3 聚类结果可视化

**功能**:
- ✅ 可视化 A 阶段聚类结果（全局簇分布）
- ✅ 可视化 B 阶段聚类结果（方向内子簇）
- ✅ 使用 UMAP 降维到 2D
- ✅ 生成交互式 HTML 图表（Plotly）
- ✅ 悬停显示短语详情

**输入**:
```
data/stageA_clusters.csv  # A 阶段
data/stageB_clusters.csv  # B 阶段
```

**输出**:
```
output/clusters_visualization_A.html
output/clusters_visualization_B.html
```

**使用方法**:
```bash
# 可视化 A 阶段
python plot_clusters.py --stage A

# 可视化 B 阶段（全部方向）
python plot_clusters.py --stage B

# 可视化 B 阶段（指定方向）
python plot_clusters.py --stage B --direction productivity
```

**对应流程**: **A3/B3 - 结果可视化**

---

### 7️⃣ validation.py - 字段验证

**满足需求**: P0-1 数据导入功能（数据验证）

**功能**:
- ✅ 验证 CSV 文件字段是否符合规范
- ✅ 支持 A 阶段和 B 阶段文件验证
- ✅ 检查必需字段是否存在
- ✅ 检查字段类型是否正确

**输入**:
```
data/stageA_clusters.csv
data/cluster_summary_A3.csv
data/direction_keywords.csv
data/stageB_clusters.csv
data/cluster_summary_B3.csv
```

**输出**:
```
终端输出验证结果
```

**对应流程**: **数据质量保证**

---

## 🎯 完整使用流程

### 轻量版流程（推荐首次使用）

```bash
# 进入脚本目录
cd scripts

# ========== 阶段 A：从单词到方向 ==========

# 步骤 1: 合并 CSV 数据（如果还没有 merged_keywords_all.csv）
python step_A2_merge_csv.py
# 输出: data/merged_keywords_all.csv

# 步骤 2: 执行语义聚类
python step_A3_clustering.py
# 输出: data/stageA_clusters.csv
#       data/cluster_summary_A3.csv

# 步骤 3: 查看质量报告
python cluster_stats.py
# 输出: 终端显示质量分析

# 步骤 4: 验证字段规范
python validation.py
# 输出: 终端显示验证结果

# 步骤 5: 人工筛选方向（交互式）
python manual_direction_selector.py
# 输出: data/direction_keywords.csv

# ========== 阶段 B：从方向到需求 ==========

# 步骤 6: 方向内聚类
python step_B3_cluster_stageB.py
# 输出: data/stageB_clusters.csv
#       data/cluster_summary_B3.csv

# 步骤 7: 可视化（可选）
python plot_clusters.py --stage A
python plot_clusters.py --stage B
# 输出: output/clusters_visualization_A.html
#       output/clusters_visualization_B.html
```

---

## 📊 数据流转图

```
原始数据
├── semrush_keywords.csv
├── reddit_keywords.csv
└── related_search_keywords.csv
    ↓
[step_A2_merge_csv.py]
    ↓
merged_keywords_all.csv (6,566 条短语)
    ↓
[step_A3_clustering.py]
    ↓
├── stageA_clusters.csv (6,345 条，带 cluster_id_A)
└── cluster_summary_A3.csv (65 个簇)
    ↓
[cluster_stats.py] → 质量报告
[validation.py] → 字段验证
    ↓
[manual_direction_selector.py] → 人工筛选
    ↓
direction_keywords.csv (6 个方向)
    ↓
[step_B3_cluster_stageB.py]
    ↓
├── stageB_clusters.csv (1,057 条，带 cluster_id_B)
└── cluster_summary_B3.csv (10 个子簇)
    ↓
[plot_clusters.py] → 可视化 HTML
```

---

## 🎯 你的实际数据

根据检查，你已经有完整的数据：

```
✅ merged_keywords_all.csv: 6,566 条短语
✅ stageA_clusters.csv: 6,345 条（已聚类）
✅ cluster_summary_A3.csv: 65 个簇
✅ direction_keywords.csv: 6 个筛选方向
✅ stageB_clusters.csv: 1,057 条（方向内聚类）
✅ cluster_summary_B3.csv: 10 个子簇
```

**这意味着**：
- ✅ 你已经运行过完整的流程
- ✅ 所有脚本都已经测试通过
- ✅ 数据是真实可用的

---

## 🚀 你现在可以做什么

### 选项 1：查看现有结果

```bash
# 查看 A 阶段聚类结果（65 个簇）
cat data/cluster_summary_A3.csv

# 查看筛选出的方向（6 个）
cat data/direction_keywords.csv

# 查看 B 阶段聚类结果（10 个子簇）
cat data/cluster_summary_B3.csv

# 在浏览器中查看可视化（如果已生成）
# 打开 output/clusters_visualization_A.html
# 打开 output/clusters_visualization_B.html
```

---

### 选项 2：重新运行流程（使用新数据）

如果你有新的数据源：

```bash
# 1. 准备新数据
# 将新的 CSV 文件放到 data/raw/ 目录

# 2. 重新运行完整流程
cd scripts
python step_A2_merge_csv.py
python step_A3_clustering.py
python cluster_stats.py
python manual_direction_selector.py
python step_B3_cluster_stageB.py
python plot_clusters.py --stage A
python plot_clusters.py --stage B
```

---

### 选项 3：调优聚类参数

如果你觉得簇太多/太少：

```bash
# 1. 编辑配置文件
# 打开 scripts/config.py

# 2. 修改参数
A3_CONFIG = {
    "min_cluster_size": 20,  # 增大→簇变少，减小→簇变多
    "use_dynamic_params": False,  # 禁用动态参数
}

# 3. 重新运行聚类
python step_A3_clustering.py
python cluster_stats.py
```

---

## ❌ 现有脚本不能做什么

### P1 需求（未实现）

| 需求 | 状态 | 说明 |
|------|------|------|
| **AI 辅助分析** | ❌ 未实现 | 需要调用 Claude API 生成簇解释 |
| **方向扩展功能** | ❌ 未实现 | 需要从 SEMrush/Reddit 扩展更多短语 |
| **需求分析功能** | ❌ 未实现 | 需要 5 维框架分析（用户意图、痛点等）|

### P2 需求（未实现）

| 需求 | 状态 | 说明 |
|------|------|------|
| **趋势分析** | ❌ 未实现 | 需要集成 Google Trends API |
| **协作功能** | ❌ 未实现 | 需要 Web 应用支持多用户 |
| **需求库管理** | ❌ 未实现 | 需要数据库和 Web 界面 |

---

## 📝 总结

### 现有脚本满足的核心需求

**你的核心需求**：
> 从英文单词种子（word roots）发现产品机会方向

**现有脚本能做的**：
1. ✅ **数据合并**：整合多源数据
2. ✅ **语义聚类**：发现语义相似的短语群
3. ✅ **质量分析**：评估聚类质量
4. ✅ **方向筛选**：人工选出有价值的方向
5. ✅ **方向深化**：对每个方向进行二次聚类
6. ✅ **结果可视化**：生成交互式图表
7. ✅ **数据导出**：所有结果导出为 CSV

**对应的方法论流程**：
- ✅ A2: 短语扩展
- ✅ A3: 语义聚类
- ✅ A5: 人工筛选方向
- ✅ B3: 方向内聚类

**完成度**：
- 轻量版流程：✅ 100% 完成
- 完整版流程：🟡 60% 完成（缺少 A4、B1、B2、B6、B7、B8）

---

## 🎯 下一步

你现在有两个选择：

### 选择 1：查看现有结果（推荐）

```bash
# 查看你已经生成的结果
cat data/cluster_summary_A3.csv
cat data/direction_keywords.csv
cat data/cluster_summary_B3.csv
```

我可以帮你：
- 解读这些结果
- 分析发现的需求方向
- 评估哪些方向值得做 MVP

---

### 选择 2：重新运行流程

```bash
# 使用新数据重新运行
cd scripts
python step_A3_clustering.py
```

我可以帮你：
- 准备新的数据源
- 调优聚类参数
- 解决运行中的问题

---

**你想先做什么？**
1. 查看现有结果，分析需求方向
2. 重新运行流程，使用新数据
3. 其他需求

请告诉我你的选择，我会提供具体的操作指导。

---

**文档生成者**: Claude Sonnet 4.5
**生成时间**: 2026-01-27
