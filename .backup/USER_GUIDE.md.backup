# è¯æ ¹èšç±»éœ€æ±‚æŒ–æ˜ç³»ç»Ÿ - å®Œæ•´ä½¿ç”¨è¯´æ˜

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
4. [ä½¿ç”¨æ–¹å¼é€‰æ‹©](#ä½¿ç”¨æ–¹å¼é€‰æ‹©)
   - [Web UIï¼ˆæ¨èï¼‰](#web-uiæ¨è)
   - [å‘½ä»¤è¡Œï¼ˆé«˜çº§ï¼‰](#å‘½ä»¤è¡Œé«˜çº§)
5. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
6. [å®Œæ•´å·¥ä½œæµ](#å®Œæ•´å·¥ä½œæµ)
7. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
8. [è¾“å‡ºæ–‡ä»¶è¯´æ˜](#è¾“å‡ºæ–‡ä»¶è¯´æ˜)
9. [APIæˆæœ¬ç®¡ç†](#apiæˆæœ¬ç®¡ç†)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
11. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
12. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)

---

## é¡¹ç›®ç®€ä»‹

### ä»€ä¹ˆæ˜¯è¯æ ¹èšç±»éœ€æ±‚æŒ–æ˜ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªåŸºäºNLPå’Œæœºå™¨å­¦ä¹ çš„éœ€æ±‚æŒ–æ˜ç³»ç»Ÿï¼Œé€šè¿‡åˆ†æå¤§é‡æœç´¢å…³é”®è¯æ¥å‘ç°ç”¨æˆ·éœ€æ±‚æ¨¡å¼ã€‚ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚èšç±»ç­–ç•¥ï¼Œå°†æ•°ä¸‡æ¡å…³é”®è¯çŸ­è¯­ç»„ç»‡æˆæœ‰æ„ä¹‰çš„éœ€æ±‚ä¸»é¢˜ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆéœ€æ±‚å¡ç‰‡ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- **æ™ºèƒ½èšç±»**: ä½¿ç”¨HDBSCANç®—æ³•å¯¹çŸ­è¯­è¿›è¡Œè¯­ä¹‰èšç±»
- **AIä¸»é¢˜ç”Ÿæˆ**: ä½¿ç”¨LLMè‡ªåŠ¨ç”Ÿæˆèšç±»ä¸»é¢˜æ ‡ç­¾
- **éœ€æ±‚å¡ç‰‡ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–éœ€æ±‚å¡ç‰‡åˆç¨¿
- **Tokenæå–**: å»ºç«‹éœ€æ±‚æ¡†æ¶è¯åº“ï¼Œæ”¯æŒéœ€æ±‚æ¨¡æ¿åŒ–
- **å¢é‡æ›´æ–°**: æ”¯æŒæ–°æ•°æ®å¯¼å…¥å’Œå†å²æ•°æ®ç®¡ç†

### é€‚ç”¨åœºæ™¯

- äº§å“éœ€æ±‚æŒ–æ˜
- å¸‚åœºè¶‹åŠ¿åˆ†æ
- å†…å®¹ç­–ç•¥è§„åˆ’
- SEOå…³é”®è¯åˆ†æ
- ç”¨æˆ·æ„å›¾ç ”ç©¶

---

## ç³»ç»Ÿæ¶æ„

### å…­é˜¶æ®µå·¥ä½œæµ

```
Phase 1: æ•°æ®å¯¼å…¥           Phase 2: å¤§ç»„èšç±»           Phase 3: äººå·¥ç­›é€‰
   åŸå§‹CSVæ–‡ä»¶        â†’     è¯­ä¹‰èšç±»ï¼ˆLevel Aï¼‰    â†’    é€‰æ‹©æœ‰ä»·å€¼çš„èšç±»
   (55,275æ¡)              (307ä¸ªå¤§ç»„)                 (20-40ä¸ªå¤§ç»„)
         â†“                        â†“                          â†“
Phase 4: å°ç»„èšç±» + éœ€æ±‚å¡ç‰‡ç”Ÿæˆ                 Phase 5: Tokenæå–
   ç»†ç²’åº¦èšç±»ï¼ˆLevel Bï¼‰                          æå–å…³é”®è¯å¹¶åˆ†ç±»
   LLMç”Ÿæˆéœ€æ±‚å¡ç‰‡                                å»ºç«‹éœ€æ±‚è¯åº“
   (100-600ä¸ªéœ€æ±‚)                                (1000-5000ä¸ªtokens)
         â†“
Phase 6: å¢é‡æ›´æ–°ï¼ˆæœªæ¥ï¼‰
   æ–°æ•°æ®å¯¼å…¥
   å™ªéŸ³ç‚¹é‡æ–°åˆ†é…
```

### æŠ€æœ¯æ ˆ

- **æ•°æ®åº“**: MySQL 8.0+ / MariaDB 10.5+
- **Python**: 3.8+
- **NLPæ¡†æ¶**: OpenAI Embeddings, HDBSCAN
- **LLM**: OpenAI / Anthropic / Deepseek
- **æ•°æ®å¤„ç†**: Pandas, NumPy, SQLAlchemy

---

## ç¯å¢ƒé…ç½®

### 1. ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 10/11, macOS, Linux
- **Pythonç‰ˆæœ¬**: 3.8 æˆ–æ›´é«˜
- **å†…å­˜**: å»ºè®® 8GB+ï¼ˆå¤„ç†å¤§è§„æ¨¡æ•°æ®æ—¶ï¼‰
- **ç£ç›˜ç©ºé—´**: 5GB+ï¼ˆåŒ…å«embeddingsç¼“å­˜ï¼‰

### 2. å®‰è£…Pythonä¾èµ–

```bash
# å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®
cd è¯æ ¹èšç±»éœ€æ±‚æŒ–æ˜

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

**ä¸»è¦ä¾èµ–åŒ…:**
```
sqlalchemy>=2.0.0
pymysql>=1.0.0
pandas>=2.0.0
numpy>=1.24.0
scikit-learn>=1.3.0
hdbscan>=0.8.33
openai>=1.0.0
anthropic>=0.7.0
python-dotenv>=1.0.0
tqdm>=4.65.0
```

### 3. é…ç½®æ•°æ®åº“

#### æ–¹æ³•A: MySQL/MariaDBï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# 1. åˆ›å»ºæ•°æ®åº“
mysql -u root -p
CREATE DATABASE search_demand_mining CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'demand_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON search_demand_mining.* TO 'demand_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;

# 2. é…ç½®è¿æ¥
# ç¼–è¾‘ config/settings.py
DATABASE_CONFIG = {
    'host': 'localhost',
    'port': 3306,
    'user': 'demand_user',
    'password': 'your_password',
    'database': 'search_demand_mining',
    'charset': 'utf8mb4'
}
```

#### æ–¹æ³•B: SQLiteï¼ˆæ¨èå¼€å‘/æµ‹è¯•ï¼‰

```python
# config/settings.py
DATABASE_CONFIG = {
    'type': 'sqlite',
    'database': 'data/search_demand.db'
}
```

### 4. é…ç½®LLM API

#### OpenAIï¼ˆæ¨èï¼Œæ€§ä»·æ¯”é«˜ï¼‰

```python
# config/settings.py
LLM_PROVIDER = "openai"

LLM_CONFIG = {
    "openai": {
        "api_key": "sk-your-api-key",
        "model": "gpt-4o-mini",  # æˆ– gpt-4o
        "base_url": None,
        "temperature": 0.7,
        "max_tokens": 2000
    }
}
```

**è·å–APIå¯†é’¥**: https://platform.openai.com/api-keys

#### Anthropic Claude

```python
LLM_PROVIDER = "anthropic"

LLM_CONFIG = {
    "anthropic": {
        "api_key": "sk-ant-your-api-key",
        "model": "claude-3-5-sonnet-20241022",
        "temperature": 0.7,
        "max_tokens": 2000
    }
}
```

**è·å–APIå¯†é’¥**: https://console.anthropic.com/

#### Deepseekï¼ˆæœ€ä½æˆæœ¬ï¼‰

```python
LLM_PROVIDER = "deepseek"

LLM_CONFIG = {
    "deepseek": {
        "api_key": "your-deepseek-key",
        "model": "deepseek-chat",
        "base_url": "https://api.deepseek.com",
        "temperature": 0.7,
        "max_tokens": 2000
    }
}
```

**è·å–APIå¯†é’¥**: https://platform.deepseek.com/

### 5. é…ç½®EmbeddingæœåŠ¡

```python
# config/settings.py
EMBEDDING_CONFIG = {
    "provider": "openai",  # æˆ– "sentence_transformers"
    "model": "text-embedding-3-small",  # OpenAI embeddingæ¨¡å‹
    "batch_size": 100,
    "cache_enabled": True
}
```

### 6. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºæ‰€æœ‰æ•°æ®è¡¨
python scripts/init_database.py
```

**è¾“å‡ºç¤ºä¾‹:**
```
âœ“ æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ“ åˆ›å»ºè¡¨: phrases
âœ“ åˆ›å»ºè¡¨: cluster_meta
âœ“ åˆ›å»ºè¡¨: demands
âœ“ åˆ›å»ºè¡¨: tokens
âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
```

---

## ä½¿ç”¨æ–¹å¼é€‰æ‹©

æœ¬ç³»ç»Ÿæä¾›**ä¸¤ç§ä½¿ç”¨æ–¹å¼**ï¼šWeb UIï¼ˆå›¾å½¢ç•Œé¢ï¼‰å’Œå‘½ä»¤è¡Œï¼ˆCLIï¼‰ã€‚

### Web UIï¼ˆæ¨èï¼‰

**é€‚åˆäººç¾¤**ï¼šæ‰€æœ‰ç”¨æˆ·ï¼Œç‰¹åˆ«æ˜¯ä¸ç†Ÿæ‚‰å‘½ä»¤è¡Œçš„ç”¨æˆ·

**ä¼˜åŠ¿**ï¼š
- âœ… **å¯è§†åŒ–æ“ä½œ**ï¼šç‚¹å‡»æŒ‰é’®å³å¯å®Œæˆæ‰€æœ‰æ“ä½œ
- âœ… **å®æ—¶ç›‘æ§**ï¼šæŸ¥çœ‹å®æ—¶æ—¥å¿—å’Œè¿›åº¦
- âœ… **æ•°æ®æŸ¥çœ‹**ï¼šåœ¨çº¿æµè§ˆèšç±»ã€éœ€æ±‚å¡ç‰‡ã€Tokens
- âœ… **HTMLå¯¼å‡º**ï¼šæ”¯æŒæµè§ˆå™¨ç¿»è¯‘ï¼ˆChrome/Edgeå³é”®ç¿»è¯‘ï¼‰
- âœ… **å‚æ•°è°ƒæ•´**ï¼šå¯è§†åŒ–è°ƒæ•´èšç±»å‚æ•°
- âœ… **é…ç½®æµ‹è¯•**ï¼šæµ‹è¯•æ•°æ®åº“å’ŒLLMè¿æ¥
- âœ… **é›†æˆæ–‡æ¡£**ï¼šå†…ç½®å®Œæ•´ä½¿ç”¨æ–‡æ¡£

**å¯åŠ¨æ–¹å¼**ï¼š

```bash
# 1. å®‰è£…Streamlitï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
pip install streamlit

# 2. å¯åŠ¨Web UI
streamlit run web_ui.py

# 3. æµè§ˆå™¨è®¿é—®
# è‡ªåŠ¨æ‰“å¼€ï¼Œæˆ–æ‰‹åŠ¨è®¿é—®: http://localhost:8501
```

**ç•Œé¢åŠŸèƒ½**ï¼š

| é¡µé¢ | åŠŸèƒ½ |
|------|------|
| ğŸ  é¦–é¡µæ¦‚è§ˆ | å·¥ä½œæµç¨‹å›¾ã€æ•°æ®ç»Ÿè®¡ã€å¿«é€Ÿæ“ä½œ |
| ğŸ“¥ Phase 1: æ•°æ®å¯¼å…¥ | CSVæ–‡ä»¶å¯¼å…¥ã€æ•°æ®æºé€‰æ‹©ã€å®æ—¶æ—¥å¿— |
| ğŸ”„ Phase 2: å¤§ç»„èšç±» | å‚æ•°è°ƒæ•´ã€èšç±»æ‰§è¡Œã€ç»“æœç»Ÿè®¡ |
| âœ… Phase 3: èšç±»ç­›é€‰ | å¯¼å‡ºCSV/HTMLã€åœ¨çº¿æŸ¥çœ‹ã€å¯¼å…¥æ ‡è®° |
| ğŸ“Š Phase 4: éœ€æ±‚ç”Ÿæˆ | å°ç»„èšç±»ã€éœ€æ±‚å¡ç‰‡ç”Ÿæˆã€æŸ¥çœ‹è¯¦æƒ… |
| ğŸ·ï¸ Phase 5: Tokenæå– | å‚æ•°è®¾ç½®ã€TokenæŸ¥çœ‹ã€è¯äº‘ç”Ÿæˆ |
| ğŸ“‹ æ•°æ®æŸ¥çœ‹ä¸ç®¡ç† | **HTMLå¯¼å‡ºï¼ˆæ”¯æŒæµè§ˆå™¨ç¿»è¯‘ï¼‰**ã€æ•°æ®ç­›é€‰ |
| âš™ï¸ é…ç½®ç®¡ç† | é…ç½®æŸ¥çœ‹ã€è¿æ¥æµ‹è¯•ã€APIæˆæœ¬ä¼°ç®— |
| ğŸ“– ä½¿ç”¨è¯´æ˜ | å†…ç½®æ–‡æ¡£ã€å¿«é€Ÿå‚è€ƒã€å¤–éƒ¨èµ„æº |

**ğŸ’¡ ç‰¹åˆ«åŠŸèƒ½ï¼šHTMLå¯¼å‡º + æµè§ˆå™¨ç¿»è¯‘**

å¦‚æœä½ ä¸æ‡‚è‹±è¯­ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼š
1. åœ¨"æ•°æ®æŸ¥çœ‹ä¸ç®¡ç†"é¡µé¢ç‚¹å‡» **"ğŸ“¤ å¯¼å‡ºä¸ºHTML"**
2. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç”Ÿæˆçš„HTMLæ–‡ä»¶
3. **å³é”®ç‚¹å‡»é¡µé¢** â†’ é€‰æ‹©"ç¿»è¯‘ä¸ºä¸­æ–‡"ï¼ˆChrome/Edgeï¼‰
4. æ‰€æœ‰è‹±æ–‡çŸ­è¯­å’Œéœ€æ±‚ä¼šè‡ªåŠ¨ç¿»è¯‘æˆä¸­æ–‡ï¼

**è¯¦ç»†æ–‡æ¡£**ï¼š[WEB_UI_README.md](../WEB_UI_README.md)

---

### å‘½ä»¤è¡Œï¼ˆé«˜çº§ï¼‰

**é€‚åˆäººç¾¤**ï¼šç†Ÿæ‚‰å‘½ä»¤è¡Œã€éœ€è¦è‡ªåŠ¨åŒ–è„šæœ¬ã€æ‰¹é‡å¤„ç†çš„é«˜çº§ç”¨æˆ·

**ä¼˜åŠ¿**ï¼š
- âœ… **è‡ªåŠ¨åŒ–**ï¼šå¯ç¼–å†™è„šæœ¬æ‰¹é‡å¤„ç†
- âœ… **çµæ´»æ€§**ï¼šé«˜çº§å‚æ•°æ§åˆ¶
- âœ… **è¿œç¨‹æ‰§è¡Œ**ï¼šSSHè¿œç¨‹è¿è¡Œ
- âœ… **CI/CDé›†æˆ**ï¼šå¯é›†æˆåˆ°è‡ªåŠ¨åŒ–æµç¨‹

**ä½¿ç”¨æ–¹å¼**ï¼š

```bash
# Phase 1: æ•°æ®å¯¼å…¥
python scripts/run_phase1_import.py

# Phase 2: å¤§ç»„èšç±»
python scripts/run_phase2_clustering.py

# Phase 3: èšç±»ç­›é€‰ï¼ˆéœ€æ‰‹åŠ¨ç¼–è¾‘CSVï¼‰
# å¯¼å‡º â†’ ç¼–è¾‘ â†’ å¯¼å…¥

# Phase 4: éœ€æ±‚ç”Ÿæˆ
python scripts/run_phase4_demands.py

# Phase 5: Tokenæå–
python scripts/run_phase5_tokens.py
```

**è¯¦ç»†è¯´æ˜**ï¼šè§ä¸‹æ–¹"å®Œæ•´å·¥ä½œæµ"ç« èŠ‚

---

### å¦‚ä½•é€‰æ‹©ï¼Ÿ

| åœºæ™¯ | æ¨èæ–¹å¼ |
|------|----------|
| **é¦–æ¬¡ä½¿ç”¨** | Web UI - å¯è§†åŒ–å¼•å¯¼ |
| **æ—¥å¸¸ä½¿ç”¨** | Web UI - æ–¹ä¾¿å¿«æ· |
| **æ•°æ®æŸ¥çœ‹** | Web UI - åœ¨çº¿æµè§ˆ + HTMLå¯¼å‡ºç¿»è¯‘ |
| **å‚æ•°è°ƒè¯•** | Web UI - å®æ—¶åé¦ˆ |
| **è‡ªåŠ¨åŒ–è„šæœ¬** | å‘½ä»¤è¡Œ - çµæ´»æ§åˆ¶ |
| **è¿œç¨‹æœåŠ¡å™¨** | å‘½ä»¤è¡Œ - SSHæ‰§è¡Œ |
| **æ‰¹é‡å¤„ç†** | å‘½ä»¤è¡Œ - è„šæœ¬åŒ– |

**ğŸ’¡ æç¤º**ï¼šå¤§å¤šæ•°ç”¨æˆ·å»ºè®®ä½¿ç”¨Web UIï¼Œåªæœ‰åœ¨éœ€è¦è‡ªåŠ¨åŒ–æˆ–è¿œç¨‹æ‰§è¡Œæ—¶æ‰ä½¿ç”¨å‘½ä»¤è¡Œã€‚

---

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼1: Web UI å¿«é€Ÿä½“éªŒï¼ˆæ¨èï¼‰

**10åˆ†é’Ÿå®Œæˆæµ‹è¯•æµç¨‹ï¼š**

```bash
# 1. å¯åŠ¨Web UI
streamlit run web_ui.py

# æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ http://localhost:8501
```

**æ“ä½œæ­¥éª¤**ï¼š

1. **ğŸ“¥ Phase 1: æ•°æ®å¯¼å…¥**
   - é€‰æ‹©CSVæ–‡ä»¶ï¼ˆæˆ–ä½¿ç”¨æµ‹è¯•æ•°æ®ï¼‰
   - å‹¾é€‰"ä½¿ç”¨æµ‹è¯•é™åˆ¶"ï¼ˆåªå¯¼å…¥1000æ¡ï¼‰
   - ç‚¹å‡»"å¼€å§‹å¯¼å…¥"
   - ç­‰å¾…å®Œæˆï¼ˆçº¦30ç§’ï¼‰

2. **ğŸ”„ Phase 2: å¤§ç»„èšç±»**
   - å‹¾é€‰"ä½¿ç”¨ç¼“å­˜"
   - å‹¾é€‰"æµ‹è¯•æ¨¡å¼"
   - ç‚¹å‡»"å¼€å§‹èšç±»"
   - ç­‰å¾…å®Œæˆï¼ˆçº¦2åˆ†é’Ÿï¼‰

3. **âœ… Phase 3: èšç±»ç­›é€‰**
   - ç‚¹å‡»"å¯¼å‡ºèšç±»æŠ¥å‘Šï¼ˆCSV + HTMLï¼‰"
   - åœ¨Excel/æµè§ˆå™¨ä¸­æŸ¥çœ‹èšç±»
   - æ ‡è®°3-5ä¸ªèšç±»ä¸º"selected"
   - ä¸Šä¼ ä¿®æ”¹åçš„CSVæ–‡ä»¶

4. **ğŸ“Š Phase 4: éœ€æ±‚ç”Ÿæˆ**
   - å‹¾é€‰"è·³è¿‡LLM"å’Œ"é™åˆ¶å¤„ç†å¤§ç»„æ•°"
   - ç‚¹å‡»"å¼€å§‹å¤„ç†"
   - æŸ¥çœ‹ç”Ÿæˆçš„éœ€æ±‚å¡ç‰‡

5. **ğŸ“‹ æ•°æ®æŸ¥çœ‹**
   - è¿›å…¥"æ•°æ®æŸ¥çœ‹ä¸ç®¡ç†"é¡µé¢
   - ç‚¹å‡»"å¯¼å‡ºä¸ºHTML"
   - åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€HTMLæ–‡ä»¶
   - **å³é”®ç¿»è¯‘ä¸ºä¸­æ–‡**ï¼ˆChrome/Edgeï¼‰

**æµ‹è¯•æ¨¡å¼æˆæœ¬**: $0ï¼ˆè·³è¿‡æ‰€æœ‰LLMè°ƒç”¨ï¼‰

---

### æ–¹å¼2: å‘½ä»¤è¡Œå¿«é€Ÿä½“éªŒ

**30åˆ†é’Ÿå®Œæˆæµ‹è¯•æµç¨‹ï¼š**

```bash
# 1. å‡†å¤‡æµ‹è¯•æ•°æ®ï¼ˆ1000æ¡ï¼‰
# å°†æµ‹è¯•æ•°æ®æ”¾åˆ° data/raw/ ç›®å½•

# 2. å¯¼å…¥æ•°æ®
python scripts/run_phase1_import.py --test-mode --limit 1000

# 3. å¤§ç»„èšç±»ï¼ˆè·³è¿‡embeddingï¼Œä½¿ç”¨ç¼“å­˜ï¼‰
python scripts/run_phase2_clustering.py --use-cache

# 4. æ ‡è®°å‡ ä¸ªèšç±»ä¸ºé€‰ä¸­
python scripts/import_selection.py

# 5. å°ç»„èšç±»ï¼ˆè·³è¿‡LLMï¼‰
python scripts/run_phase4_demands.py --skip-llm --test-limit 2

# 6. Tokenæå–ï¼ˆè·³è¿‡LLMï¼‰
python scripts/run_phase5_tokens.py --skip-llm --sample-size 1000
```

**æµ‹è¯•æ¨¡å¼æˆæœ¬**: $0ï¼ˆè·³è¿‡æ‰€æœ‰LLMè°ƒç”¨ï¼‰

---

## å®Œæ•´å·¥ä½œæµ

> **ğŸ’¡ è¯´æ˜**ï¼šæœ¬ç« èŠ‚è¯¦ç»†ä»‹ç»**å‘½ä»¤è¡Œæ–¹å¼**çš„å®Œæ•´å·¥ä½œæµç¨‹ã€‚
>
> å¦‚æœä½¿ç”¨**Web UI**ï¼Œæ‰€æœ‰æ“ä½œéƒ½å¯ä»¥åœ¨ç•Œé¢ä¸Šå®Œæˆï¼Œæ›´åŠ ç›´è§‚ï¼š
> - å¯åŠ¨: `streamlit run web_ui.py`
> - è¯¦ç»†è¯´æ˜: è§ [WEB_UI_README.md](../WEB_UI_README.md)

### Phase 1: æ•°æ®å¯¼å…¥

#### 1.1 å‡†å¤‡æ•°æ®æ–‡ä»¶

å°†åŸå§‹CSVæ–‡ä»¶æ”¾åˆ° `data/raw/` ç›®å½•ï¼Œæ”¯æŒçš„æ ¼å¼ï¼š

**æ–‡ä»¶ç±»å‹:**
- `semrush_*.csv` - Semrushå¯¼å‡ºæ•°æ®
- `dropdown_*.csv` - Googleä¸‹æ‹‰è¯æ•°æ®
- `related_search_*.csv` - ç›¸å…³æœç´¢æ•°æ®

**å¿…éœ€åˆ—:**
- `Keyword`: çŸ­è¯­æ–‡æœ¬
- `Search Volume`: æœç´¢é‡ï¼ˆå¯é€‰ï¼‰
- `Seed Word`: ç§å­è¯ï¼ˆå¯é€‰ï¼‰

**CSVç¤ºä¾‹:**
```csv
Keyword,Search Volume,Seed Word
best running shoes,10000,running shoes
affordable running shoes,5000,running shoes
how to choose running shoes,3000,running shoes
```

#### 1.2 è¿è¡Œå¯¼å…¥è„šæœ¬

```bash
# å®Œæ•´å¯¼å…¥ï¼ˆæ‰€æœ‰CSVæ–‡ä»¶ï¼‰
python scripts/run_phase1_import.py

# æŒ‡å®šå•ä¸ªæ–‡ä»¶
python scripts/run_phase1_import.py --file data/raw/semrush_keywords.csv

# æŒ‡å®šè½®æ¬¡ï¼ˆç”¨äºå¢é‡æ›´æ–°ï¼‰
python scripts/run_phase1_import.py --round-id 2
```

**å‚æ•°è¯´æ˜:**
- `--file`: æŒ‡å®šå•ä¸ªCSVæ–‡ä»¶è·¯å¾„
- `--round-id`: æ•°æ®è½®æ¬¡IDï¼ˆé»˜è®¤1ï¼‰
- `--test-mode`: æµ‹è¯•æ¨¡å¼ï¼ˆé™åˆ¶æ•°é‡ï¼‰
- `--limit N`: é™åˆ¶å¯¼å…¥Næ¡è®°å½•

**è¾“å‡ºç¤ºä¾‹:**
```
======================================================================
                           Phase 1: æ•°æ®å¯¼å…¥
======================================================================

ã€å‘ç°CSVæ–‡ä»¶ã€‘
  1. data/raw/semrush_processed.csv
  2. data/raw/dropdown_processed.csv
  3. data/raw/related_search_processed.csv

ã€å¯¼å…¥æ•°æ®ã€‘
  ğŸ“¥ å¯¼å…¥ semrush_processed.csv...
  âœ“ è¯»å–äº† 20000 æ¡è®°å½•
  âœ“ æˆåŠŸæ’å…¥ 19845 æ¡è®°å½•

  ğŸ“¥ å¯¼å…¥ dropdown_processed.csv...
  âœ“ è¯»å–äº† 15000 æ¡è®°å½•
  âœ“ æˆåŠŸæ’å…¥ 14923 æ¡è®°å½•

ã€ç»Ÿè®¡ä¿¡æ¯ã€‘
  æ€»å¯¼å…¥: 55,275 æ¡çŸ­è¯­
  æŒ‰æ¥æºåˆ†å¸ƒ:
    - semrush: 35,123 (63.5%)
    - dropdown: 15,234 (27.6%)
    - related_search: 4,918 (8.9%)

âœ… Phase 1 å®Œæˆï¼
```

#### 1.3 éªŒè¯å¯¼å…¥ç»“æœ

```bash
# æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡
python -c "from storage.repository import PhraseRepository; repo = PhraseRepository(); stats = repo.get_statistics(); print(f'æ€»çŸ­è¯­æ•°: {stats[\"total_count\"]}')"
```

---

### Phase 2: å¤§ç»„èšç±»

#### 2.1 ç”ŸæˆEmbeddings

```bash
# é¦–æ¬¡è¿è¡Œï¼ˆç”Ÿæˆembeddingsï¼‰
python scripts/run_phase2_clustering.py

# ä½¿ç”¨å·²æœ‰ç¼“å­˜ï¼ˆå¿«é€Ÿï¼‰
python scripts/run_phase2_clustering.py --use-cache
```

**é‡è¦æç¤º:**
- é¦–æ¬¡è¿è¡Œä¼šè°ƒç”¨Embedding APIï¼Œç”Ÿæˆembeddingsç¼“å­˜
- embeddingsç¼“å­˜ä¿å­˜åœ¨ `data/cache/embeddings_round1.npz`
- åç»­è¿è¡Œä½¿ç”¨ `--use-cache` è·³è¿‡embeddingç”Ÿæˆ

**Embeddingæˆæœ¬ä¼°ç®—:**
- æ¨¡å‹: text-embedding-3-small
- 55,275æ¡çŸ­è¯­ â‰ˆ 1.5M tokens
- æˆæœ¬: ~$0.03

#### 2.2 æ‰§è¡Œèšç±»

èšç±»è¿‡ç¨‹å®Œå…¨è‡ªåŠ¨åŒ–ï¼ŒåŒ…æ‹¬ï¼š
1. åŠ è½½çŸ­è¯­å’Œembeddings
2. æ‰§è¡ŒHDBSCANèšç±»ï¼ˆLevel Aï¼‰
3. æ›´æ–°phrasesè¡¨çš„cluster_id_A
4. ä¿å­˜èšç±»å…ƒæ•°æ®åˆ°cluster_metaè¡¨
5. ç”Ÿæˆèšç±»æŠ¥å‘Šå’ŒCSV

**è¾“å‡ºç¤ºä¾‹:**
```
======================================================================
                        Phase 2: å¤§ç»„èšç±» (Level A)
======================================================================

ã€é˜¶æ®µ1ã€‘åŠ è½½çŸ­è¯­æ•°æ®...
  âœ“ åŠ è½½äº† 55,275 æ¡çŸ­è¯­

ã€é˜¶æ®µ2ã€‘è®¡ç®—Embeddings...
  âœ“ ä½¿ç”¨ç¼“å­˜çš„embeddings: (55275, 1536)

ã€é˜¶æ®µ3ã€‘æ‰§è¡ŒHDBSCANèšç±»...
  âœ“ èšç±»å®Œæˆ
  - èšç±»æ•°é‡: 307
  - å™ªéŸ³ç‚¹: 15234 (27.5%)
  - èšç±»å¤§å°: æœ€å°=30, æœ€å¤§=3452, å¹³å‡=130.2

ã€é˜¶æ®µ4ã€‘æ›´æ–°æ•°æ®åº“...
  âœ“ å·²æ›´æ–° 55275/55275 æ¡è®°å½•çš„cluster_id_A

ã€é˜¶æ®µ5ã€‘ä¿å­˜èšç±»å…ƒæ•°æ®...
  âœ“ å·²ä¿å­˜ 307 ä¸ªèšç±»çš„å…ƒæ•°æ®

âœ… Phase 2 å®Œæˆï¼
  - ç”Ÿæˆèšç±»: 307 ä¸ª
  - èšç±»CSV: data/output/clusters_levelA.csv
  - ç»Ÿè®¡æŠ¥å‘Š: data/output/phase2_clustering_report.txt
```

#### 2.3 æŸ¥çœ‹èšç±»ç»“æœ

**CSVæ–‡ä»¶:** `data/output/clusters_levelA.csv`

| cluster_id | size | example_phrases | main_theme |
|------------|------|-----------------|------------|
| 1174 | 222 | dashboard, online dashboard, salesforce dashboard | Dashboardç›¸å…³ |
| 1244 | 201 | pdf converter, online pdf converter, pdf to word | PDFå·¥å…· |
| 892 | 156 | running shoes, best running shoes, running shoes for women | è·‘é‹è´­ä¹° |

---

### Phase 3: äººå·¥ç­›é€‰èšç±»

#### 3.1 å®¡æ ¸èšç±»CSV

æ‰“å¼€ `data/output/clusters_levelA.csv`ï¼Œå®¡æ ¸æ¯ä¸ªèšç±»ï¼š

**ç­›é€‰æ ‡å‡†:**
1. âœ… **ä¿ç•™**: ä¸»é¢˜æ˜ç¡®ã€æœ‰å•†ä¸šä»·å€¼ã€çŸ­è¯­æ•°é‡é€‚ä¸­ï¼ˆ50-500ï¼‰
2. âŒ **è¿‡æ»¤**: ä¸»é¢˜æ¨¡ç³Šã€å™ªéŸ³å¤šã€è¿‡äºå®½æ³›æˆ–ç‹­çª„

**æ“ä½œæ­¥éª¤:**
1. åœ¨CSVä¸­æ·»åŠ  `is_selected` åˆ—
2. æ ‡è®°é€‰ä¸­çš„èšç±»ä¸º `TRUE`
3. æ ‡è®°è¿‡æ»¤çš„èšç±»ä¸º `FALSE`

**ç¤ºä¾‹:**
```csv
cluster_id,size,example_phrases,main_theme,is_selected
1174,222,dashboard; online dashboard; salesforce dashboard,Dashboardç›¸å…³,TRUE
1244,201,pdf converter; online pdf converter; pdf to word,PDFå·¥å…·,TRUE
892,156,running shoes; best running shoes,è·‘é‹è´­ä¹°,TRUE
...
```

#### 3.2 å¯¼å…¥ç­›é€‰ç»“æœ

```bash
# å¯¼å…¥å®¡æ ¸åçš„CSV
python scripts/import_selection.py data/output/clusters_levelA.csv

# æˆ–ä½¿ç”¨é»˜è®¤è·¯å¾„
python scripts/import_selection.py
```

**è¾“å‡ºç¤ºä¾‹:**
```
âœ“ è¯»å–CSV: 307 æ¡è®°å½•
âœ“ æ›´æ–°æ•°æ®åº“...
  - é€‰ä¸­: 28 ä¸ªèšç±»
  - æœªé€‰ä¸­: 279 ä¸ªèšç±»

âœ… ç­›é€‰ç»“æœå·²å¯¼å…¥æ•°æ®åº“
```

#### 3.3 éªŒè¯ç­›é€‰ç»“æœ

```bash
# æŸ¥çœ‹é€‰ä¸­çš„èšç±»
python -c "from storage.repository import ClusterMetaRepository; repo = ClusterMetaRepository(); selected = repo.get_selected_clusters('A'); print(f'é€‰ä¸­èšç±»: {len(selected)}ä¸ª'); [print(f'  {c.cluster_id}: {c.main_theme} ({c.size}æ¡)') for c in selected[:5]]"
```

---

### Phase 4: å°ç»„èšç±» + éœ€æ±‚å¡ç‰‡ç”Ÿæˆ

#### 4.1 æµ‹è¯•è¿è¡Œï¼ˆæ— LLMæˆæœ¬ï¼‰

```bash
# æµ‹è¯•èšç±»æ•ˆæœï¼ˆè·³è¿‡éœ€æ±‚å¡ç‰‡ç”Ÿæˆï¼‰
python scripts/run_phase4_demands.py --skip-llm --test-limit 2
```

**ç›®çš„:**
- éªŒè¯å°ç»„èšç±»å‚æ•°æ˜¯å¦åˆç†
- æ£€æŸ¥cluster_id_Bç¼–ç æ˜¯å¦æ­£ç¡®
- è¯„ä¼°å™ªéŸ³ç‡æ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´ï¼ˆ40-60%ï¼‰

#### 4.2 å®Œæ•´è¿è¡Œï¼ˆç”Ÿæˆéœ€æ±‚å¡ç‰‡ï¼‰

```bash
# å¤„ç†æ‰€æœ‰é€‰ä¸­çš„å¤§ç»„
python scripts/run_phase4_demands.py

# ä»…å¤„ç†å‰Nä¸ªå¤§ç»„
python scripts/run_phase4_demands.py --test-limit 5
```

**å¤„ç†è¿‡ç¨‹:**
```
å¯¹æ¯ä¸ªé€‰ä¸­çš„å¤§ç»„:
  1. åŠ è½½å¤§ç»„çš„æ‰€æœ‰çŸ­è¯­
  2. åŠ è½½å¯¹åº”çš„embeddingsï¼ˆä»ç¼“å­˜ï¼‰
  3. æ‰§è¡Œå°ç»„èšç±»ï¼ˆLevel B, min_size=5ï¼‰
  4. æ›´æ–°phrases.cluster_id_B
  5. ä¿å­˜cluster_meta (Level B)
  6. å¯¹æ¯ä¸ªå°ç»„:
     - è°ƒç”¨LLMç”Ÿæˆéœ€æ±‚å¡ç‰‡
     - ä¿å­˜åˆ°demandsè¡¨
  7. ç”Ÿæˆå°ç»„ç»Ÿè®¡
```

**è¾“å‡ºç¤ºä¾‹:**
```
======================================================================
                   Phase 4: å°ç»„èšç±» + éœ€æ±‚å¡ç‰‡ç”Ÿæˆ
======================================================================

ã€é˜¶æ®µ1ã€‘åŠ è½½é€‰ä¸­çš„å¤§ç»„...
âœ“ åŠ è½½äº† 28 ä¸ªé€‰ä¸­çš„å¤§ç»„

ã€é˜¶æ®µ2ã€‘å°ç»„èšç±»å’Œéœ€æ±‚å¡ç‰‡ç”Ÿæˆ...

è¿›åº¦: 1/28
======================================================================
å¤„ç†å¤§ç»„ 1174: Dashboardç›¸å…³
======================================================================

ã€æ­¥éª¤1ã€‘åŠ è½½å¤§ç»„çŸ­è¯­...
  âœ“ åŠ è½½äº† 222 æ¡çŸ­è¯­

ã€æ­¥éª¤2ã€‘åŠ è½½embeddings...
  âœ“ åŠ è½½äº† (222, 1536) embeddings

ã€æ­¥éª¤3ã€‘æ‰§è¡Œå°ç»„èšç±»...
  âœ“ èšç±»å®Œæˆ: 6ä¸ªå°ç»„

ã€æ­¥éª¤4ã€‘æ›´æ–°æ•°æ®åº“...
  âœ“ å·²æ›´æ–° 222/222 æ¡è®°å½•çš„cluster_id_B

ã€æ­¥éª¤5ã€‘ä¿å­˜å°ç»„å…ƒæ•°æ®...
  âœ“ å·²ä¿å­˜ 6 ä¸ªå°ç»„çš„å…ƒæ•°æ®

ã€æ­¥éª¤6ã€‘ç”Ÿæˆéœ€æ±‚å¡ç‰‡...
  ç°‡11740000: ç”Ÿæˆéœ€æ±‚å¡ç‰‡...
  âœ“ ç”Ÿæˆéœ€æ±‚å¡ç‰‡: Dashboardç¬¦å·è¯´æ˜

  ç°‡11740001: ç”Ÿæˆéœ€æ±‚å¡ç‰‡...
  âœ“ ç”Ÿæˆéœ€æ±‚å¡ç‰‡: Home Assistant Dashboard

  ... (å…±6ä¸ª)
  âœ“ å·²ç”Ÿæˆ 6 ä¸ªéœ€æ±‚å¡ç‰‡

âœ… Phase 4 å®Œæˆï¼
  - å¤„ç†å¤§ç»„: 28/28
  - ç”Ÿæˆå°ç»„: 156
  - ç”Ÿæˆéœ€æ±‚: 156
  - éœ€æ±‚CSV: data/output/demands_draft.csv
```

#### 4.3 å®¡æ ¸éœ€æ±‚å¡ç‰‡

æ‰“å¼€ `data/output/demands_draft.csv`:

**å®¡æ ¸å†…å®¹:**
1. âœï¸ ä¿®æ”¹ `title` ä½¿å…¶æ›´å‡†ç¡®
2. âœï¸ ä¿®æ”¹ `description` ä½¿å…¶æ›´æ¸…æ™°
3. âœï¸ è¡¥å…… `user_scenario`
4. âœï¸ ä¿®æ­£ `demand_type` (tool/content/service/education/other)
5. âœï¸ **å¿…å¡«** `business_value` (high/medium/low)
6. âœï¸ **å¿…å¡«** `status` (validated/archived)

**ä¸è¦ä¿®æ”¹:**
- ğŸ”’ demand_id
- ğŸ”’ source_cluster_A, source_cluster_B
- ğŸ”’ related_phrases_count

**CSVç¤ºä¾‹:**
```csv
demand_id,title,description,user_scenario,demand_type,business_value,status
1,Dashboardç¬¦å·å«ä¹‰è¯´æ˜,ç”¨æˆ·éœ€è¦äº†è§£ä»ªè¡¨ç›˜ä¸Šå„ç§ç¬¦å·çš„å«ä¹‰,æ±½è½¦é©¾é©¶,content,medium,validated
2,åœ¨çº¿Dashboardå·¥å…·,ç”¨æˆ·éœ€è¦åœ¨çº¿åˆ›å»ºå’Œç®¡ç†æ•°æ®å¯è§†åŒ–Dashboard,æ•°æ®åˆ†æ,tool,high,validated
...
```

#### 4.4 å¯¼å…¥å®¡æ ¸ç»“æœï¼ˆå¾…å®ç°ï¼‰

```bash
# TODO: å®ç°å¯¼å…¥è„šæœ¬
python scripts/import_demands.py data/output/demands_draft.csv
```

---

### Phase 5: Tokenæå–ä¸åˆ†ç±»

#### 5.1 æµ‹è¯•è¿è¡Œï¼ˆæ— LLMæˆæœ¬ï¼‰

```bash
# 1000æ¡é‡‡æ ·ï¼Œè·³è¿‡LLMåˆ†ç±»
python scripts/run_phase5_tokens.py --skip-llm --sample-size 1000 --min-frequency 5
```

**ç›®çš„:**
- éªŒè¯tokenæå–é€»è¾‘
- æŸ¥çœ‹é«˜é¢‘è¯åˆ†å¸ƒ
- è¯„ä¼°åœç”¨è¯è¿‡æ»¤æ•ˆæœ

#### 5.2 å®Œæ•´è¿è¡Œï¼ˆä½¿ç”¨LLMåˆ†ç±»ï¼‰

```bash
# 10000æ¡é‡‡æ ·ï¼ˆæ¨èï¼‰
python scripts/run_phase5_tokens.py --sample-size 10000 --min-frequency 3

# å…¨é‡è¿è¡Œï¼ˆæ‰€æœ‰çŸ­è¯­ï¼‰
python scripts/run_phase5_tokens.py --sample-size 0 --min-frequency 2
```

**è¾“å‡ºç¤ºä¾‹:**
```
======================================================================
                         Phase 5: Tokenæå–ä¸åˆ†ç±»
======================================================================

ã€é˜¶æ®µ1ã€‘åŠ è½½çŸ­è¯­æ•°æ®...
  âœ“ åŠ è½½äº† 10,000 æ¡çŸ­è¯­ï¼ˆé‡‡æ ·æ¨¡å¼ï¼‰

ã€é˜¶æ®µ2ã€‘æå–å€™é€‰tokens...
  âœ“ æå–åˆ° 3,245 ä¸ªå”¯ä¸€tokens
  âœ“ è¿‡æ»¤åä¿ç•™ 856 ä¸ªtokens (é¢‘æ¬¡>=3)

ã€é˜¶æ®µ3ã€‘æå–äºŒå…ƒè¯ç»„...
  âœ“ å”¯ä¸€bigrams: 245

ã€é˜¶æ®µ4ã€‘LLMæ‰¹é‡åˆ†ç±»...
  âœ“ æ‰¹æ¬¡ 1: åˆ†ç±»äº† 50 ä¸ªtokens
  âœ“ æ‰¹æ¬¡ 2: åˆ†ç±»äº† 50 ä¸ªtokens
  ...
  âœ“ æˆåŠŸåˆ†ç±» 856 ä¸ªtokens

  åˆ†ç±»ç»Ÿè®¡:
    - intent: 124 ä¸ª (14.5%)
    - action: 89 ä¸ª (10.4%)
    - object: 532 ä¸ª (62.1%)
    - other: 111 ä¸ª (13.0%)

ã€é˜¶æ®µ5ã€‘ä¿å­˜åˆ°æ•°æ®åº“...
  âœ“ æˆåŠŸä¿å­˜ 856 ä¸ªtokensåˆ°æ•°æ®åº“

âœ… Phase 5 å®Œæˆï¼
  - Token CSV: data/output/tokens_extracted.csv
  - ç»Ÿè®¡æŠ¥å‘Š: data/output/phase5_tokens_report.txt
```

#### 5.3 å®¡æ ¸Tokenåˆ†ç±»

æ‰“å¼€ `data/output/tokens_extracted.csv`:

**å®¡æ ¸å†…å®¹:**
1. æ£€æŸ¥ `token_type` æ˜¯å¦æ­£ç¡®
2. ä¿®æ”¹é”™è¯¯çš„åˆ†ç±»
3. æ ‡è®° `verified=TRUE` è¡¨ç¤ºå·²å®¡æ ¸

**åˆ†ç±»æ ‡å‡†:**
- **intent**: æ„å›¾è¯ï¼ˆbest, top, how to, cheap, free, affordableï¼‰
- **action**: åŠ¨ä½œè¯ï¼ˆdownload, buy, make, create, install, convertï¼‰
- **object**: å¯¹è±¡è¯ï¼ˆshoes, phone, tutorial, recipe, software, dashboardï¼‰
- **other**: å…¶ä»–ï¼ˆå“ç‰Œåã€åœ°åã€æ•°å­—ï¼‰

**CSVç¤ºä¾‹:**
```csv
token_text,token_type,in_phrase_count,confidence,verified,notes
best,intent,856,high,TRUE,
download,action,423,high,TRUE,
shoes,object,345,high,TRUE,
nike,other,234,high,TRUE,å“ç‰Œå
dashboard,object,222,high,TRUE,
```

---

## é…ç½®è¯´æ˜

### config/settings.py å®Œæ•´é…ç½®

```python
from pathlib import Path

# ============================================================================
# é¡¹ç›®è·¯å¾„é…ç½®
# ============================================================================
PROJECT_ROOT = Path(__file__).parent.parent
DATA_DIR = PROJECT_ROOT / 'data'
RAW_DATA_DIR = DATA_DIR / 'raw'
OUTPUT_DIR = DATA_DIR / 'output'
CACHE_DIR = DATA_DIR / 'cache'

# ç¡®ä¿ç›®å½•å­˜åœ¨
for dir_path in [DATA_DIR, RAW_DATA_DIR, OUTPUT_DIR, CACHE_DIR]:
    dir_path.mkdir(exist_ok=True)

# ============================================================================
# æ•°æ®åº“é…ç½®
# ============================================================================
DATABASE_CONFIG = {
    # MySQL/MariaDBé…ç½®
    'host': 'localhost',
    'port': 3306,
    'user': 'demand_user',
    'password': 'your_password',
    'database': 'search_demand_mining',
    'charset': 'utf8mb4',

    # æˆ–ä½¿ç”¨SQLiteï¼ˆå¼€å‘/æµ‹è¯•ï¼‰
    # 'type': 'sqlite',
    # 'database': str(DATA_DIR / 'search_demand.db')
}

# ============================================================================
# LLMé…ç½®
# ============================================================================
LLM_PROVIDER = "openai"  # å¯é€‰: "openai", "anthropic", "deepseek"

LLM_CONFIG = {
    "openai": {
        "api_key": "sk-your-openai-key",
        "model": "gpt-4o-mini",  # æ€§ä»·æ¯”æœ€é«˜
        "base_url": None,
        "temperature": 0.7,
        "max_tokens": 2000
    },
    "anthropic": {
        "api_key": "sk-ant-your-key",
        "model": "claude-3-5-sonnet-20241022",
        "temperature": 0.7,
        "max_tokens": 2000
    },
    "deepseek": {
        "api_key": "your-deepseek-key",
        "model": "deepseek-chat",
        "base_url": "https://api.deepseek.com",
        "temperature": 0.7,
        "max_tokens": 2000
    }
}

# ============================================================================
# Embeddingé…ç½®
# ============================================================================
EMBEDDING_CONFIG = {
    "provider": "openai",
    "model": "text-embedding-3-small",  # æ¨èï¼Œæ€§ä»·æ¯”é«˜
    "batch_size": 100,
    "cache_enabled": True,
    "cache_dir": CACHE_DIR
}

# ============================================================================
# èšç±»é…ç½®
# ============================================================================

# å¤§ç»„èšç±»é…ç½®ï¼ˆLevel Aï¼‰
LARGE_CLUSTER_CONFIG = {
    "min_cluster_size": 30,      # æœ€å°èšç±»å¤§å°
    "min_samples": 10,            # æœ€å°æ ·æœ¬æ•°
    "metric": "cosine",           # è·ç¦»åº¦é‡
    "cluster_selection_epsilon": 0.0,
    "cluster_selection_method": "eom"
}

# å°ç»„èšç±»é…ç½®ï¼ˆLevel Bï¼‰
SMALL_CLUSTER_CONFIG = {
    "min_cluster_size": 5,        # æ›´å°çš„èšç±»
    "min_samples": 2,             # æ›´å°‘çš„æ ·æœ¬
    "metric": "cosine",
    "cluster_selection_epsilon": 0.0
}

# ============================================================================
# Phase 4 éœ€æ±‚å¡ç‰‡é…ç½®
# ============================================================================
DEMAND_CARD_PHRASE_SAMPLE_SIZE = 30  # LLMç”Ÿæˆæ—¶é‡‡æ ·çš„çŸ­è¯­æ•°

# ============================================================================
# Phase 5 Tokenæå–é…ç½®
# ============================================================================
TOKEN_EXTRACTION_CONFIG = {
    "min_frequency": 3,           # æœ€å°é¢‘æ¬¡
    "min_token_length": 2,        # æœ€å°tokené•¿åº¦
    "max_token_length": 30,       # æœ€å¤§tokené•¿åº¦
    "batch_size": 50              # LLMåˆ†ç±»æ‰¹æ¬¡å¤§å°
}
```

---

## è¾“å‡ºæ–‡ä»¶è¯´æ˜

### Phase 1 è¾“å‡º

```
data/output/
  â””â”€â”€ phase1_import_report.txt      # å¯¼å…¥ç»Ÿè®¡æŠ¥å‘Š
```

### Phase 2 è¾“å‡º

```
data/output/
  â”œâ”€â”€ clusters_levelA.csv            # å¤§ç»„èšç±»CSVï¼ˆå¾…äººå·¥ç­›é€‰ï¼‰
  â”œâ”€â”€ phase2_clustering_report.txt   # èšç±»ç»Ÿè®¡æŠ¥å‘Š
  â””â”€â”€ phase2_secondary_clusters.csv  # äºŒæ¬¡èšç±»ç»“æœï¼ˆå¦‚æœæ‰§è¡Œï¼‰

data/cache/
  â””â”€â”€ embeddings_round1.npz          # Embeddingsç¼“å­˜ï¼ˆé‡è¦ï¼ï¼‰
```

### Phase 3 è¾“å‡º

æ— æ–°æ–‡ä»¶ï¼Œç›´æ¥æ›´æ–°æ•°æ®åº“çš„ `cluster_meta.is_selected` å­—æ®µã€‚

### Phase 4 è¾“å‡º

```
data/output/
  â”œâ”€â”€ demands_draft.csv              # éœ€æ±‚å¡ç‰‡CSVï¼ˆå¾…äººå·¥å®¡æ ¸ï¼‰
  â””â”€â”€ phase4_demands_report.txt      # éœ€æ±‚ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š
```

### Phase 5 è¾“å‡º

```
data/output/
  â”œâ”€â”€ tokens_extracted.csv           # Token CSVï¼ˆå¾…äººå·¥å®¡æ ¸ï¼‰
  â””â”€â”€ phase5_tokens_report.txt       # Tokenæå–ç»Ÿè®¡æŠ¥å‘Š
```

---

## APIæˆæœ¬ç®¡ç†

### æˆæœ¬ä¼°ç®—å·¥å…·

```bash
# ä¼°ç®—Phase 2 embeddingæˆæœ¬
python scripts/estimate_cost.py --phase 2 --count 55275

# ä¼°ç®—Phase 4 LLMæˆæœ¬ï¼ˆå‡è®¾28ä¸ªå¤§ç»„ï¼Œå¹³å‡6ä¸ªå°ç»„ï¼‰
python scripts/estimate_cost.py --phase 4 --clusters 28 --avg-subgroups 6

# ä¼°ç®—Phase 5 LLMæˆæœ¬ï¼ˆå‡è®¾1000ä¸ªtokensï¼‰
python scripts/estimate_cost.py --phase 5 --tokens 1000
```

### å…¸å‹é¡¹ç›®æˆæœ¬ï¼ˆ55,275æ¡çŸ­è¯­ï¼Œ28ä¸ªé€‰ä¸­å¤§ç»„ï¼‰

| Phase | APIè°ƒç”¨ | OpenAI | Anthropic | Deepseek |
|-------|---------|--------|-----------|----------|
| Phase 2 (Embedding) | 55,275çŸ­è¯­ | $0.03 | N/A | N/A |
| Phase 2 (AIä¸»é¢˜ï¼Œå¯é€‰) | 307æ¬¡ | $0.60 | $12.00 | $0.08 |
| Phase 4 (éœ€æ±‚å¡ç‰‡) | ~168æ¬¡ | $0.50 | $10.00 | $0.07 |
| Phase 5 (Tokenåˆ†ç±») | ~1000 tokens | $0.05 | $1.00 | $0.01 |
| **æ€»è®¡** | - | **$1.18** | **$23.00** | **$0.16** |

**æ¨èé…ç½®:**
- **Embedding**: OpenAI text-embedding-3-smallï¼ˆå”¯ä¸€é€‰æ‹©ï¼‰
- **LLM**: OpenAI GPT-4o-mini æˆ– Deepseekï¼ˆæ€§ä»·æ¯”é«˜ï¼‰
- **é«˜è´¨é‡è¦æ±‚**: Anthropic Claudeï¼ˆæœ€è´µä½†è´¨é‡æœ€å¥½ï¼‰

### æˆæœ¬ä¼˜åŒ–ç­–ç•¥

1. **ä½¿ç”¨ç¼“å­˜**
   - Phase 2 embeddingç¼“å­˜å¯é‡å¤ä½¿ç”¨
   - é¿å…é‡å¤è®¡ç®—embeddings

2. **åˆ†é˜¶æ®µæµ‹è¯•**
   - ä½¿ç”¨ `--skip-llm` æµ‹è¯•æµç¨‹
   - ä½¿ç”¨ `--test-limit` é™åˆ¶å¤„ç†æ•°é‡
   - éªŒè¯åå†å…¨é‡è¿è¡Œ

3. **é€‰æ‹©æ€§å¤„ç†**
   - Phase 3 ç­›é€‰é«˜ä»·å€¼èšç±»
   - åªå¯¹é€‰ä¸­çš„èšç±»ç”Ÿæˆéœ€æ±‚å¡ç‰‡

4. **æ‰¹é‡å¤„ç†**
   - Tokenåˆ†ç±»æ‰¹é‡å¤„ç†ï¼ˆ50ä¸ª/æ‰¹ï¼‰
   - å‡å°‘APIè°ƒç”¨æ¬¡æ•°

---

## å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯:**
```
pymysql.err.OperationalError: (2003, "Can't connect to MySQL server")
```

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥MySQLæœåŠ¡æ˜¯å¦å¯åŠ¨
2. éªŒè¯ `config/settings.py` ä¸­çš„æ•°æ®åº“é…ç½®
3. ç¡®è®¤ç”¨æˆ·æƒé™
4. æµ‹è¯•è¿æ¥: `python scripts/test_db_connection.py`

### Q2: Embeddingç¼“å­˜æŸå

**é”™è¯¯:**
```
FileNotFoundError: embeddings_round1.npz not found
```

**è§£å†³æ–¹æ¡ˆ:**
```bash
# é‡æ–°ç”Ÿæˆembeddingsï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
python scripts/run_phase2_clustering.py
```

### Q3: LLM APIè°ƒç”¨å¤±è´¥

**é”™è¯¯:**
```
openai.error.RateLimitError: Rate limit exceeded
```

**è§£å†³æ–¹æ¡ˆ:**
1. æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
2. æ£€æŸ¥APIé…é¢æ˜¯å¦ç”¨å°½
3. é™ä½å¹¶å‘é‡ï¼ˆå‡å°‘batch_sizeï¼‰
4. ç­‰å¾…å‡ åˆ†é’Ÿåé‡è¯•

### Q4: å†…å­˜ä¸è¶³

**é”™è¯¯:**
```
MemoryError: Unable to allocate array
```

**è§£å†³æ–¹æ¡ˆ:**
1. ä½¿ç”¨é‡‡æ ·æ¨¡å¼: `--sample-size 10000`
2. åˆ†æ‰¹å¤„ç†: `--test-limit 5`
3. å¢åŠ ç³»ç»Ÿå†…å­˜
4. ä½¿ç”¨æ•°æ®åº“åˆ†é¡µæŸ¥è¯¢

### Q5: èšç±»ç»“æœä¸ç†æƒ³

**é—®é¢˜:** èšç±»å¤ªå¤§/å¤ªå°ï¼Œä¸»é¢˜ä¸æ˜ç¡®

**è§£å†³æ–¹æ¡ˆ:**
1. è°ƒæ•´ `LARGE_CLUSTER_CONFIG.min_cluster_size`
   - å¤ªå¤§ â†’ å‡å° min_cluster_size
   - å¤ªå° â†’ å¢å¤§ min_cluster_size
2. æ‰§è¡ŒäºŒæ¬¡èšç±»: `python scripts/run_phase2_resplit.py --cluster-id XXX`
3. åœ¨Phase 3äººå·¥ç­›é€‰æ—¶è¿‡æ»¤æ‰ä¸å¥½çš„èšç±»

### Q6: éœ€æ±‚å¡ç‰‡è´¨é‡ä¸é«˜

**é—®é¢˜:** LLMç”Ÿæˆçš„éœ€æ±‚æè¿°ä¸å‡†ç¡®

**è§£å†³æ–¹æ¡ˆ:**
1. è°ƒæ•´LLM temperatureï¼ˆé™ä½åˆ°0.3-0.5ï¼‰
2. ä½¿ç”¨æ›´é«˜çº§çš„æ¨¡å‹ï¼ˆGPT-4o, Claude Sonnetï¼‰
3. åœ¨ `ai/client.py` ä¸­ä¼˜åŒ–prompt
4. äººå·¥å®¡æ ¸ä¿®æ”¹CSV

### Q7: Tokenåˆ†ç±»é”™è¯¯ç‡é«˜

**é—®é¢˜:** LLMå°†intentè¯è¯¯åˆ†ç±»ä¸ºobject

**è§£å†³æ–¹æ¡ˆ:**
1. åœ¨ `ai/client.py` çš„promptä¸­æ·»åŠ æ›´å¤šç¤ºä¾‹
2. äººå·¥å®¡æ ¸ä¿®æ”¹ `tokens_extracted.csv`
3. ä½¿ç”¨æ›´å‡†ç¡®çš„æ¨¡å‹
4. è°ƒæ•´åœç”¨è¯åˆ—è¡¨

### Q8: å¦‚ä½•å¤„ç†å¢é‡æ•°æ®ï¼Ÿ

**åœºæ™¯:** æœ‰æ–°çš„å…³é”®è¯æ•°æ®éœ€è¦å¯¼å…¥

**æ–¹æ¡ˆ:**
```bash
# 1. å¯¼å…¥æ–°æ•°æ®ï¼ˆæŒ‡å®šæ–°è½®æ¬¡ï¼‰
python scripts/run_phase1_import.py --round-id 2 --file data/raw/new_keywords.csv

# 2. ä¸ºæ–°æ•°æ®ç”Ÿæˆembeddings
python scripts/run_phase2_clustering.py --round-id 2

# 3. åˆå¹¶åˆ°ç°æœ‰èšç±»æˆ–åˆ›å»ºæ–°èšç±»
# ï¼ˆPhase 6å¢é‡æ›´æ–°ï¼Œå¾…å®ç°ï¼‰
```

### Q9: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

**æ–¹æ¡ˆ:**
```bash
# å¤‡ä»½MySQLæ•°æ®åº“
mysqldump -u demand_user -p search_demand_mining > backup_$(date +%Y%m%d).sql

# å¤‡ä»½embeddingsç¼“å­˜
cp -r data/cache/ backup/cache_$(date +%Y%m%d)/

# å¤‡ä»½è¾“å‡ºæ–‡ä»¶
cp -r data/output/ backup/output_$(date +%Y%m%d)/
```

### Q10: å¦‚ä½•å¯¼å‡ºæœ€ç»ˆéœ€æ±‚æ¸…å•ï¼Ÿ

**æ–¹æ¡ˆ:**
```bash
# å¯¼å‡ºå·²éªŒè¯çš„éœ€æ±‚
python scripts/export_demands.py --status validated --output final_demands.xlsx

# æˆ–ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
python -c "from storage.repository import DemandRepository; import pandas as pd; repo = DemandRepository(); demands = repo.get_validated_demands(); df = pd.DataFrame([{'id': d.demand_id, 'title': d.title, 'description': d.description} for d in demands]); df.to_excel('final_demands.xlsx', index=False)"
```

---

## æœ€ä½³å®è·µ

### 1. é¡¹ç›®å¯åŠ¨æ£€æŸ¥æ¸…å•

- [ ] æ•°æ®åº“å·²åˆ›å»ºå¹¶è¿æ¥æˆåŠŸ
- [ ] LLM APIå¯†é’¥å·²é…ç½®å¹¶æµ‹è¯•
- [ ] Embedding APIå¯†é’¥å·²é…ç½®
- [ ] æ‰€æœ‰Pythonä¾èµ–å·²å®‰è£…
- [ ] æ•°æ®è¡¨å·²åˆå§‹åŒ–
- [ ] åŸå§‹CSVæ•°æ®å·²å‡†å¤‡

### 2. æµ‹è¯•é©±åŠ¨å¼€å‘

**å»ºè®®æµç¨‹:**
```bash
# ç¬¬1å¤©: å°è§„æ¨¡æµ‹è¯•ï¼ˆå…è´¹ï¼‰
python scripts/run_phase1_import.py --limit 1000
python scripts/run_phase2_clustering.py
python scripts/import_selection.py  # æ‰‹å·¥æ ‡è®°2-3ä¸ªèšç±»
python scripts/run_phase4_demands.py --skip-llm --test-limit 1
python scripts/run_phase5_tokens.py --skip-llm --sample-size 500

# ç¬¬2å¤©: ä¸­ç­‰è§„æ¨¡æµ‹è¯•ï¼ˆä½æˆæœ¬ <$1ï¼‰
python scripts/run_phase1_import.py --limit 10000
python scripts/run_phase2_clustering.py
python scripts/import_selection.py  # æ ‡è®°5-10ä¸ªèšç±»
python scripts/run_phase4_demands.py --test-limit 5
python scripts/run_phase5_tokens.py --sample-size 5000

# ç¬¬3å¤©: å…¨é‡è¿è¡Œï¼ˆæ­£å¼ï¼‰
python scripts/run_phase1_import.py
python scripts/run_phase2_clustering.py
python scripts/import_selection.py  # æ ‡è®°20-40ä¸ªèšç±»
python scripts/run_phase4_demands.py
python scripts/run_phase5_tokens.py
```

### 3. æ•°æ®è´¨é‡ä¿è¯

**Phase 1æ•°æ®å¯¼å…¥:**
- æ£€æŸ¥CSVæ ¼å¼æ˜¯å¦æ­£ç¡®
- éªŒè¯å¿…éœ€åˆ—æ˜¯å¦å­˜åœ¨
- ç¡®è®¤æ•°æ®æ— é‡å¤

**Phase 2èšç±»è´¨é‡:**
- æŸ¥çœ‹èšç±»å¤§å°åˆ†å¸ƒæ˜¯å¦åˆç†
- æ£€æŸ¥ç¤ºä¾‹çŸ­è¯­æ˜¯å¦è¯­ä¹‰ç›¸å…³
- è¯„ä¼°å™ªéŸ³ç‡ï¼ˆ20-40%æ­£å¸¸ï¼‰

**Phase 3ç­›é€‰æ ‡å‡†:**
- èšç±»ä¸»é¢˜æ˜¯å¦æ˜ç¡®
- çŸ­è¯­æ•°é‡æ˜¯å¦é€‚ä¸­ï¼ˆ50-500ï¼‰
- æ˜¯å¦æœ‰å•†ä¸šä»·å€¼

**Phase 4éœ€æ±‚å®¡æ ¸:**
- éœ€æ±‚æ ‡é¢˜æ˜¯å¦ç®€æ´æœ‰åŠ›
- éœ€æ±‚æè¿°æ˜¯å¦æ¸…æ™°å®Œæ•´
- ç”¨æˆ·åœºæ™¯æ˜¯å¦çœŸå®
- å¿…å¡«å­—æ®µæ˜¯å¦å®Œæ•´

**Phase 5 Tokenå®¡æ ¸:**
- åˆ†ç±»æ˜¯å¦æ­£ç¡®
- æ˜¯å¦é—æ¼é‡è¦token
- åœç”¨è¯æ˜¯å¦éœ€è¦è°ƒæ•´

### 4. æ€§èƒ½ä¼˜åŒ–

**å¤§è§„æ¨¡æ•°æ®å¤„ç†:**
- ä½¿ç”¨æ‰¹é‡æ’å…¥ï¼ˆbulk_insert_mappingsï¼‰
- å¯ç”¨embeddingç¼“å­˜
- åˆç†è®¾ç½®batch_size
- è€ƒè™‘åˆ†æ‰¹å¤„ç†

**APIè°ƒç”¨ä¼˜åŒ–:**
- ä½¿ç”¨æ‰¹é‡åˆ†ç±»ï¼ˆ50ä¸ª/æ‰¹ï¼‰
- è®¾ç½®åˆç†çš„timeout
- å®ç°é”™è¯¯é‡è¯•æœºåˆ¶
- ç›‘æ§APIé…é¢

### 5. æˆæœ¬æ§åˆ¶

**å¼€å‘é˜¶æ®µ:**
- å§‹ç»ˆä½¿ç”¨ `--skip-llm` æµ‹è¯•æµç¨‹
- ä½¿ç”¨ `--test-limit` é™åˆ¶æ•°é‡
- ä¼˜å…ˆä½¿ç”¨ç¼“å­˜

**ç”Ÿäº§é˜¶æ®µ:**
- é€‰æ‹©æ€§å¤„ç†é«˜ä»·å€¼èšç±»
- ä½¿ç”¨æ€§ä»·æ¯”é«˜çš„æ¨¡å‹ï¼ˆGPT-4o-mini, Deepseekï¼‰
- æ‰¹é‡å¤„ç†Tokenåˆ†ç±»
- ç›‘æ§æˆæœ¬ï¼Œè®¾ç½®é¢„ç®—è­¦æŠ¥

### 6. ç‰ˆæœ¬ç®¡ç†

**æ•°æ®è½®æ¬¡ç®¡ç†:**
```
Round 1: åˆå§‹æ•°æ®å¯¼å…¥ï¼ˆ2024-01-15ï¼‰
Round 2: å¢é‡æ•°æ®å¯¼å…¥ï¼ˆ2024-02-15ï¼‰
Round 3: å¢é‡æ•°æ®å¯¼å…¥ï¼ˆ2024-03-15ï¼‰
```

**å¤‡ä»½ç­–ç•¥:**
- æ¯ä¸ªPhaseå®Œæˆåå¤‡ä»½æ•°æ®åº“
- ä¿å­˜embeddingsç¼“å­˜
- å½’æ¡£è¾“å‡ºCSVæ–‡ä»¶
- Gitæäº¤é…ç½®å˜æ›´

---

## é¡¹ç›®ç»“æ„

```
è¯æ ¹èšç±»éœ€æ±‚æŒ–æ˜/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py                 # æ ¸å¿ƒé…ç½®æ–‡ä»¶
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                        # åŸå§‹CSVæ•°æ®
â”‚   â”‚   â”œâ”€â”€ semrush_*.csv
â”‚   â”‚   â”œâ”€â”€ dropdown_*.csv
â”‚   â”‚   â””â”€â”€ related_search_*.csv
â”‚   â”‚
â”‚   â”œâ”€â”€ cache/                      # Embeddingsç¼“å­˜
â”‚   â”‚   â””â”€â”€ embeddings_round1.npz
â”‚   â”‚
â”‚   â””â”€â”€ output/                     # è¾“å‡ºæ–‡ä»¶
â”‚       â”œâ”€â”€ clusters_levelA.csv
â”‚       â”œâ”€â”€ demands_draft.csv
â”‚       â””â”€â”€ tokens_extracted.csv
â”‚
â”œâ”€â”€ scripts/                        # æ‰§è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ run_phase1_import.py       # Phase 1: æ•°æ®å¯¼å…¥
â”‚   â”œâ”€â”€ run_phase2_clustering.py   # Phase 2: å¤§ç»„èšç±»
â”‚   â”œâ”€â”€ run_phase2_resplit.py      # Phase 2: äºŒæ¬¡èšç±»
â”‚   â”œâ”€â”€ import_selection.py        # Phase 3: å¯¼å…¥ç­›é€‰ç»“æœ
â”‚   â”œâ”€â”€ run_phase4_demands.py      # Phase 4: å°ç»„èšç±» + éœ€æ±‚å¡ç‰‡
â”‚   â””â”€â”€ run_phase5_tokens.py       # Phase 5: Tokenæå–
â”‚
â”œâ”€â”€ core/                           # æ ¸å¿ƒç®—æ³•
â”‚   â”œâ”€â”€ clustering.py              # èšç±»ç®—æ³•ï¼ˆHDBSCANï¼‰
â”‚   â”œâ”€â”€ embedding.py               # EmbeddingæœåŠ¡
â”‚   â””â”€â”€ utils.py                   # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ ai/                             # AIæœåŠ¡
â”‚   â””â”€â”€ client.py                  # LLMå®¢æˆ·ç«¯ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
â”‚
â”œâ”€â”€ storage/                        # æ•°æ®æŒä¹…åŒ–
â”‚   â”œâ”€â”€ models.py                  # SQLAlchemyæ¨¡å‹
â”‚   â””â”€â”€ repository.py              # Repositoryå±‚ï¼ˆCRUDï¼‰
â”‚
â”œâ”€â”€ utils/                          # å·¥å…·æ¨¡å—
â”‚   â””â”€â”€ token_extractor.py         # Tokenæå–å·¥å…·
â”‚
â”œâ”€â”€ docs/                           # æ–‡æ¡£
â”‚   â”œâ”€â”€ USER_GUIDE.md              # æœ¬æ–‡æ¡£
â”‚   â”œâ”€â”€ Phase2_Implementation_Summary.md
â”‚   â”œâ”€â”€ Phase4_Implementation_Summary.md
â”‚   â””â”€â”€ Phase5_Implementation_Summary.md
â”‚
â”œâ”€â”€ requirements.txt                # Pythonä¾èµ–
â””â”€â”€ README.md                       # é¡¹ç›®è¯´æ˜
```

---

## å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# Phase 1: æ•°æ®å¯¼å…¥
python scripts/run_phase1_import.py

# Phase 2: å¤§ç»„èšç±»
python scripts/run_phase2_clustering.py --use-cache

# Phase 3: å¯¼å…¥ç­›é€‰ï¼ˆç¼–è¾‘CSVåï¼‰
python scripts/import_selection.py

# Phase 4: å®Œæ•´è¿è¡Œ
python scripts/run_phase4_demands.py

# Phase 4: æµ‹è¯•è¿è¡Œ
python scripts/run_phase4_demands.py --skip-llm --test-limit 2

# Phase 5: å®Œæ•´è¿è¡Œ
python scripts/run_phase5_tokens.py --sample-size 10000

# Phase 5: æµ‹è¯•è¿è¡Œ
python scripts/run_phase5_tokens.py --skip-llm --sample-size 1000

# æ•°æ®åº“ç»Ÿè®¡
python -c "from storage.repository import PhraseRepository; repo = PhraseRepository(); stats = repo.get_statistics(); print(stats)"

# æŸ¥çœ‹èšç±»
python -c "from storage.repository import ClusterMetaRepository; repo = ClusterMetaRepository(); clusters = repo.get_all_clusters('A'); print(f'{len(clusters)} clusters')"
```

### å…³é”®é…ç½®è·¯å¾„

```
æ•°æ®åº“é…ç½®: config/settings.py â†’ DATABASE_CONFIG
LLMé…ç½®: config/settings.py â†’ LLM_PROVIDER, LLM_CONFIG
èšç±»å‚æ•°: config/settings.py â†’ LARGE_CLUSTER_CONFIG, SMALL_CLUSTER_CONFIG
è¾“å‡ºç›®å½•: data/output/
ç¼“å­˜ç›®å½•: data/cache/
```

---

## è”ç³»ä¸æ”¯æŒ

### è·å–å¸®åŠ©

1. æŸ¥çœ‹æ–‡æ¡£: `docs/` ç›®å½•ä¸‹çš„è¯¦ç»†æ–‡æ¡£
2. æŸ¥çœ‹ä»£ç æ³¨é‡Š: æ‰€æœ‰æ ¸å¿ƒå‡½æ•°éƒ½æœ‰è¯¦ç»†çš„docstring
3. æŸ¥çœ‹æµ‹è¯•ç¤ºä¾‹: æ¯ä¸ªè„šæœ¬éƒ½æœ‰ `--help` å‚æ•°

### è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æ–‡æ¡£å’Œå»ºè®®ï¼

---

**æ–‡æ¡£ç‰ˆæœ¬:** 1.0
**æœ€åæ›´æ–°:** 2024-12-19
**ä½œè€…:** Claude Code

---

## é™„å½•

### A. æ•°æ®è¡¨ç»“æ„

#### phrases è¡¨
```sql
CREATE TABLE phrases (
    phrase_id INT PRIMARY KEY AUTO_INCREMENT,
    phrase VARCHAR(500) NOT NULL UNIQUE,
    frequency INT DEFAULT 1,
    volume INT DEFAULT 0,
    seed_word VARCHAR(255),
    source_type VARCHAR(50),
    cluster_id_A INT,
    cluster_id_B INT,
    mapped_demand_id INT,
    processed_status VARCHAR(50) DEFAULT 'unseen',
    first_seen_round INT DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### cluster_meta è¡¨
```sql
CREATE TABLE cluster_meta (
    id INT PRIMARY KEY AUTO_INCREMENT,
    cluster_id INT NOT NULL,
    cluster_level CHAR(1) NOT NULL,
    size INT NOT NULL,
    example_phrases TEXT,
    main_theme VARCHAR(255),
    parent_cluster_id INT,
    total_frequency INT DEFAULT 0,
    is_selected BOOLEAN DEFAULT FALSE,
    selection_score INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(cluster_id, cluster_level)
);
```

#### demands è¡¨
```sql
CREATE TABLE demands (
    demand_id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    user_scenario TEXT,
    demand_type VARCHAR(50),
    source_cluster_A INT,
    source_cluster_B INT,
    related_phrases_count INT DEFAULT 0,
    business_value VARCHAR(20),
    status VARCHAR(50) DEFAULT 'idea',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### tokens è¡¨
```sql
CREATE TABLE tokens (
    token_id INT PRIMARY KEY AUTO_INCREMENT,
    token_text VARCHAR(100) NOT NULL UNIQUE,
    token_type VARCHAR(20) NOT NULL,
    in_phrase_count INT DEFAULT 0,
    first_seen_round INT DEFAULT 1,
    verified BOOLEAN DEFAULT FALSE,
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### B. APIä»·æ ¼å‚è€ƒï¼ˆ2024å¹´12æœˆï¼‰

#### OpenAI
- text-embedding-3-small: $0.02 / 1M tokens
- gpt-4o-mini: $0.15 / 1M input, $0.60 / 1M output
- gpt-4o: $2.50 / 1M input, $10.00 / 1M output

#### Anthropic
- claude-3-5-sonnet: $3.00 / 1M input, $15.00 / 1M output
- claude-3-opus: $15.00 / 1M input, $75.00 / 1M output

#### Deepseek
- deepseek-chat: $0.14 / 1M input, $0.28 / 1M output

### C. æ€§èƒ½åŸºå‡†

**æµ‹è¯•ç¯å¢ƒ:**
- CPU: Intel i7-12700K
- RAM: 32GB DDR4
- æ•°æ®é‡: 55,275æ¡çŸ­è¯­

**è¿è¡Œæ—¶é—´:**
- Phase 1 (å¯¼å…¥): ~2åˆ†é’Ÿ
- Phase 2 (èšç±»ï¼Œæœ‰ç¼“å­˜): ~5åˆ†é’Ÿ
- Phase 2 (èšç±»ï¼Œæ— ç¼“å­˜): ~15åˆ†é’Ÿ
- Phase 4 (28ä¸ªå¤§ç»„ï¼Œå«LLM): ~30åˆ†é’Ÿ
- Phase 5 (10000é‡‡æ ·ï¼Œå«LLM): ~10åˆ†é’Ÿ

**APIè°ƒç”¨æ¬¡æ•°:**
- Phase 2 embedding: 553æ¬¡ï¼ˆbatch_size=100ï¼‰
- Phase 4 LLM: ~168æ¬¡ï¼ˆ28ä¸ªå¤§ç»„ Ã— å¹³å‡6ä¸ªå°ç»„ï¼‰
- Phase 5 LLM: ~20æ¬¡ï¼ˆ1000 tokens / batch_size=50ï¼‰

---

ğŸ‰ **æ­å–œï¼æ‚¨å·²å®Œæˆä½¿ç”¨è¯´æ˜çš„é˜…è¯»ã€‚ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼**
